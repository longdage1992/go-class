!function(e,t){for(var o in t)e[o]=t[o]}(exports,function(e){var t={};function o(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(i,r,function(t){return e[t]}.bind(null,r));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=16)}([function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])}(o(19)),t.calStandard={sizeWidth:1280,placeWidth:128e4,minFontSize:window.hasOwnProperty("ontouchstart")?1:12,maxFontSize:100,minLineWidth:1,maxLineWidth:100},function(e){e[e.Page=0]="Page",e[e.Scroll=1]="Scroll"}(t.ScrollMode||(t.ScrollMode={})),function(e){e[e.PPT=1]="PPT",e[e.DOC=2]="DOC",e[e.ELS=4]="ELS",e[e.PDF=8]="PDF",e[e.IMG=16]="IMG",e[e.TXT=32]="TXT",e[e.PPTH5=512]="PPTH5"}(t.FileType||(t.FileType={})),function(e){e[e.Single=1]="Single",e[e.Multi=2]="Multi",e[e.Other=4]="Other"}(t.ActionType||(t.ActionType={})),function(e){e[e.Update=2]="Update",e[e.Delete=4]="Delete",e[e.Move=8]="Move",e[e.Create=32]="Create"}(t.Action||(t.Action={})),function(e){e[e.Local=0]="Local",e[e.Remote=1]="Remote",e[e.UnReDo=2]="UnReDo"}(t.GraphicOperateType||(t.GraphicOperateType={})),function(e){e[e.Pencil=1]="Pencil",e[e.Text=2]="Text",e[e.Line=4]="Line",e[e.Rect=8]="Rect",e[e.Ellipse=16]="Ellipse",e[e.Laser=128]="Laser",e[e.Image=256]="Image"}(t.GraphicType||(t.GraphicType={})),function(e){e[e.Pc=1]="Pc",e[e.Mobile=2]="Mobile"}(t.Platform||(t.Platform={})),function(e){e[e.Init=1]="Init",e[e.Down=2]="Down",e[e.Move=3]="Move",e[e.DownMove=4]="DownMove",e[e.DownMoveUp=5]="DownMoveUp",e[e.DownNoMoveUp=6]="DownNoMoveUp",e[e.Leave=7]="Leave",e[e.DownLeave=8]="DownLeave"}(t.DrawState||(t.DrawState={}))},function(e,t,o){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.appid="",this.roomid="",this.userid="",this.token="",this.isTestEnv=!0,this.version="",this.platform="",this.extra={},this.isProd=!1,this.isElectron=!1,this.logCacheSend=[],this.logCacheMax=100,this.platform=e||"",this.isElectron=t,this.openLogServer()}return e.prototype.init=function(e){var t=e.appid,o=e.isTestEnv,i=e.version,r=e.isProd,a=e.liveroom;this.appid=(t||this.appid)+"",this.isTestEnv=o,this.version=i||this.version,this.isProd=r,a&&!this.platform.includes("liveroom")&&(this.platform+=",liveroom")},e.prototype.initRoom=function(e){var t=e.roomid,o=e.userid,i=e.token;this.roomid=t||this.roomid,this.userid=o||this.userid,this.token=i||this.token},e.prototype.setExtraConfig=function(e){Object.assign(this.extra,e)},e.prototype.getConfig=function(){return{appid:+this.appid,roomid:this.roomid,userid:this.userid,token:this.token,isTestEnv:this.isTestEnv}},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log(0,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log(1,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log(2,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log(3,e)},e.prototype.writeLocalLog=function(e){},e.prototype.log=function(e,t){var o=this.isProd||this.isElectron?this.logParamList(e,t.join("")):t.join("");return this.isProd&&this.remoteWebSocketLog(e,o),this.isElectron&&this.writeLocalLog(o),o},e.prototype.openLogServer=function(){this.stopWebSocketServer(),this.websocket=new WebSocket("wss://weblogger-edu.zego.im/log")},e.prototype.stopWebSocketServer=function(){this.websocket&&(this.websocket.close(),this.websocket=null)},e.prototype.remoteWebSocketLog=function(e,t){if(!("string"==typeof t&&t.length>4e3))if(null==this.websocket||2==this.websocket.readyState||3==this.websocket.readyState)this.openLogServer(),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t);else if(0==this.websocket.readyState)this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t);else if(1==this.websocket.readyState)if(this.logCacheSend.length>0){for(var o="",i=0;i<this.logCacheSend.length;i++)(o+this.logCacheSend[i]).length>4e3&&(this.websocket.send(o),o=""),o=o+this.logCacheSend[i]+"\n";t=o+t,this.logCacheSend=[],this.websocket.send(t)}else this.websocket.send(t);else this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t)},e.prototype.logParamList=function(e,t){var o=(new Date).toLocaleString(),r=t.indexOf(" "),a=t.substr(0,r)||t,n=t.substr(r+1,4500),s=i(i({time:o,level:e,action:a,content:n,appid:this.appid,userid:this.userid,roomid:this.roomid},this.extra),{version:this.version,platform:this.platform});return JSON.stringify(s)},e}(),a=function(e,t,o){var i=!(!e||!e.versions.electron);return{electron:i,platform:(i?e.platform:t)+","+o[o.length-2]+","+o[o.length-1]}}(window.process,navigator.platform,navigator.userAgent.split(" ")),n=a.electron,s=a.platform,d=n?"ec.":"web.";t.getLogAction=function(e,t){return""+d+e+t+" "},t.Logger=window.zegoLogger||(window.zegoLogger=new r(s,n))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(34),r=o(0),a=o(21),n=o(22);t.createGraphicId=function(){return""+n(i.v4())};t.removeElement=function(e){if(e){var t=e.parentNode;t?t.removeChild(e):e.remove?e.remove():e.removeNode()}};t.calSizeHandle=function(e,t,o,i){var a,n=r.calStandard.sizeWidth,s=r.calStandard.minFontSize,d=r.calStandard.minLineWidth;return i?a=Math.round(e*n/o):(a=Math.round(o*e/n),r.GraphicType.Text===t?a<s&&(a=s):a<d&&(a=d)),a};var s=function(e){for(var t=e.length,o=.1,i=t-4,r="M"+e[0]+", "+e[1],a=0;a<t-2;a+=2){var n=a?e[a-2]:e[0],s=a?e[a-1]:e[1],d=e[a+0],h=e[a+1],l=e[a+2],c=e[a+3],p=a!==i?e[a+4]:l,g=a!==i?e[a+5]:c;r+=" C"+(Number(d)+(l-n)/6*o)+","+(Number(h)+(c-s)/6*o)+","+(Number(l)-(p-d)/6*o)+","+(Number(c)-(g-h)/6*o)+","+l+","+c}return r},d=function(e){var t=e[0],o=e[1],i=e[2],r=e[3];return[Math.min(t,i),Math.min(o,r)]};t.mapGraphicsData=function(e,t){var o;switch(e){case r.GraphicType.Pencil:o={d:s(t)};break;case r.GraphicType.Line:o={x1:t[0],y1:t[1],x2:t[2],y2:t[3]};break;case r.GraphicType.Rect:var i=Math.abs(t[2]-t[0]),a=Math.abs(t[3]-t[1]),n=d(t);o={x:n[0],y:n[1],width:i,height:a};break;case r.GraphicType.Ellipse:var h=Math.abs(t[2]-t[0])/2,l=Math.abs(t[3]-t[1])/2,c=d(t);o={cx:c[0]+h,cy:c[1]+l,rx:h,ry:l};break;default:o=!1}return o};t.setAttributeHandle=function(e,t){t.forEach((function(t){e.setAttribute(t.attr,t.value)}))};t.createSvgElementHandle=function(e,t,o,i){var r,a=document.querySelector("#"+e);if(a)return i&&a.setAttribute("data-z",i+""),[r=a.querySelector("#"+t)];a=document.createElementNS("http://www.w3.org/2000/svg","svg");var n=document.createElementNS("http://www.w3.org/2000/svg","g");return r=document.createElementNS("http://www.w3.org/2000/svg",o),a.id=e,a.setAttribute("xmlns","http://www.w3.org/2000/svg"),a.setAttribute("version","1.1"),i&&a.setAttribute("data-z",i+""),r.id=t,n.appendChild(r),a.appendChild(n),[r,a]};t.simplifyPathData=function(e){var t=[],o=[];return e.forEach((function(e,t,i){t%2==0&&o.push({x:e,y:i[t+1]})})),a(o,1).forEach((function(e){t=t.concat([e.x,e.y])})),t};t.getElementChild=function(e){return e.children||e.childNodes};t.splitTextHandle=function(e){var t=e.split(",");return{beginX:t[0],beginY:t[1],text:t.slice(2).join(",")}};t.addTextBeginPlace=function(e,t,o){return parseInt(t)+","+parseInt(o)+","+e};t.bindStopsEvents=function(e,t){t.forEach((function(t){e.addEventListener(t,(function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}))}))};t.checkColor=function(e){return/^#[0-9a-fA-F]{6}|rgba?\(*.+\d\)$/.test(e)};t.checkBrushSize=function(e){return/^([1-9]|[1-9]\d|100)$/.test(""+e)&&"number"==typeof e};t.checkTextSize=function(e){return/^([1-9]|[1-9]\d|100)$/.test(""+e)&&"number"==typeof e};t.getOffsetData=function(e){var t=0,o=0;if(e)for(t+=e.offsetTop,o+=e.offsetLeft;e.offsetParent;)t+=e.offsetParent.offsetTop,o+=e.offsetParent.offsetLeft,e=e.offsetParent;return{offsetTop:t,offsetLeft:o}};t.getScrollData=function(e){var t=0,o=0;if(e)for(t+=e.scrollTop,o+=e.scrollLeft;e.parentNode;)t+=e.parentNode.scrollTop||0,o+=e.parentNode.scrollLeft||0,e=e.parentNode;return{scrollTop:t,scrollLeft:o}};t.transGraphicsData=function(e,t){var o=e.length>1?r.ActionType.Multi:r.ActionType.Single,i=JSON.parse(JSON.stringify(e));return i.forEach((function(e){e.action_type=o,e.action=t,delete e.initX,delete e.initY,delete e.selected,delete e.fontSize,delete e.bgColor})),i};t.transColor=function(e,t){return t?"#"+(e=e.toString(16)).slice(2).padStart(6,"0"):(e=function(e){if(0===e.indexOf("#"))return e;var t=e.replace(/rgba?/,"").replace(/\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),o=parseFloat(t[3]||"1"),i=Math.floor(o*parseInt(t[0])+255*(1-o)),r=Math.floor(o*parseInt(t[1])+255*(1-o)),a=Math.floor(o*parseInt(t[2])+255*(1-o));return"#"+("0"+i.toString(16)).slice(-2)+("0"+r.toString(16)).slice(-2)+("0"+a.toString(16)).slice(-2)}(e),parseInt("0xFF"+e.split("#")[1]))};t.isNumber=function(e){return"number"==typeof e&&!isNaN(e)}},,function(e,t){!function(){if(-1!==window.navigator.userAgent.indexOf("Trident")){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var o=document.createEvent("CustomEvent");return o.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),o}e.prototype=window.Event.prototype,window.CustomEvent=e,document.body.scrollTo||(Element.prototype.scrollTo=function(e,t){this.scrollLeft=e,this.scrollTop=t}),document.body.scrollBy||(Element.prototype.scrollBy=function(e,t){this.scrollLeft+=e,this.scrollTop+=t}),FileReader.prototype.readAsBinaryString||(FileReader.prototype.readAsBinaryString=function(e){var t=this,o=new FileReader;o.onload=function(e){for(var i="",r=new Uint8Array(o.result),a=r.byteLength,n=0;n<a;n++)i+=String.fromCharCode(r[n]);t.content=i,t.result=i,t.onload()},o.readAsArrayBuffer(e)})}}()},function(e,t,o){"use strict";var i,r=function(){return void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i},a=function(){var e={};return function(t){if(void 0===e[t]){var o=document.querySelector(t);if(window.HTMLIFrameElement&&o instanceof window.HTMLIFrameElement)try{o=o.contentDocument.head}catch(e){o=null}e[t]=o}return e[t]}}(),n=[];function s(e){for(var t=-1,o=0;o<n.length;o++)if(n[o].identifier===e){t=o;break}return t}function d(e,t){for(var o={},i=[],r=0;r<e.length;r++){var a=e[r],d=t.base?a[0]+t.base:a[0],h=o[d]||0,l="".concat(d," ").concat(h);o[d]=h+1;var c=s(l),p={css:a[1],media:a[2],sourceMap:a[3]};-1!==c?(n[c].references++,n[c].updater(p)):n.push({identifier:l,updater:v(p,t),references:1}),i.push(l)}return i}function h(e){var t=document.createElement("style"),i=e.attributes||{};if(void 0===i.nonce){var r=o.nc;r&&(i.nonce=r)}if(Object.keys(i).forEach((function(e){t.setAttribute(e,i[e])})),"function"==typeof e.insert)e.insert(t);else{var n=a(e.insert||"head");if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(t)}return t}var l,c=(l=[],function(e,t){return l[e]=t,l.filter(Boolean).join("\n")});function p(e,t,o,i){var r=o?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(e.styleSheet)e.styleSheet.cssText=c(t,r);else{var a=document.createTextNode(r),n=e.childNodes;n[t]&&e.removeChild(n[t]),n.length?e.insertBefore(a,n[t]):e.appendChild(a)}}function g(e,t,o){var i=o.css,r=o.media,a=o.sourceMap;if(r?e.setAttribute("media",r):e.removeAttribute("media"),a&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}var u=null,f=0;function v(e,t){var o,i,r;if(t.singleton){var a=f++;o=u||(u=h(t)),i=p.bind(null,o,a,!1),r=p.bind(null,o,a,!0)}else o=h(t),i=g.bind(null,o,t),r=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(o)};return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else r()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=r());var o=d(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var i=0;i<o.length;i++){var r=s(o[i]);n[r].references--}for(var a=d(e,t),h=0;h<o.length;h++){var l=s(o[h]);0===n[l].references&&(n[l].updater(),n.splice(l,1))}o=a}}}},function(e,t,o){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var o=function(e,t){var o=e[1]||"",i=e[3];if(!i)return o;if(t&&"function"==typeof btoa){var r=(n=i,s=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),d="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(d," */")),a=i.sources.map((function(e){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(e," */")}));return[o].concat(a).concat([r]).join("\n")}var n,s,d;return[o].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(o,"}"):o})).join("")},t.i=function(e,o,i){"string"==typeof e&&(e=[[null,e,""]]);var r={};if(i)for(var a=0;a<this.length;a++){var n=this[a][0];null!=n&&(r[n]=!0)}for(var s=0;s<e.length;s++){var d=[].concat(e[s]);i&&r[d[0]]||(o&&(d[2]?d[2]="".concat(o," and ").concat(d[2]):d[2]=o),t.push(d))}},t}},function(e,t,o){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),a=((i={})[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorInternal]="内部错误",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid]="参数错误",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorNetworkTimeout]="网络超时",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorNetworkDisconnect]="网络断开",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorInvalidRsp]="网络回包错误",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorRequestTooMany]="请求过于频繁",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoLoginRoom]="未登录房间",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorUserNotExist]="用户不存在",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewNotExist]="白板view不存在",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewCreateFail]="创建白板view失败",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewModifyFail]="修改白板view失败",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewNameLimit]="白板view名称过长",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewParentNotExist]="白板view的parent不存在",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewNumLimit]="超过图元最大数量限制",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicNotExist]="图元不存在",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicCreateFail]="创建图元错误",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicModifyFail]="修改图元错误",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicUnableDraw]="未开启绘制",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicDataLimit]="图元数据大小超过限制",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicNumLimit]="超过图元最大数量限制",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicTextLimit]="文本字数超过上限",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicImageSizeLimit]="图片图元大小超限制",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport]="不支持的图片类型",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicIllegalUrl]="非法图片url",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorInitFail]="初始化失败",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGetListFail]="拉取白板view列表失败",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorCreateFail]="创建白板view失败",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorDestroyFail]="销毁白板view失败",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorAttachFail]="attach白板view失败",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorClearFail]="清空白板view失败",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorScrollFail]="滚动白板view失败",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorUndoFail]="撤销操作失败",i[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorRedoFail]="重做操作失败",i),n={1003:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoLoginRoom,1014:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorUserNotExist,1101:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewNotExist,1102:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewCreateFail,1104:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewModifyFail,1114:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewNumLimit,1212:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicCreateFail,1201:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicModifyFail,1202:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicModifyFail,1219:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicModifyFail,1217:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicDataLimit,1222:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicDataLimit,1223:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicNumLimit,10001e3:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorInternal,10001001:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid,111001002:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorNetworkTimeout,111001001:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorNetworkDisconnect,60003001:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorInvalidRsp,111101001:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorRequestTooMany,112001003:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorNoLoginRoom,112001014:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorUserNotExist,112001101:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewNotExist,112001102:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewCreateFail,112001104:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewModifyFail,112001114:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewNumLimit,112001212:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicCreateFail,112001201:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicModifyFail,112001202:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicModifyFail,112001219:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicModifyFail,112001217:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicDataLimit,112001222:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicDataLimit,112001223:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicNumLimit,110000003:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport,110000004:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicImageSizeLimit,110000005:r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicIllegalUrl};t.transError=function(e,t){return{code:e=n[e]||e,msg:t=a[e]&&t?t:a[e]||t||a[r.ZegoWhiteboardError.ZegoWhiteboardViewErrorInternal]}}},,,,,,,,,function(e,t,o){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});Object.defineProperty(t,"__esModule",{value:!0});var a=o(17),n=o(28),s=o(29),d=o(31),h=o(1),l=h.getLogAction.bind(null,"wb.m.");o(4),o(32);var c=function(e){function t(t,o){var i=this;h.Logger.init({isTestEnv:t.isTestEnv,appid:t.app_id,version:"1.15.0",isProd:!0,liveroom:!0});var r=new n.ZegoWhiteboardStore,a=new s.ZegoWhiteboardService(new d.ZegoAdapter(o),r);return(i=e.call(this,a,r)||this).zegoLiveRoom=o,a.onRemotePush(),h.Logger.writeLocalLog=i.writeLocalLog,h.Logger.info(l("new"),JSON.stringify({params:t})),i}return r(t,e),t.prototype.writeLocalLog=function(e){},t.prototype.loginRoom=function(e,t,o){var i=this;return h.Logger.roomid=e,new Promise((function(r,a){var n={room_id:e,room_name:t,role:o};i.zegoLiveRoom.loginRoom(n,(function(e){h.Logger.info(l("login"),JSON.stringify({params:n,result:e})),e&&0==e.error_code?r(!0):a(e)}))}))},t.prototype.logoutRoom=function(e){this.zegoLiveRoom.logoutRoom(e),h.Logger.info(l("logout"),e)},t.prototype.getVersion=function(){return"1.15.0"},t}(a.ZegoWhiteboardManager);t.ZegoExpressEngine=c},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(18),r=o(0),a=o(7),n=o(1),s=n.getLogAction.bind(null,"wb.m."),d=function(){function e(e,t){this.modIdMapInstance={},this.fileInfoMap={},this.signallingDelay=0,this.store=t,this.serviceHandle=e,this.registerLoadfileListener(),this.registerPushCallbackHandle(),this.registerPullCallbackHandle()}return e.prototype.registerLoadfileListener=function(){var e=this;document.body.addEventListener("loadfile",(function(t){var o=t.detail.fileID;e.fileInfoMap[o]=t.detail,n.Logger.info(s("update_file_info"),JSON.stringify({fileID:o,detail:t.detail}))}))},e.prototype.registerPushCallbackHandle=function(){var e=this;this.serviceHandle.bindListener("pushClearPageGraphics",(function(t){e.signallingDelay?setTimeout((function(){e.clearGraphicsPushCallback(t)}),e.signallingDelay):e.clearGraphicsPushCallback(t)})),this.serviceHandle.bindListener("pushDrawPageGraphics",(function(t,o){e.signallingDelay?setTimeout((function(){e.drawGraphicsPushCallback(t,o)}),e.signallingDelay):e.drawGraphicsPushCallback(t,o)})),this.serviceHandle.bindListener("pushAddMod",(function(t){e.signallingDelay?setTimeout((function(){e.addModPushCallback(t)}),e.signallingDelay):e.addModPushCallback(t)})),this.serviceHandle.bindListener("pushRemovedMod",(function(t){e.signallingDelay?setTimeout((function(){e.removedModPushCallback(t)}),e.signallingDelay):e.removedModPushCallback(t)})),this.serviceHandle.bindListener("pushScroll",(function(t,o,i,r){e.signallingDelay?setTimeout((function(){e.scrollPushCallback(t,o,i,r)}),e.signallingDelay):e.scrollPushCallback(t,o,i,r)})),this.serviceHandle.bindListener("h5ExtraAppendedNotify",(function(t,o){e.signallingDelay?setTimeout((function(){e.h5ExtraAppendedPushCallback(t,o)}),e.signallingDelay):e.h5ExtraAppendedPushCallback(t,o)}))},e.prototype.registerPullCallbackHandle=function(){var e=this;this.serviceHandle.bindListener("getPageGraphicsList",(function(t,o,i){var r=e.getMapInstance(t);r&&r.updateRemoteToLocal(o,i)})),this.serviceHandle.bindListener("scroll",(function(e){var t=e.whiteboardID,o=e.code,i=e.msg;0===o?n.Logger.info(s("mod.scroll_cb"),JSON.stringify({whiteboardID:t})):n.Logger.error(s("mod.scroll_cb"),JSON.stringify(a.transError(o,i)))})),this.serviceHandle.bindListener("appendH5ExtraCallback",(function(t){var o=t.whiteboardID,i=t.code,r=t.msg,d=t.modExtra;if(0===i)n.Logger.info(s("mod.append_h5extra_cb"),"whiteboardID="+o+",modExtra="+d);else{var h=a.transError(i,r);n.Logger.error(s("mod.append_h5extra_cb"),JSON.stringify(h)),e.serviceHandle.actionCustomListener("error",h)}}))},e.prototype.addModPushCallback=function(e){var t=this.getMapInstance(e);t||(n.Logger.info(s("mod.remote_add"),JSON.stringify({whiteboardID:e})),t=new i.ZegoWhiteboardViewImpl(e,this.store,this.serviceHandle),this.setMapInstance(t)),this.serviceHandle.actionCustomListener("viewAdd",t)},e.prototype.removedModPushCallback=function(e){var t=this.getMapInstance(e);t&&(n.Logger.info(s("mod.remote_removed"),JSON.stringify({whiteboardID:e})),t.destroyDomHandle(),t=null,this.deleteMapInstance(e),this.serviceHandle.actionCustomListener("viewRemoved",e))},e.prototype.scrollPushCallback=function(e,t,o,i){var r=this.getMapInstance(e);r&&(n.Logger.info(s("mod.remote_scroll"),JSON.stringify({whiteboardID:e,horizontalPercent:t,verticalPercent:o,step:i,actionMsg:"transValue"})),r.isActivited()&&r.scrollToHandle(t,o,i,!1))},e.prototype.h5ExtraAppendedPushCallback=function(e,t){var o=this.getMapInstance(e);o&&(n.Logger.info(s("mod.remote_h5extra"),"whiteboardID="+e+",modExtra="+t),o.isActivited()&&o.playAnimation(t,!0))},e.prototype.clearGraphicsPushCallback=function(e){var t=this.getMapInstance(e);t&&(n.Logger.info(s("mod.remote_clear"),JSON.stringify({whiteboardID:e})),t.clearLocalHandle())},e.prototype.drawGraphicsPushCallback=function(e,t){var o=this.getMapInstance(e);if(o){var i=[],r=[];t.forEach((function(e){var t=e.del_graphic_id_list,o=e.graphic_list;i=i.concat(t),r=r.concat(o)})),o.updateRemoteToLocal(r,i)}},e.prototype.setFileInfo=function(e){var t;if(e.fileInfo){var o=e.fileInfo,i=o.fileID,r=o.fileName,a=this.fileInfoMap[i];(a=a&&a[r])&&(e.aspectWidth=a.width,e.aspectHeight=a.height,e.pageCount=a.pageCount,n.Logger.info(s("update_file_info"),JSON.stringify({fileID:i,detail:(t={fileID:i},t[r]=a,t)})))}},e.prototype.deleteMapInstance=function(e){delete this.modIdMapInstance[e]},e.prototype.getMapInstance=function(e){return this.modIdMapInstance[e]},e.prototype.setMapInstance=function(e){this.modIdMapInstance[e.getID()]=e},e.prototype.activitedView=function(e){Object.values(this.modIdMapInstance).forEach((function(t){t.setActivited(t.getID()==e)}))},e.prototype.checkAttachingParent=function(e){return!!document.getElementById(e)},e.prototype.checkCreatingView=function(e){return!(!e||!e.roomID||!e.name||isNaN(+e.aspectWidth)||!+e.aspectWidth||isNaN(+e.aspectHeight)||!+e.aspectHeight||isNaN(+e.pageCount)||!+e.pageCount)},e.prototype.checkViewName=function(e){return e.name.length<=50},e.prototype.setDeferredRenderingTime=function(e){this.signallingDelay=e||0},e.prototype.clear=function(e){Object.values(this.modIdMapInstance).forEach((function(t){t&&t.clearLaserHandle(e)})),n.Logger.info(s("clear"))},e.prototype.getViewList=function(){var e=this;return new Promise((function(t,o){e.serviceHandle.getModList(1,(function(d){try{Object.keys(e.modIdMapInstance).forEach((function(t){-1===d.indexOf(t)&&e.deleteMapInstance(t)})),d.forEach((function(t){e.modIdMapInstance[t]||e.setMapInstance(new i.ZegoWhiteboardViewImpl(t,e.store,e.serviceHandle)),e.getMapInstance(t).setSelfSize()})),n.Logger.info(s("getViewList"),JSON.stringify(Object.keys(e.modIdMapInstance)));var h=Object.values(e.modIdMapInstance).sort((function(t,o){return e.serviceHandle.getCreateTime(o.getID())-e.serviceHandle.getCreateTime(t.getID())}));t(h)}catch(e){n.Logger.error(s("getViewList"),JSON.stringify(e)),o(a.transError(r.ZegoWhiteboardError.ZegoWhiteboardViewErrorGetListFail))}}),(function(e){n.Logger.error(s("getViewList"),JSON.stringify(e)),o(e)}))}))},e.prototype.createView=function(e){var t=this;return new Promise((function(o,d){if(n.Logger.info(s("createView"),JSON.stringify(e)),!t.checkCreatingView(e)){var h=a.transError(r.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid,"参数错误：roomID、name为字符串，aspectWidth、aspectHeight、pageCount为正整数");return n.Logger.error(s("createView"),JSON.stringify(h)),void d(h)}if(!t.checkViewName(e)){h=a.transError(r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewNameLimit);return n.Logger.error(s("createView"),JSON.stringify(h)),void d(h)}t.setFileInfo(e),t.serviceHandle.createMod(e,(function(e){try{var h=t.getMapInstance(e);h||(h=new i.ZegoWhiteboardViewImpl(e,t.store,t.serviceHandle),t.setMapInstance(h),n.Logger.info(s("createView"),"success")),o(h)}catch(e){n.Logger.error(s("createView"),JSON.stringify(e)),d(a.transError(r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewCreateFail))}}),(function(e){n.Logger.error(s("createView"),JSON.stringify(e)),d(e)}))}))},e.prototype.destroyView=function(e){var t=this;return new Promise((function(o,i){if(!e||!e.getID){var d=a.transError(r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewNotExist);return n.Logger.error(s("destroyView"),JSON.stringify({whiteboardView:e,errorData:d})),void i(d)}t.serviceHandle.destroyMod(e.getID(),(function(){try{t.deleteMapInstance(e.getID()),e.destroyDomHandle(),e=null,n.Logger.info(s("destroyView"),"success"),o()}catch(e){n.Logger.error(s("destroyView"),JSON.stringify(e)),i(a.transError(r.ZegoWhiteboardError.ZegoWhiteboardViewErrorDestroyFail))}}),(function(e){n.Logger.error(s("destroyView"),JSON.stringify(e)),i(e)}))}))},e.prototype.attachView=function(e,t){var o=this;return new Promise((function(i,d){if(!o.checkAttachingParent(t)){var h=a.transError(r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewParentNotExist);return n.Logger.error(s("attachView"),JSON.stringify({parent:t,errorData:h})),void d(h)}if(!e||!e.getID){h=a.transError(r.ZegoWhiteboardError.ZegoWhiteboardViewErrorViewNotExist);return n.Logger.error(s("attachView"),JSON.stringify({whiteboardView:e,errorData:h})),void d(h)}n.Logger.info(s("attachView"),JSON.stringify({whiteboardID:e.getID(),parent:t}));try{var l=e;l.init(t),o.setMapInstance(l),o.activitedView(l.getID()),n.Logger.info(s("attachView"),"success"),i()}catch(e){n.Logger.error(s("attachView"),JSON.stringify(e)),d(a.transError(r.ZegoWhiteboardError.ZegoWhiteboardViewErrorAttachFail))}}))},e.prototype.on=function(e,t){return n.Logger.info(s("on"),JSON.stringify({event:e})),this.serviceHandle.bindCustomListener(e,t)},e.prototype.off=function(e,t){return n.Logger.info(s("off"),JSON.stringify({event:e})),this.serviceHandle.deleteCustomListener(e,t)},e}();t.ZegoWhiteboardManager=d},function(e,t,o){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=o(7),a=o(20),n=o(1),s=o(2),d=o(0),h=n.getLogAction.bind(null,"wb.v."),l=function(){function e(e,t,o){var i=this;this.operationModes={none:!1,scroll:!0,draw:!0,zoom:!0},this.activited=!1,this.viewInfo={},this.isTouch=window.hasOwnProperty("ontouchstart"),this.graphicList=[],this.scrollLogTimer=null,this.scrollHandle=function(e){if(i.clearSelectedHandle(),i.operationModes.scroll&&i.viewInfo.isOriginScroll&&!i.viewInfo.ticking&&!i.viewInfo.draging){var t=i.viewInfo.zoom,o=e.target,r=o.scrollTop,a=o.scrollLeft,n=Math.ceil(r/t),s=Math.ceil(a/t),h=0,l=0;i.viewInfo.direction===d.ZegoWhiteboardViewScrollDirection.Vertical&&n!==i.viewInfo.scrollY?(i.viewInfo.scrollY=n,l=Number((n/i.viewInfo.viewHeight).toFixed(7)),i.checkEmitScrollHandle(h,l,1,!0)):i.viewInfo.direction===d.ZegoWhiteboardViewScrollDirection.Horizontal&&s!==i.viewInfo.scrollX&&(i.viewInfo.scrollX=s,h=Number((s/i.viewInfo.viewWidth).toFixed(7)),i.checkEmitScrollHandle(h,l,1,!0)),i.afterScrollHandle(!0)}},this.handleDragStart=function(e){if(!i.operationModes.none&&i.operationModes.zoom&&(i.viewInfo.zoomX=i.viewInfo.zoomY=0,i.viewInfo.zoom>1&&!i.toolInstance.canDraw&&i.parentDom)){var t=e instanceof TouchEvent?e.changedTouches[0]:e,o=t.clientX,r=t.clientY;if(i.viewInfo.isScroll){var a=i.parentDom.getBoundingClientRect(),n=a.bottom;if(o>a.right-15||r>n-15)return;i.viewInfo.zoomTX=i.parentDom.scrollLeft,i.viewInfo.zoomTX=i.parentDom.scrollTop}i.viewInfo.zoomX=o,i.viewInfo.zoomY=r}},this.handleDragEvent=function(e,t){!i.operationModes.none&&i.operationModes.zoom&&i.viewInfo.zoom>1&&i.viewInfo.zoomX&&!i.toolInstance.canDraw&&(t||!i.viewInfo.ticking)&&(requestAnimationFrame((function(){e instanceof MouseEvent&&!t&&e.buttons<1||(i.viewInfo.isScroll?i.dragScroll(e,!!t):i.dragPage(e,!!t)),i.viewInfo.ticking=!1})),i.viewInfo.ticking=!0)},this.whiteboardID=e,this.whiteboardStore=t,this.serviceHandle=o}return e.prototype.setWhiteboardTransform=function(e,t){var o=this.viewInfo,i=o.viewportWidth,r=o.viewportHeight,a=o.zoom,n=o.direction,s=this.viewInfo.page||1;n===d.ZegoWhiteboardViewScrollDirection.Horizontal?e-=(s-1)*i*a:t-=(s-1)*r*a,this.whiteboardNode.style.cssText+="transform:translate("+e+"px,"+t+"px) scale("+a+");"},e.prototype.dragScroll=function(e,t){var o=this.viewInfo,i=o.zoom,r=o.zoomX,a=o.zoomY,n=o.zoomTX,s=o.zoomTY,h=o.viewWidth,l=o.viewHeight,c=o.viewportWidth,p=o.viewportHeight,g=o.direction,u=e instanceof TouchEvent?e.changedTouches[0]:e,f=u.clientX,v=u.clientY,m=Math.max(n+r-f,0),b=Math.max(s+a-v,0),w=h*i-c+17;m>w&&(m=w),b>(w=l*i-p+17)&&(b=w),this.viewInfo.scrollX=m/i|0,this.viewInfo.scrollY=b/i|0,this.viewInfo.ticking=!0,this.viewInfo.draging=!0,this.parentDom&&this.parentDom.scrollTo(m,b),this.viewInfo.ticking=!1,t&&(this.viewInfo.draging=!1,this.viewInfo.zoomX=0,this.viewInfo.zoomY=0,g===d.ZegoWhiteboardViewScrollDirection.Horizontal?this.emitScroll(m/i/h,0,1,!0):this.emitScroll(0,b/i/l,1,!0))},e.prototype.dragPage=function(e,t){var o=this.viewInfo,i=o.zoom,r=o.zoomTX,a=o.zoomTY,n=o.zoomX,s=o.zoomY,d=o.viewportWidth,h=o.viewportHeight,l=e instanceof TouchEvent?e.changedTouches[0]:e,c=r+l.clientX-n,p=a+l.clientY-s,g=d*(1-i);c>0?c=0:c<g&&(c=g),g=h*(1-i),p>0?p=0:p<g&&(p=g),t?(this.viewInfo.zoomTX=c,this.viewInfo.zoomTY=p,this.viewInfo.zoomX=0,this.viewInfo.zoomY=0):this.setWhiteboardTransform(c,p)},e.prototype.initDragEvents=function(){var e=this;this.viewInfo.hasOwnProperty("offsetPageX")||(this.viewInfo.offsetPageX=0,this.viewInfo.offsetPageY=0,this.viewInfo.zoom=1,this.viewInfo.zoomX=0,this.viewInfo.zoomY=0,this.viewInfo.zoomTX=0,this.viewInfo.zoomTY=0),this.parentDom&&!this.getFileInfo()&&(this.parentDom.addEventListener("mousedown",this.handleDragStart),this.isTouch&&(this.parentDom.addEventListener("touchstart",this.handleDragStart),this.parentDom.addEventListener("touchmove",(function(t){t.preventDefault(),e.handleDragEvent(t)})),this.parentDom.addEventListener("touchend",(function(t){return e.handleDragEvent(t,!0)}))),this.parentDom.addEventListener("mousemove",this.handleDragEvent),this.parentDom.addEventListener("mouseup",(function(t){return e.handleDragEvent(t,!0)})),this.parentDom.addEventListener("mouseleave",(function(t){return e.handleDragEvent(t,!0)})))},e.prototype.updateBindEvents=function(){switch(this.toolInstance.removeEventsHandle(d.ZegoWhiteboardTool.ZegoWhiteboardViewToolLaser),this.toolInstance.removeEventsHandle(d.ZegoWhiteboardTool.ZegoWhiteboardViewToolLine),this.toolInstance.removeEventsHandle(d.ZegoWhiteboardTool.ZegoWhiteboardViewToolText),this.toolInstance.removeEventsHandle(d.ZegoWhiteboardTool.ZegoWhiteboardViewToolSelector),this.toolInstance.removeEventsHandle(d.ZegoWhiteboardTool.ZegoWhiteboardViewToolEraser),this.whiteboardStore.basicState.type){case d.ZegoWhiteboardTool.ZegoWhiteboardViewToolPen:case d.ZegoWhiteboardTool.ZegoWhiteboardViewToolLine:case d.ZegoWhiteboardTool.ZegoWhiteboardViewToolEllipse:case d.ZegoWhiteboardTool.ZegoWhiteboardViewToolRect:case d.ZegoWhiteboardTool.ZegoWhitebaordViewToolCustomImage:this.toolInstance.bindEventsHandle(d.ZegoWhiteboardTool.ZegoWhiteboardViewToolLine);break;case d.ZegoWhiteboardTool.ZegoWhiteboardViewToolLaser:this.toolInstance.bindEventsHandle(d.ZegoWhiteboardTool.ZegoWhiteboardViewToolLaser);break;case d.ZegoWhiteboardTool.ZegoWhiteboardViewToolText:this.toolInstance.bindEventsHandle(d.ZegoWhiteboardTool.ZegoWhiteboardViewToolText);break;case d.ZegoWhiteboardTool.ZegoWhiteboardViewToolSelector:this.toolInstance.getInstanceHandle(d.ZegoWhiteboardTool.ZegoWhiteboardViewToolSelector),this.toolInstance.bindEventsHandle(d.ZegoWhiteboardTool.ZegoWhiteboardViewToolSelector);break;case d.ZegoWhiteboardTool.ZegoWhiteboardViewToolEraser:this.toolInstance.getInstanceHandle(d.ZegoWhiteboardTool.ZegoWhiteboardViewToolEraser),this.toolInstance.bindEventsHandle(d.ZegoWhiteboardTool.ZegoWhiteboardViewToolEraser)}},e.prototype.initToolHandle=function(){this.toolInstance?this.penetrateEventHandle(this.whiteboardStore.basicState.type):(this.toolInstance=new a.Tool({whiteboardID:this.whiteboardID,conNode:this.parentDom,zoomNode:this.zoomNode,graphicsConNode:this.graphicsConNode,whiteboardNode:this.whiteboardNode,graphicsBoxConNode:this.graphicsBoxConNode,serviceHandle:this.serviceHandle,graphicList:this.graphicList,whiteboardStore:this.whiteboardStore,viewInfo:this.viewInfo}),this.toolInstance.getInstanceHandle(d.ZegoWhiteboardTool.ZegoWhiteboardViewToolLaser),this.toolInstance.getInstanceHandle(d.ZegoWhiteboardTool.ZegoWhiteboardViewToolLine),this.toolInstance.getInstanceHandle(d.ZegoWhiteboardTool.ZegoWhiteboardViewToolText),this.setToolType(this.whiteboardStore.basicState.type),this.hookSetToolType())},e.prototype.updateStateSizeHandle=function(e,t){var o=this.viewInfo.viewportWidth;e&&(this.whiteboardStore.basicState.size=e),t&&(this.whiteboardStore.basicState.fontSize=t);var i=this.whiteboardStore.basicState,r=i.size,a=i.fontSize;this.whiteboardStore.basicExtraState.drawSize=s.calSizeHandle(r,d.GraphicType.Line,o,!1),this.whiteboardStore.basicExtraState.drawFontSize=s.calSizeHandle(a,d.GraphicType.Text,o,!1)},e.prototype.calculateHandle=function(e,t,o){var i={viewWidth:0,viewHeight:0},r=this.getFileInfo();if(r){this.viewInfo.direction=d.ZegoWhiteboardViewScrollDirection.Vertical;var a=e.firstChild;if(a){var n=r.fileType,s="0"==e.getAttribute("data-mode"),h=Number(e.getAttribute("data-page")),l=a.clientWidth,c=a.clientHeight;if(l&&c||(l=+a.style.width.replace("px",""),c=+a.style.height.replace("px","")),i.viewWidth=l,i.viewHeight=c,n===d.FileType.PPTH5){var p=e.previousElementSibling;p&&(p.style.zIndex="0")}var g=s&&i.viewHeight>o;this.updateViewInfo({isScroll:s,isOriginScroll:g,page:1,pageCount:h})}return i}var u=this.serviceHandle.getAspectRatio(this.whiteboardID),f=Number(u.split(":")[0]),v=Number(u.split(":")[1]),m=Math.round(v/(f*o/t));if(m>=2)i.viewWidth=t,i.viewHeight=m*o,this.viewInfo.isScroll?this.viewInfo.isOriginScroll=!0:this.updateViewInfo({page:1,pageCount:m}),this.viewInfo.direction=d.ZegoWhiteboardViewScrollDirection.Vertical;else{var b=Math.round(f/(v*t/o));b>=2?(i.viewWidth=b*t,i.viewHeight=o,this.viewInfo.isScroll?this.viewInfo.isOriginScroll=!0:this.updateViewInfo({page:1,pageCount:b}),this.viewInfo.direction=d.ZegoWhiteboardViewScrollDirection.Horizontal):(i.viewWidth=t,i.viewHeight=o,this.viewInfo.direction=d.ZegoWhiteboardViewScrollDirection.Center)}return i},e.prototype.createGraphicsBox=function(){this.graphicsBoxConNode.innerHTML='\n        <div class="img-editor-box">\n            <div class="operation-point-desktop left-top cursor-nwse LT"></div>\n            <div class="operation-point-desktop right-top cursor-nesw RT"></div>\n            <div class="operation-point-desktop left-bottom cursor-nesw LB"></div>\n            <div class="operation-point-desktop right-bottom cursor-nwse RB"></div>\n            <div class="operation-point-desktop top cursor-ns T"></div>\n            <div class="operation-point-desktop right cursor-ew R"></div>\n            <div class="operation-point-desktop bottom cursor-ns B"></div>\n            <div class="operation-point-desktop left cursor-ew L"></div>\n        </div>\n        <div class="graphics-box"></div>'},e.prototype.createModule=function(e){var t=this,o=!!this.getFileInfo();this.viewInfo.isScroll=this.whiteboardStore.basicExtraState.scroll===d.ScrollMode.Scroll;var i=document.getElementById(e),r=i.clientWidth,a=i.clientHeight;this.serviceHandle.setViewportSize(this.whiteboardID,r,a),this.whiteboardNode=document.createElement("div"),this.whiteboardNode.id=""+this.whiteboardStore.reservedPrefix.whiteboard+this.whiteboardID;var n=this.calculateHandle(i,r,a),s=n.viewWidth,h=n.viewHeight;this.whiteboardNode.style.cssText="width: "+s+"px; height: "+h+"px;",this.serviceHandle.setSize(this.whiteboardID,s,h);var l=document.createDocumentFragment();[this.whiteboardStore.reservedPrefix.graphicsBgContainer,this.whiteboardStore.reservedPrefix.graphicsContainer,this.whiteboardStore.reservedPrefix.boxContainer].forEach((function(e){var o=document.createElement("div");o.id=""+e+t.whiteboardID,l.appendChild(o)}));var c=this.getElementChild(l);if(this.graphicsBgConNode=c[0],this.graphicsConNode=c[1],this.graphicsBoxConNode=c[2],this.createGraphicsBox(),this.whiteboardNode.appendChild(l),o)this.parentDom=i,this.zoomNode=i.parentNode,this.removeElement(i.querySelector("#"+this.whiteboardNode.id)),this.removeElement(i.children[0]),i.appendChild(this.whiteboardNode),this.viewInfo.isScroll&&i.addEventListener("scroll",this.scrollHandle),this.handleDocsviewEvent(i);else{var p=document.createElement("div");p.id=""+this.whiteboardStore.reservedPrefix.whiteboardZoom+this.whiteboardID,this.zoomNode=p;var g=document.createElement("div");g.id=""+this.whiteboardStore.reservedPrefix.whiteboardCon+this.whiteboardID,g.appendChild(this.whiteboardNode);var u=this.viewInfo.isScroll?this.viewInfo.direction===d.ZegoWhiteboardViewScrollDirection.Horizontal?"overflow: auto hidden;":"overflow: hidden auto;":"overflow: hidden";g.style.cssText="width: 100%; height: 100%;"+u,this.removeElement(i.querySelector("#"+g.id)),p.appendChild(g),i.appendChild(p),this.parentDom=g,this.viewInfo.isScroll&&g.addEventListener("scroll",this.scrollHandle)}this.updateViewInfo({viewportWidth:r,viewportHeight:a,viewWidth:s,viewHeight:h,zoom:1})},e.prototype.activitView=function(){var e;if(this.setActivited(!0),this.parentDom){var t=(null===(e=this.getFileInfo())||void 0===e?void 0:e.fileID)||"";n.Logger.setExtraConfig({wbId:this.whiteboardID,fileID:t});var o=this.parentDom.parentElement;if(o){var i=o.id;o=o.parentElement,Array.from(this.getElementChild(o)).forEach((function(e){e.style.display=e.id===i?"block":"none"}))}this.graphicsBgConNode.style.backgroundColor=t?"rgba(255,255,255,0)":this.whiteboardStore.basicState.bgColor}},e.prototype.updateViewInfo=function(e){Object.assign(this.viewInfo,e)},e.prototype.removeElement=function(e){if(e){var t=e.parentNode;t?t.removeChild(e):e.remove?e.remove():e.removeNode()}},e.prototype.getElementChild=function(e){return e.children||e.childNodes},e.prototype.clearSelectedHandle=function(){this.graphicsBoxConNode.querySelector(".graphics-box").style.display="none",this.graphicList.forEach((function(e){return e.selected=!1}))},e.prototype.setClassNameHandle=function(e){var t,o=this.whiteboardStore.reservedPrefix,i=o.whiteboard,r=o.whiteboardCon,a=o.whiteboardZoom;null===(t=this.zoomNode.parentNode)||void 0===t||t.querySelectorAll("[id^="+i+"]").forEach((function(t){-1===t.id.indexOf(""+r)&&-1===t.id.indexOf(""+a)&&(t.className=d.ZegoWhiteboardTool[e])}))},e.prototype.penetrateEventHandle=function(e){var t=this.getFileInfo();if(t&&t.fileType===d.FileType.PPTH5&&this.parentDom){var o=this.operationModes.none||e!==d.ZegoWhiteboardTool.ZegoWhiteboardViewToolClick?"initial":"none";this.parentDom.style.pointerEvents=o,this.graphicsBoxConNode.style.pointerEvents=o}},e.prototype.checkEmitScrollHandle=function(e,t,o,i){var r=this;null===this.scrollLogTimer&&n.Logger.info(h("mod.emit_scroll"),JSON.stringify({whiteboardID:this.whiteboardID,horizontalPercent:e,verticalPercent:t,step:o,notify:i})),clearTimeout(this.scrollLogTimer),this.scrollLogTimer=setTimeout((function(){n.Logger.info(h("mod.emit_scroll"),JSON.stringify({whiteboardID:r.whiteboardID,horizontalPercent:e,verticalPercent:t,step:o,notify:i})),clearTimeout(r.scrollLogTimer),r.scrollLogTimer=null}),100),this.emitScroll(e,t,1,!0)},e.prototype.afterScrollHandle=function(e){var t=this.whiteboardStore.basicState.type,o=d.ZegoWhiteboardTool.ZegoWhiteboardViewToolLaser,i=d.ZegoWhiteboardTool.ZegoWhiteboardViewToolSelector;if(t===o)this.toolInstance.getInstanceHandle(o).pushActualPlaceHandle();else if(t===i){this.toolInstance.getInstanceHandle(i).hideImageEditBox(!0)}e&&this.toolInstance.resetImageBox()},e.prototype.emitScroll=function(e,t,o,i){i&&this.serviceHandle.scroll(this.whiteboardID,e,t,o),this.serviceHandle.loadCurrentGraphics(this.whiteboardID,e,t)},e.prototype.jumpPage=function(e,t,o,i,r,a){n.Logger.info(h("mod.jump_page"),JSON.stringify({params:{left:e,top:t,hPercent:o,vPercent:i,step:r}}));var s=this.getFileInfo();if(!a&&this.viewInfo.pageCount>=1&&this.viewInfo.page<=this.viewInfo.pageCount){if(this.viewInfo.direction===d.ZegoWhiteboardViewScrollDirection.Horizontal){var l=Math.min(Math.floor(e/this.viewInfo.viewportWidth)+1,this.viewInfo.pageCount);this.updateViewInfo({offsetPageX:e,page:l}),this.setWhiteboardTransform(this.viewInfo.zoomTX,this.viewInfo.zoomTY)}else if(s&&this.parentDom){var c={action:"page",y:t*this.viewInfo.zoom,step:r,notify:a};this.parentDom.dispatchEvent(new CustomEvent("zegowbevent",{detail:c}))}else{l=Math.min(Math.floor(t/this.viewInfo.viewportHeight)+1,this.viewInfo.pageCount);this.updateViewInfo({offsetPageY:t,page:l}),this.setWhiteboardTransform(this.viewInfo.zoomTX,this.viewInfo.zoomTY)}this.afterScrollHandle()}s||this.serviceHandle.actionCustomListener("viewScroll",{id:this.whiteboardID,horizontalPercent:o,verticalPercent:i,page:this.getCurrentPage(),step:r})},e.prototype.handleDocsviewEvent=function(e){var t=this,o={action:"init",id:this.whiteboardID};e.dispatchEvent(new CustomEvent("zegowbevent",{detail:o})),e.addEventListener("zegodocsevent",(function(e){var o=e.detail,i=o.action;if(n.Logger.info(h("mod.zegodocsevent"),JSON.stringify(o)),"page"===i){var r=t.viewInfo,a=r.viewHeight,s=r.zoom,d=o.y,l=o.page,c=o.pageCount,p=o.scroll,g=o.step,u=o.notify,f=Number((d/s/a).toFixed(7));t.viewInfo.page=l,t.viewInfo.pageCount=c,p||(t.viewInfo.offsetPageY=d/s|0),u?t.emitScroll(0,f,g,!0):t.serviceHandle.updateCache({whiteboardID:t.whiteboardID,verticalPercent:f,pptStep:g}),t.serviceHandle.actionCustomListener("viewScroll",{id:t.whiteboardID,horizontalPercent:0,verticalPercent:f,page:l,step:g})}else if("zoomdrag"===i)t.viewInfo.isScroll&&(t.viewInfo.ticking=!o.notify);else if("targetclick"===i)t.serviceHandle.appendH5Extra(t.whiteboardID,o.data);else if("getAspectCache"===i){var v=e.detail.vpageAspecCache;t.viewInfo.vpageAspecCache=v}}))},e.prototype.hookSetToolType=function(){this.updateBindEvents(),this.clearSelectedHandle()},e.prototype.setDragStyle=function(e){if(this.parentDom){var t=this.operationModes.zoom&&0===e;this.parentDom.style.cursor=t?"move":"auto";var o={action:"drag",enable:this.operationModes.scroll,drag:t};this.parentDom.dispatchEvent(new CustomEvent("zegowbevent",{detail:o}))}},e.prototype.addImageGraphic=function(e,t,o){var i=this.toolInstance.getInstanceHandle(d.ZegoWhiteboardTool.ZegoWhiteboardViewToolLine),r=this.toolInstance.transLocationOrigin({clientX:t,clientY:o});return i.drawGraphicImage(e,r.clientX,r.clientY)},e.prototype.init=function(e){this.parentDom||this.createModule(e),this.initToolHandle(),this.updateBindEvents(),this.updateStateSizeHandle(),this.initDragEvents(),this.activitView();var t=this.serviceHandle.getScrollPercent(this.whiteboardID),o=t.horizontalPercent,i=t.verticalPercent,r=t.pptStep;this.scrollToHandle(o,i,r,!1),this.playAnimation(this.serviceHandle.getH5Extra(this.whiteboardID),!1),n.Logger.info(h("mod.init"),JSON.stringify({horizontalPercent:o,verticalPercent:i,step:r,result:this.viewInfo}))},e.prototype.setSelfSize=function(){var e=this.viewInfo,t=e.viewWidth,o=e.viewHeight;this.serviceHandle.setSize(this.whiteboardID,t,o)},e.prototype.setActivited=function(e){this.activited=e},e.prototype.isActivited=function(){return this.activited},e.prototype.scrollToHandle=function(e,t,o,i){var r=this;o=o||1;var a=this.viewInfo,n=a.zoom,s=a.viewWidth,h=a.viewHeight,l=Math.ceil(e*s),c=Math.ceil(t*h);if(this.emitScroll(e,t,o,i),this.viewInfo.isScroll&&this.parentDom){if(this.viewInfo.ticking=!0,this.viewInfo.direction===d.ZegoWhiteboardViewScrollDirection.Horizontal?(this.parentDom.scrollLeft=l*n,this.viewInfo.scrollX=l):(this.parentDom.scrollTop=c*n,this.viewInfo.scrollY=c),setTimeout((function(){return r.viewInfo.ticking=!1}),34),!i){var p={action:"page",y:c*this.viewInfo.zoom,step:o,notify:i};this.parentDom.dispatchEvent(new CustomEvent("zegowbevent",{detail:p}))}this.afterScrollHandle(!i)}else this.clearSelectedHandle(),this.jumpPage(l,c,e,t,o,i)},e.prototype.clearLaserHandle=function(e){this.toolInstance&&this.toolInstance.getInstanceHandle(d.ZegoWhiteboardTool.ZegoWhiteboardViewToolLaser).clearLaserHandle(e)},e.prototype.clearLocalHandle=function(){this.toolInstance.clearLocalHandle(),this.createGraphicsBox()},e.prototype.updateRemoteToLocal=function(e,t){this.toolInstance.updatePushLocalHandle(e,t)},e.prototype.destroyDomHandle=function(){if(this.parentDom){n.Logger.info(h("mod.destroy_dom"),JSON.stringify({domID:this.parentDom.id}));var e={action:"destroy",id:this.whiteboardID};this.parentDom.dispatchEvent(new CustomEvent("zegowbevent",{detail:e})),this.removeElement(this.parentDom.parentElement),this.parentDom=null}},e.prototype.playAnimation=function(e,t){var o,i={action:"targetclick",data:e,isPush:t};null===(o=this.parentDom)||void 0===o||o.dispatchEvent(new CustomEvent("zegowbevent",{detail:i}))},e.prototype.enable=function(e){e=!!e;var t=this.whiteboardStore.basicState.type;return this.toolInstance&&(this.toolInstance.canDraw=e&&!!t&&t!==d.ZegoWhiteboardTool.ZegoWhiteboardViewToolClick),e&&(this.operationModes.none=!1),this.operationModes.draw=e,this.setDragStyle(t),n.Logger.info(h("mod.enable"),JSON.stringify({params:e})),!0},e.prototype.isEnable=function(){return this.operationModes.draw},e.prototype.clear=function(){var e=this;if(!this.operationModes.none&&this.operationModes.draw){n.Logger.info(h("mod.clear"),JSON.stringify({whiteboardID:this.whiteboardID}));var t=r.transError(d.ZegoWhiteboardError.ZegoWhiteboardViewErrorClearFail),o=this.toolInstance.getInstanceHandle(d.ZegoWhiteboardTool.ZegoWhiteboardViewToolSelector);o.hideImageEditBox(),o.hideSelectBox(),this.serviceHandle.clearView(this.whiteboardID,(function(){try{e.clearLocalHandle(),n.Logger.info(h("mod.clear_cb"),"success")}catch(o){n.Logger.error(h("mod.clear_cb"),JSON.stringify(t)),e.serviceHandle.actionCustomListener("error",t)}}),(function(){n.Logger.error(h("mod.clear_cb"),JSON.stringify(t)),e.serviceHandle.actionCustomListener("error",t)}))}},e.prototype.clearCurrentPage=function(){!this.operationModes.none&&this.operationModes.draw&&this.toolInstance&&this.toolInstance.clearPage(this.viewInfo.page||1)},e.prototype.scroll=function(e,t){if(this.operationModes.none||!this.operationModes.scroll)return!1;if(isNaN(+e)||isNaN(+t)){var o=r.transError(d.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid,"参数错误: horizontalPercent、verticalPercent取值为0~1");return n.Logger.error(h("mod.scroll"),JSON.stringify(o)),this.serviceHandle.actionCustomListener("error",o),!1}if(n.Logger.info(h("mod.scroll"),JSON.stringify({params:{horizontalPercent:e,verticalPercent:t}})),e<0&&(e=0),e>1&&(e=1),t<0&&(t=0),t>1&&(t=1),e=Number(e.toFixed(7)),t=Number(t.toFixed(7)),n.Logger.info(h("mod.scroll"),JSON.stringify({transParams:{horizontalPercent:e,verticalPercent:t}})),this.viewInfo.pageCount>1&&this.viewInfo.page>0){if(this.parentDom&&this.getFileInfo()){var i={action:"page",vPercent:t,step:1,notify:!0};return this.parentDom.dispatchEvent(new CustomEvent("zegowbevent",{detail:i})),!0}if(this.viewInfo.direction===d.ZegoWhiteboardViewScrollDirection.Horizontal){var a=e*this.viewInfo.viewWidth|0;(s=Math.round(a/this.viewInfo.viewportWidth)+1)<=this.viewInfo.pageCount&&(this.updateViewInfo({offsetPageX:a,page:s}),this.setWhiteboardTransform(this.viewInfo.zoomTX,this.viewInfo.zoomTY),this.scrollToHandle(e,0,1,!0))}else{var s,l=t*this.viewInfo.viewHeight|0;(s=Math.round(l/this.viewInfo.viewportHeight)+1)<=this.viewInfo.pageCount&&(this.updateViewInfo({offsetPageY:l,page:s}),this.setWhiteboardTransform(this.viewInfo.zoomTX,this.viewInfo.zoomTY),this.scrollToHandle(0,t,1,!0))}}else this.viewInfo.isScroll&&this.scrollToHandle(e,t,1,!0);return!0},e.prototype.getCurrentScrollPercent=function(){return i(i({},this.serviceHandle.getScrollPercent(this.whiteboardID)),{direction:this.viewInfo.direction})},e.prototype.getHorizontalPercent=function(){return this.getCurrentScrollPercent().horizontalPercent},e.prototype.getVerticalPercent=function(){return this.getCurrentScrollPercent().verticalPercent},e.prototype.undo=function(){!this.operationModes.none&&this.operationModes.draw&&this.toolInstance.undoHandle()},e.prototype.redo=function(){!this.operationModes.none&&this.operationModes.draw&&this.toolInstance.redoHandle()},e.prototype.getAspectRatio=function(){return this.serviceHandle.getAspectRatio(this.whiteboardID)},e.prototype.getFileInfo=function(){return this.serviceHandle.getFileInfo(this.whiteboardID)},e.prototype.getID=function(){return this.whiteboardID},e.prototype.getName=function(){return this.serviceHandle.getModName(this.whiteboardID)},e.prototype.getCreateTime=function(){return this.serviceHandle.getCreateTime(this.whiteboardID)},e.prototype.getRoomID=function(){return this.serviceHandle.getRoomID(this.whiteboardID)},e.prototype.getPage=function(){return this.getCurrentPage()},e.prototype.getCurrentPage=function(){return this.viewInfo.page||1},e.prototype.getPageCount=function(){return this.viewInfo.pageCount||1},e.prototype.setBackgroundColor=function(e){if(this.operationModes.none||!this.operationModes.draw)return!1;if(n.Logger.info(h("mod.setBackgroundColor"),JSON.stringify({params:{color:e}})),!s.checkColor(e)){var t=r.transError(d.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid,"参数错误: color仅支持16进制、rgba");return n.Logger.error(h("mod.setBackgroundColor"),JSON.stringify(t)),this.serviceHandle.actionCustomListener("error",t),!1}return this.whiteboardStore.basicState.bgColor=e,this.graphicsBgConNode.style.backgroundColor=e,!0},e.prototype.getBackgroundColor=function(){return this.whiteboardStore.basicState.bgColor},e.prototype.setToolType=function(e){var t;if(this.operationModes.none)return!1;if(e=e||0,n.Logger.info(h("mod.setToolType"),JSON.stringify({params:e})),e===d.ZegoWhiteboardTool.ZegoWhiteboardViewToolClick&&(null===(t=this.getFileInfo())||void 0===t?void 0:t.fileType)!==d.FileType.PPTH5)return!1;if(-1!==Object.keys(d.ZegoWhiteboardTool).indexOf(""+e)||0===e)return this.toolInstance?(this.toolInstance.canDraw=this.operationModes.draw&&!!e&&e!==d.ZegoWhiteboardTool.ZegoWhiteboardViewToolClick,this.setClassNameHandle(e),this.setDragStyle(e),this.penetrateEventHandle(e),this.whiteboardStore.basicState.type===e||(this.whiteboardStore.basicState.type=e,this.hookSetToolType()),!0):(this.whiteboardStore.basicState.type=e,!0);var o=r.transError(d.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid);return n.Logger.error(h("mod.setToolType"),JSON.stringify(o)),this.serviceHandle.actionCustomListener("error",o),!1},e.prototype.getToolType=function(){return this.whiteboardStore.basicState.type||null},e.prototype.setBrushColor=function(e){if(this.operationModes.none||!this.operationModes.draw)return!1;if(n.Logger.info(h("mod.setBrushColor"),JSON.stringify({params:e})),!s.checkColor(e)){var t=r.transError(d.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid,"参数错误：color仅支持16进制、rgba");return n.Logger.error(h("mod.setBrushColor"),JSON.stringify(t)),this.serviceHandle.actionCustomListener("error",t),!1}return this.whiteboardStore.basicState.color=e,!0},e.prototype.getBrushColor=function(){return this.whiteboardStore.basicState.color},e.prototype.setBrushSize=function(e){if(this.operationModes.none||!this.operationModes.draw)return!1;if(n.Logger.info(h("mod.setBrushSize"),JSON.stringify({params:e})),s.checkBrushSize(e))return this.updateStateSizeHandle(e),!0;var t=r.transError(d.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid,"参数错误: 画笔粗细为100内的正整数");return n.Logger.error(h("mod.setBrushSize"),JSON.stringify(t)),this.serviceHandle.actionCustomListener("error",t),!1},e.prototype.getBrushSize=function(){return this.whiteboardStore.basicState.size},e.prototype.setTextSize=function(e){if(this.operationModes.none||!this.operationModes.draw)return!1;if(n.Logger.info(h("mod.setTextSize"),JSON.stringify({params:e})),s.checkTextSize(e))return this.updateStateSizeHandle(void 0,e),!0;var t=r.transError(d.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid,"参数错误: 文本大小为100内的正整数");return n.Logger.error(h("mod.setTextSize"),JSON.stringify(t)),this.serviceHandle.actionCustomListener("error",t),!1},e.prototype.setFontSize=function(e){return!(this.operationModes.none||!this.operationModes.draw)&&this.setTextSize(e)},e.prototype.getTextSize=function(){return this.whiteboardStore.basicState.fontSize},e.prototype.getFontSize=function(){return this.getTextSize()},e.prototype.setScaleFactor=function(e,t,o){var i=this,r=+e;if((!r||r<1)&&(r=1),!this.operationModes.none&&this.operationModes.zoom&&this.viewInfo.zoom!==r&&this.getToolType()!==d.ZegoWhiteboardTool.ZegoWhiteboardViewToolClick){if(n.Logger.info(h("mod.setScaleFactor"),JSON.stringify({params:{zoom:r,x:t,y:o}})),this.viewInfo.zoom=r,!this.getFileInfo()&&this.parentDom)if(this.viewInfo.isScroll){if(this.whiteboardNode.style.cssText+="transform:scale("+r+");",this.viewInfo.ticking=!0,this.viewInfo.direction===d.ZegoWhiteboardViewScrollDirection.Horizontal){var a=this.viewInfo.scrollX*r+this.viewInfo.viewportWidth*(r-1)*.5,s=this.viewInfo.viewportHeight*(r-1)*.5;this.emitScroll(a/r/this.viewInfo.viewWidth,0,1,!1),this.parentDom.scrollTo(a,s)}else{a=this.viewInfo.viewportWidth*(r-1)*.5,s=this.viewInfo.scrollY*r+this.viewInfo.viewportHeight*(r-1)*.5;this.emitScroll(0,s/r/this.viewInfo.viewHeight,1,!1),this.parentDom.scrollTo(a,s)}setTimeout((function(){return i.viewInfo.ticking=!1}),34)}else this.viewInfo.zoomTX=this.viewInfo.viewportWidth*(1-r)*.5|0,this.viewInfo.zoomTY=this.viewInfo.viewportHeight*(1-r)*.5|0,this.setWhiteboardTransform(this.viewInfo.zoomTX,this.viewInfo.zoomTY);if(this.parentDom){var l={action:"scale",zoom:r,x:t,y:o};this.parentDom.dispatchEvent(new CustomEvent("zegowbevent",{detail:l}))}this.toolInstance.reverseZoomHandle(d.ZegoWhiteboardTool.ZegoWhiteboardViewToolLaser),this.toolInstance.getInstanceHandle(d.ZegoWhiteboardTool.ZegoWhiteboardViewToolLaser).updateLaserConSize()}},e.prototype.getScaleFactor=function(){return{scaleFactor:this.viewInfo.zoom,scaleOffsetX:0,scaleOffsetY:0}},e.prototype.getScaleOffsetX=function(){return this.getScaleFactor().scaleOffsetX},e.prototype.getScaleOffsetY=function(){return this.getScaleFactor().scaleOffsetY},e.prototype.setFontItalic=function(e){if(this.operationModes.none||!this.operationModes.draw||"boolean"!=typeof e)return!1;var t=this.whiteboardStore.basicState.attributes,o=JSON.parse(t);return o.italic=e,this.whiteboardStore.basicState.attributes=JSON.stringify(o),n.Logger.info(h("mod.setFontItalic"),JSON.stringify({params:e,result:this.whiteboardStore.basicState.attributes})),!0},e.prototype.isFontItalic=function(){return JSON.parse(this.whiteboardStore.basicState.attributes).italic},e.prototype.setFontBold=function(e){if(this.operationModes.none||!this.operationModes.draw||"boolean"!=typeof e)return!1;n.Logger.info(h("mod.setFontBold"),JSON.stringify({params:e}));var t=this.whiteboardStore.basicState.attributes,o=JSON.parse(t);return o.bold=e,this.whiteboardStore.basicState.attributes=JSON.stringify(o),n.Logger.info(h("mod.setFontBold"),JSON.stringify({params:e,result:this.whiteboardStore.basicState.attributes})),!0},e.prototype.isFontBold=function(){return JSON.parse(this.whiteboardStore.basicState.attributes).bold},e.prototype.addText=function(e,t,o){if(!this.operationModes.none&&this.operationModes.draw&&this.getToolType()===d.ZegoWhiteboardTool.ZegoWhiteboardViewToolText)if(!e||!s.isNumber(t)||!s.isNumber(o)||t<0||o<0||t>this.viewInfo.viewportWidth||o>this.viewInfo.viewportHeight){var i=r.transError(d.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid);this.serviceHandle.actionCustomListener("error",i)}else{var a=this.toolInstance.getInstanceHandle(d.ZegoWhiteboardTool.ZegoWhiteboardViewToolText),l=this.toolInstance.transLocationOrigin({clientX:t,clientY:o});t=l.clientX,o=l.clientY,a.addTextGraphics(e,t,o,!0),n.Logger.info(h("mod.addText"),JSON.stringify({params:{text:e,positionX:t,positionY:o}}))}},e.prototype.enableUserOperation=function(e){if(e=!!e,this.operationModes.none===e){this.operationModes.none=!e,e||(this.operationModes.scroll=!1,this.operationModes.draw=!1,this.operationModes.zoom=!1),this.enable(e&&this.operationModes.draw);var t=this.whiteboardStore.basicState.type;this.setDragStyle(t),this.penetrateEventHandle(t)}n.Logger.info(h("mod.enableUserOperation"),JSON.stringify({params:e}))},e.prototype.deleteSelectedGraphics=function(){!this.operationModes.none&&this.operationModes.draw&&this.toolInstance.deleteSelectedGraphics()},e.prototype.addImage=function(e,t,o,i,a){var l=this,c=this.viewInfo.viewportWidth,p=this.viewInfo.viewportHeight,g=d.ZegoWhiteboardViewImageType.ZegoWhiteboardViewImageGraphic,u=d.ZegoWhiteboardViewImageType.ZegoWhiteboardViewImageCustom;if(this.operationModes.none||!this.operationModes.draw){var f=r.transError(d.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicUnableDraw);return Promise.reject(f)}if(!i||e!==g&&e!==u||!s.isNumber(t)||!s.isNumber(o)||e===g&&(t<0||o<0||t>c||o>p)||e===u&&"string"!=typeof i){f=r.transError(d.ZegoWhiteboardError.ZegoWhiteboardViewErrorParamInvalid);return Promise.reject(f)}var v=e===g?10485760:512e3;if("string"==typeof i){var m=i;if(!m.startsWith("https://")){f=r.transError(d.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicIllegalUrl);return Promise.reject(f)}return new Promise((function(a,s){var c=new XMLHttpRequest;c.open("HEAD",m,!0),c.onreadystatechange=function(){if(4==c.readyState){if(200!=c.status){var p=r.transError(d.ZegoWhiteboardError.ZegoWhiteboardViewErrorInvalidRsp);return s(p)}var g=(c.getResponseHeader("Content-Type")||"").replace("image/",""),f=+c.getResponseHeader("Content-Length");if(!"jpg,jpeg,png,svg+xml".includes(g)){p=r.transError(d.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport);return s(p)}if(f>v){p=r.transError(d.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicImageSizeLimit);return s(p)}if(n.Logger.info(h("mod.addImage"),JSON.stringify({params:{type:e,positionX:t,positionY:o,address:i}})),e===u){l.viewInfo.customImage={url:m,w:80,h:80};var b=new Image;b.onload=function(){l.viewInfo.customImage.w=b.width,l.viewInfo.customImage.h=b.height},b.src=m,a(m)}else l.addImageGraphic(m,t,o).then(a)}},c.onerror=function(){var e=r.transError(d.ZegoWhiteboardError.ZegoWhiteboardViewErrorInvalidRsp);s(e)},c.send(null)}))}if(this.serviceHandle.isElectron&&e===g&&"object"==typeof i)return i=i,n.Logger.info(h("mod.addImage"),JSON.stringify({params:{type:e,positionX:t,positionY:o,address:i.path}})),this.serviceHandle.uploadImage(i.path,a).then((function(e){return l.addImageGraphic(e,t,o)}));var b=(i=i).type.replace("image/","");if(!"jpg,jpeg,png,svg+xml".includes(b)){f=r.transError(d.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport);return Promise.reject(f)}if(i.size>v){f=r.transError(d.ZegoWhiteboardError.ZegoWhiteboardViewErrorGraphicImageSizeLimit);return Promise.reject(f)}return n.Logger.info(h("mod.addImage"),JSON.stringify({params:{type:e,positionX:t,positionY:o,address:i.name}})),this.serviceHandle.uploadImage(i,a).then((function(e){return l.addImageGraphic(e,t,o)}))},e.prototype.setWhiteboardOperationMode=function(e){if(e&&s.isNumber(e)){var t=!!(e%2),o=!t&&[2,6,10,14].includes(e),i=!t&&[4,6,12,14].includes(e),r=!t&&[8,10,12,14].includes(e);Object.assign(this.operationModes,{none:t,scroll:o,draw:i,zoom:r});var a=this.whiteboardStore.basicState.type;this.toolInstance&&(this.toolInstance.canDraw=i&&!!a&&a!==d.ZegoWhiteboardTool.ZegoWhiteboardViewToolClick),this.setDragStyle(a),this.penetrateEventHandle(a),n.Logger.info(h("mod.setWhiteboardOperationMode"),JSON.stringify({params:e,result:this.operationModes}))}},e}();t.ZegoWhiteboardViewImpl=l},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.ZegoWhiteboardViewErrorInternal=3000001]="ZegoWhiteboardViewErrorInternal",e[e.ZegoWhiteboardViewErrorParamInvalid=3000002]="ZegoWhiteboardViewErrorParamInvalid",e[e.ZegoWhiteboardViewErrorNetworkTimeout=3000003]="ZegoWhiteboardViewErrorNetworkTimeout",e[e.ZegoWhiteboardViewErrorNetworkDisconnect=3000004]="ZegoWhiteboardViewErrorNetworkDisconnect",e[e.ZegoWhiteboardViewErrorInvalidRsp=3000005]="ZegoWhiteboardViewErrorInvalidRsp",e[e.ZegoWhiteboardViewErrorRequestTooMany=3000006]="ZegoWhiteboardViewErrorRequestTooMany",e[e.ZegoWhiteboardViewErrorNoLoginRoom=3010001]="ZegoWhiteboardViewErrorNoLoginRoom",e[e.ZegoWhiteboardViewErrorUserNotExist=3010002]="ZegoWhiteboardViewErrorUserNotExist",e[e.ZegoWhiteboardViewErrorViewNotExist=3020001]="ZegoWhiteboardViewErrorViewNotExist",e[e.ZegoWhiteboardViewErrorViewCreateFail=3020002]="ZegoWhiteboardViewErrorViewCreateFail",e[e.ZegoWhiteboardViewErrorViewModifyFail=3020003]="ZegoWhiteboardViewErrorViewModifyFail",e[e.ZegoWhiteboardViewErrorViewNameLimit=3020004]="ZegoWhiteboardViewErrorViewNameLimit",e[e.ZegoWhiteboardViewErrorViewParentNotExist=3020005]="ZegoWhiteboardViewErrorViewParentNotExist",e[e.ZegoWhiteboardViewErrorViewNumLimit=3020006]="ZegoWhiteboardViewErrorViewNumLimit",e[e.ZegoWhiteboardViewErrorGraphicNotExist=3030001]="ZegoWhiteboardViewErrorGraphicNotExist",e[e.ZegoWhiteboardViewErrorGraphicCreateFail=3030002]="ZegoWhiteboardViewErrorGraphicCreateFail",e[e.ZegoWhiteboardViewErrorGraphicModifyFail=3030003]="ZegoWhiteboardViewErrorGraphicModifyFail",e[e.ZegoWhiteboardViewErrorGraphicUnableDraw=3030004]="ZegoWhiteboardViewErrorGraphicUnableDraw",e[e.ZegoWhiteboardViewErrorGraphicDataLimit=3030005]="ZegoWhiteboardViewErrorGraphicDataLimit",e[e.ZegoWhiteboardViewErrorGraphicNumLimit=3030006]="ZegoWhiteboardViewErrorGraphicNumLimit",e[e.ZegoWhiteboardViewErrorGraphicTextLimit=3030007]="ZegoWhiteboardViewErrorGraphicTextLimit",e[e.ZegoWhiteboardViewErrorGraphicImageSizeLimit=3030008]="ZegoWhiteboardViewErrorGraphicImageSizeLimit",e[e.ZegoWhiteboardViewErrorGraphicImageTypeNotSupport=3030009]="ZegoWhiteboardViewErrorGraphicImageTypeNotSupport",e[e.ZegoWhiteboardViewErrorGraphicIllegalUrl=3030010]="ZegoWhiteboardViewErrorGraphicIllegalUrl",e[e.ZegoWhiteboardViewErrorInitFail=3040001]="ZegoWhiteboardViewErrorInitFail",e[e.ZegoWhiteboardViewErrorGetListFail=3040002]="ZegoWhiteboardViewErrorGetListFail",e[e.ZegoWhiteboardViewErrorCreateFail=3040003]="ZegoWhiteboardViewErrorCreateFail",e[e.ZegoWhiteboardViewErrorDestroyFail=3040004]="ZegoWhiteboardViewErrorDestroyFail",e[e.ZegoWhiteboardViewErrorAttachFail=3040005]="ZegoWhiteboardViewErrorAttachFail",e[e.ZegoWhiteboardViewErrorClearFail=3040006]="ZegoWhiteboardViewErrorClearFail",e[e.ZegoWhiteboardViewErrorScrollFail=3040007]="ZegoWhiteboardViewErrorScrollFail",e[e.ZegoWhiteboardViewErrorUndoFail=3040008]="ZegoWhiteboardViewErrorUndoFail",e[e.ZegoWhiteboardViewErrorRedoFail=3040009]="ZegoWhiteboardViewErrorRedoFail"}(t.ZegoWhiteboardError||(t.ZegoWhiteboardError={})),function(e){e[e.ZegoWhiteboardViewToolPen=1]="ZegoWhiteboardViewToolPen",e[e.ZegoWhiteboardViewToolText=2]="ZegoWhiteboardViewToolText",e[e.ZegoWhiteboardViewToolLine=4]="ZegoWhiteboardViewToolLine",e[e.ZegoWhiteboardViewToolRect=8]="ZegoWhiteboardViewToolRect",e[e.ZegoWhiteboardViewToolEllipse=16]="ZegoWhiteboardViewToolEllipse",e[e.ZegoWhiteboardViewToolSelector=32]="ZegoWhiteboardViewToolSelector",e[e.ZegoWhiteboardViewToolEraser=64]="ZegoWhiteboardViewToolEraser",e[e.ZegoWhiteboardViewToolLaser=128]="ZegoWhiteboardViewToolLaser",e[e.ZegoWhiteboardViewToolClick=256]="ZegoWhiteboardViewToolClick",e[e.ZegoWhitebaordViewToolCustomImage=512]="ZegoWhitebaordViewToolCustomImage"}(t.ZegoWhiteboardTool||(t.ZegoWhiteboardTool={})),function(e){e[e.ZegoWhiteboardOperationModeNone=1]="ZegoWhiteboardOperationModeNone",e[e.ZegoWhiteboardOperationModeScroll=2]="ZegoWhiteboardOperationModeScroll",e[e.ZegoWhiteboardOperationModeDraw=4]="ZegoWhiteboardOperationModeDraw",e[e.ZegoWhiteboardOperationModeZoom=8]="ZegoWhiteboardOperationModeZoom"}(t.ZegoWhiteboardOperationMode||(t.ZegoWhiteboardOperationMode={})),function(e){e[e.ZegoWhiteboardViewImageGraphic=0]="ZegoWhiteboardViewImageGraphic",e[e.ZegoWhiteboardViewImageCustom=1]="ZegoWhiteboardViewImageCustom"}(t.ZegoWhiteboardViewImageType||(t.ZegoWhiteboardViewImageType={})),function(e){e[e.Center=0]="Center",e[e.Horizontal=1]="Horizontal",e[e.Vertical=2]="Vertical"}(t.ZegoWhiteboardViewScrollDirection||(t.ZegoWhiteboardViewScrollDirection={}))},function(e,t,o){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__spreadArrays||function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<o;t++)for(var a=arguments[t],n=0,s=a.length;n<s;n++,r++)i[r]=a[n];return i};Object.defineProperty(t,"__esModule",{value:!0});var a=o(2),n=o(0),s=o(23),d=o(24),h=o(25),l=o(26),c=o(27),p=o(1),g=p.getLogAction.bind(null,"wb.v."),u=function(){function e(e){this.mousePoints={sx:-1,sy:-1,ex:-1,ey:-1,boxX:0,boxY:0},this.instancesMap={},this.canDraw=!0;var t=e.whiteboardID,o=e.graphicList,i=e.zoomNode,r=e.conNode,a=e.serviceHandle,n=e.whiteboardStore,s=e.graphicsConNode,d=e.graphicsBoxConNode,h=e.viewInfo,l=e.whiteboardNode;this.whiteboardID=t,this.conNode=r,this.zoomNode=i,this.userNode=i.parentNode,this.graphicsConNode=s,this.whiteboardNode=l,this.graphicsBoxConNode=d,this.graphicList=o,this.serviceHandle=a,this.whiteboardStore=n,this.viewInfo=h,this.updateOffsetHandle(),this.updateScrollHandle(),this.initDrawHandle()}return e.prototype.transLocationHandle=function(e){var t=e.clientX,o=e.clientY,i=this.offsetData,r=i.offsetLeft,a=i.offsetTop,n=this.scrollData,s=n.scrollLeft,d=n.scrollTop,h=this.getPageTranslateXY(),l=h.x,c=h.y,p=this.viewInfo,g=p.zoom,u=p.offsetPageX,f=p.offsetPageY;return{clientX:Math.round((t-r+s-l)/g+u),clientY:Math.round((o-a+d-c)/g+f)}},e.prototype.transLocationOrigin=function(e){var t=e.clientX,o=e.clientY,i=this.viewInfo,r=i.offsetPageX,a=i.offsetPageY,n=this.viewInfo.scrollX||0,s=this.viewInfo.scrollY||0;return{clientX:Math.round(t+n+r),clientY:Math.round(o+s+a)}},e.prototype.bindEventsHandle=function(e){this.initDrawHandle();var t=this.instancesMap[e];t&&t.bindEventsHandle()},e.prototype.removeEventsHandle=function(e){var t=this.instancesMap[e];t&&t.removeEventsHandle()},e.prototype.moveGraphicsHandle=function(e,t,o,i){var r=this.getGraphicsHandle(e);if(r)if("g"===r.tagName){var n=a.getElementChild(r)[0];i=(i=n.getAttribute("transform")||"")&&i.includes("scale(")?i.replace(/.*(scale\(\d+(.\d+)?,(\s*)?\d+(.\d+)?\)).*/," $1"):"",n.setAttribute("transform","translate("+(t||0)+", "+(o||0)+")"+i)}else{var s="translate("+(t||0)+"px, "+(o||0)+"px)",d=r.style.transform.match(/scale\((\d*.?\d*)\)/),h=d?d[1]:"";!i&&h?s=s+" scale("+h+")":i&&(s=s+" scale("+i+")"),r.style.transform=s}},e.prototype.getGraphicsHandle=function(e,t){void 0===t&&(t=this.userNode);var o=this.getGraphicsSelHandle(e),i=t.querySelector(o);return i&&(i=i.parentNode),i},e.prototype.batchGetGraphicsHandle=function(e,t){return void 0===e&&(e=this.userNode),e.querySelectorAll("[id^="+t+"]")},e.prototype.getGraphicsSelHandle=function(e){return"#"+this.whiteboardStore.reservedPrefix.graphics+e},e.prototype.getBoxSelHandle=function(e){return"#"+this.whiteboardStore.reservedPrefix.graphicsBox+e},e.prototype.updateOffsetHandle=function(){this.offsetData=a.getOffsetData(this.conNode)},e.prototype.updateScrollHandle=function(){this.scrollData=a.getScrollData(this.conNode)},e.prototype.updateGraphicsOffsetHandle=function(e,t,o){var i=e.x,r=e.y;e.px=i,e.py=r,e.x=i+t,e.y=r+o},e.prototype.calMoveHandle=function(){var e=this.mousePoints,t=e.sx,o=e.sy,i=e.ex,r=e.ey;return-1!==t&&-1!==o?(this.mousePoints.boxX+=i-t,this.mousePoints.boxY+=r-o,[i-t,r-o]):[0,0]},e.prototype.updateMousePointsHandle=function(e,t){null==e||null==t?this.mousePoints={sx:-1,sy:-1,ex:-1,ey:-1,boxX:0,boxY:0}:(-1!==this.mousePoints.ex&&-1!==this.mousePoints.ey&&(this.mousePoints.sx=this.mousePoints.ex,this.mousePoints.sy=this.mousePoints.ey),this.mousePoints.ex=e,this.mousePoints.ey=t)},e.prototype.updateToRemoteHandle=function(e,t,o,i){var r=this;if(void 0===o&&(o=!0),e.length){var n=a.transGraphicsData(e,t);p.Logger.info(g("gra.draw"),JSON.stringify(n)),this.serviceHandle.updateToRemote(this.whiteboardID,n,(function(e){p.Logger.info(g("gra.draw_cb"),"error"),o&&r.updateLocalHandle(e)}),i)}},e.prototype.updateLocalHandle=function(e){var t=this;p.Logger.info(g("gra.draw_local"),JSON.stringify(e));var o=this.getInstanceHandle(n.ZegoWhiteboardTool.ZegoWhiteboardViewToolText),i=this.getInstanceHandle(n.ZegoWhiteboardTool.ZegoWhiteboardViewToolLine),r=this.getInstanceHandle(n.ZegoWhiteboardTool.ZegoWhiteboardViewToolSelector);r.hideImageEditBox(),r.hideSelectBox(),e.forEach((function(e){switch(e.action){case n.Action.Delete:t.deleteHandle(e.graphic_id);break;case n.Action.Create:t.createHandle(e,o,i),t.updateBoxHandle(e);break;case n.Action.Move:t.moveHandle(e,i),t.updateBoxHandle(e);break;case n.Action.Update:t.updateHandle(e,o,i),t.updateBoxHandle(e)}}))},e.prototype.updatePushLocalHandle=function(e,t){var o=this;p.Logger.info(g("gra.remote_draw"),JSON.stringify({graphicList:e,delGraphicList:t,actionMsg:"transValue"})),this.updateOffsetHandle(),this.updateScrollHandle(),e.sort((function(e,t){return(e.zorder||0)-(t.zorder||0)})),t.forEach((function(e){return o.deleteHandle(e)}));var r=this.instancesMap[n.ZegoWhiteboardTool.ZegoWhiteboardViewToolLaser],a=this.instancesMap[n.ZegoWhiteboardTool.ZegoWhiteboardViewToolText],s=this.instancesMap[n.ZegoWhiteboardTool.ZegoWhiteboardViewToolLine],d=this.instancesMap[n.ZegoWhiteboardTool.ZegoWhiteboardViewToolSelector];d&&(d.hideImageEditBoxByIds(t),d.hideImageEditBoxByList(e)),e.forEach((function(e){var t=e.graphic_id,d=e.type,h=o.graphicList.some((function(o){return t===o.graphic_id&&(Object.assign(o,e),d===n.GraphicType.Image&&Object.assign(o.data,e.data),!0)}));h||(d===n.GraphicType.Image&&(e.oldData=i({},e.data)),o.graphicList.push(e));var l="#"+o.whiteboardStore.reservedPrefix.graphicsBox+t;switch(h=h&&!!o.whiteboardNode.querySelector(l),d){case n.GraphicType.Laser:r.drawGraphicsHandle(e,!1);break;case n.GraphicType.Text:h?a.updateGraphicsHandle(e):a.drawGraphicsHandle(e,!1),o.updateBoxHandle(e);break;default:h?s.updateGraphicsHandle(e):s.drawGraphicsHandle(e,n.GraphicOperateType.Remote),o.updateBoxHandle(e)}}))},e.prototype.deleteHandle=function(e){a.removeElement(this.getBoxHandle(e));var t=this.getGraphicsHandle(e);a.removeElement("g"===(null==t?void 0:t.tagName)?t.parentNode:t);var o=this.graphicList.findIndex((function(t){return t.graphic_id===e}));-1!==o&&this.graphicList.splice(o,1)},e.prototype.createHandle=function(e,t,o){var i=e.graphic_id;if(!this.graphicList.some((function(e){return e.graphic_id===i})))switch(this.graphicList.push(e),e.type){case n.GraphicType.Text:t.drawGraphicsHandle(e,!1);break;default:o.drawGraphicsHandle(e,n.GraphicOperateType.UnReDo)}},e.prototype.moveHandle=function(e,t){var o=e.graphic_id,i=e.x,r=e.y,a=e.type;if(a===n.GraphicType.Image)this.assingImageGraphicData(e,n.Action.Move),t.updateGraphicsImage(e,n.GraphicOperateType.UnReDo);else{this.setDataToGraphicList(o,{x:i,y:r});var s=a===n.GraphicType.Laser?""+1/this.viewInfo.zoom:void 0;this.moveGraphicsHandle(o,i,r,s)}},e.prototype.updateHandle=function(e,t,o){switch(e.type){case n.GraphicType.Text:t.backUpdateGraphicsHandle(e);break;case n.GraphicType.Image:this.assingImageGraphicData(e,n.Action.Update),o.updateGraphicsImage(e,n.GraphicOperateType.UnReDo)}},e.prototype.assingImageGraphicData=function(e,t){var o=e.graphic_id;this.graphicList.some((function(i){if(i.graphic_id===o){if(Object.assign(i.data,e.data),Object.assign(i.oldData,e.oldData),t===n.Action.Move)i.x=e.x,i.y=e.y,i.px=e.px,i.py=e.py;else if(t===n.Action.Update){var r=i.data,a=r.x,s=r.y;i.initX=a-i.x,i.initY=s-i.y}return!0}return!1}))},e.prototype.updateBoxHandle=function(e,t){if(e.type===n.GraphicType.Laser)return!1;var o=this.getBoxInfoByGraphic(e);if(!o)return!1;var i=o.x,r=o.y,a=o.width,s=o.height,d=e.type,h=e.graphic_id,l=e.zorder,c=this.getBoxHandle(h);if(!c){(c=document.createElement("div")).setAttribute("id",""+this.whiteboardStore.reservedPrefix.graphicsBox+h),d===n.GraphicType.Text&&(c.style.pointerEvents="initial");var p=null;if(l)for(var g=this.graphicsBoxConNode.querySelectorAll("[data-z]"),u=0;u<g.length;u++)if(+(g[u].getAttribute("data-z")||"")>l){p=g[u];break}this.graphicsBoxConNode.insertBefore(c,p)}return"blur"!==t&&(c.style.left=i+"px",c.style.top=r+"px"),c.style.width=a+"px",c.style.height=s+"px",l&&c.setAttribute("data-z",l+""),!0},e.prototype.getInstanceHandle=function(e){var t=this.instancesMap[e];if(!t){switch(e){case n.ZegoWhiteboardTool.ZegoWhiteboardViewToolLaser:t=new s.Laser({toolInstance:this});break;case n.ZegoWhiteboardTool.ZegoWhiteboardViewToolLine:t=new d.SvgGraphics({toolInstance:this});break;case n.ZegoWhiteboardTool.ZegoWhiteboardViewToolText:t=new h.TextareaGraphics({toolInstance:this});break;case n.ZegoWhiteboardTool.ZegoWhiteboardViewToolEraser:t=new l.Eraser({toolInstance:this});break;case n.ZegoWhiteboardTool.ZegoWhiteboardViewToolSelector:t=new c.Selector({toolInstance:this})}this.instancesMap[e]=t}return t},e.prototype.getBoxHandle=function(e){var t=this.getBoxSelHandle(e);return this.userNode.querySelector(t)},e.prototype.getUserName=function(){return this.serviceHandle.getUserName()},e.prototype.setGraphicsDomZorder=function(e){var t=e.graphic_id,o=e.type,i=e.zorder,r=this.whiteboardStore.reservedPrefix,a=r.textareaCon,s=r.graphicsSvg,d=r.graphicsBox,h=o===n.GraphicType.Text?"#"+a+t:"#"+s+t,l=this.whiteboardNode.querySelector(h);l&&i&&l.setAttribute("data-z",i+""),h="#"+d+t,(l=this.whiteboardNode.querySelector(h))&&i&&l.setAttribute("data-z",i+"")},e.prototype.appendGraphicsDomHandle=function(e,t){if(n.GraphicType.Laser===t)this.graphicsConNode.appendChild(e);else{var o=+(e.getAttribute("data-z")||"");if(o)for(var i=this.graphicsConNode.querySelectorAll("[data-z]"),r=0;r<i.length;r++)if(+(i[r].getAttribute("data-z")||"")>o)return void this.graphicsConNode.insertBefore(e,i[r]);var a=this.graphicsConNode.querySelector("[id^="+this.whiteboardStore.reservedPrefix.laserCon+"]");this.graphicsConNode.insertBefore(e,a)}},e.prototype.appendImageDomHandle=function(e,t){var o=this.whiteboardStore.reservedPrefix,i=o.graphicsSvg,r=o.graphics,a=o.laserCon,n=o.graphicsBox,s=""+i+e,d=""+r+e,h=document.createElementNS("http://www.w3.org/2000/svg","svg"),l=document.createElementNS("http://www.w3.org/2000/svg","g"),c=document.createElementNS("http://www.w3.org/2000/svg","image");h.id=s,h.setAttribute("xmlns","http://www.w3.org/2000/svg"),h.setAttribute("version","1.1"),h.appendChild(l),c.id=d;var p=document.createElement("div");if(p.setAttribute("id",""+n+e),t){h.setAttribute("data-z",t+""),p.setAttribute("data-z",t+"");for(var g=this.graphicsConNode.querySelectorAll("[data-z]"),u=0;u<g.length;u++)if(+(g[u].getAttribute("data-z")||"")>t){this.graphicsConNode.insertBefore(h,g[u]);var f=this.graphicsBoxConNode.querySelectorAll("[data-z]")[u];return this.graphicsBoxConNode.insertBefore(p,f),[l,c,p]}}var v=this.graphicsConNode.querySelector("[id ^= "+a+"]");return this.graphicsConNode.insertBefore(h,v),this.graphicsBoxConNode.appendChild(p),[l,c,p]},e.prototype.resetImageBox=function(){var e=this;this.graphicList.forEach((function(t){if(t.type===n.GraphicType.Image){var o=e.getBoxHandle(t.graphic_id),i=t.y+(t.initY||0);o&&Math.abs(Number(o.style.top.replace("px",""))-i)>3&&e.updateBoxHandle(t)}}))},e.prototype.checkMultipointHandle=function(e){return e.touches.length>1},e.prototype.downCommonHandle=function(e){if(this.whiteboardStore.platform===n.Platform.Mobile){if(this.checkMultipointHandle(e))return!1;e.preventDefault()}else if(e instanceof MouseEvent&&"mouseup"!==e.type&&!e.buttons)return!1;return this.updateOffsetHandle(),this.updateScrollHandle(),!0},e.prototype.updateProtoGraphic=function(e){if(e)Object.assign(this.protoGraphic,e);else{var t=this.whiteboardStore.basicState.type;this.protoGraphic=i(i({graphic_id:"",data:[],oldData:"",selected:!1,x:0,y:0,px:0,py:0},this.whiteboardStore.basicState),{type:t})}},e.prototype.updateGraphicsDataHandle=function(e){var t=null;switch(this.protoGraphic.type){case n.GraphicType.Pencil:(t=this.protoGraphic.data).push(e.clientX),t.push(e.clientY);break;case n.GraphicType.Image:(t=this.protoGraphic.data).ex=e.clientX,t.ey=e.clientY;break;default:(t=this.protoGraphic.data).splice(2,2,e.clientX,e.clientY)}},e.prototype.initDrawHandle=function(){this.updateProtoGraphic(),this.updateMousePointsHandle()},e.prototype.getBoxInfoByGraphic=function(e){var t=e.type,o=e.graphic_id,i=this.getGraphicsHandle(o);if(!i)return null;var r=t===n.GraphicType.Text||t===n.GraphicType.Image?0:e.size||this.whiteboardStore.basicState.size,a=this.viewInfo.zoom,s=this.whiteboardStore.boxBorderWidth,d=i.getBoundingClientRect(),h=d.left,l=d.top,c=d.width,p=d.height,g=this.transLocationHandle({clientX:h,clientY:l}),u=g.clientX,f=g.clientY;return{x:h=Math.floor(u-s-r/2),y:l=Math.floor(f-s-r/2),width:c=Math.ceil(c/a+r+s),height:p=Math.ceil(p/a+r+s)}},e.prototype.getMouseStartPoint=function(e){var t;if(this.whiteboardStore.platform===n.Platform.Pc){var o=e,i=o.clientX,r=o.clientY;t=this.transLocationHandle({clientX:i,clientY:r})}else{var a=e.touches[0];i=a.clientX,r=a.clientY;t=this.transLocationHandle({clientX:i,clientY:r})}return t},e.prototype.getMouseChangedPoint=function(e){var t;if(this.whiteboardStore.platform===n.Platform.Pc){var o=e,i=o.clientX,r=o.clientY;t=this.transLocationHandle({clientX:i,clientY:r})}else{var a=e.changedTouches[0];i=a.clientX,r=a.clientY;t=this.transLocationHandle({clientX:i,clientY:r})}return t},e.prototype.setDataToGraphicList=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];for(var i=0,a=this.graphicList.length;i<a;i++){var n=this.graphicList[i];if(e===n.graphic_id){Object.assign.apply(Object,r([n],t));break}}},e.prototype.getDataFromGraphicList=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];for(var i={},r=function(o,r){var n=a.graphicList[o];if(e===n.graphic_id)return t.forEach((function(e){i[e]=n[e]})),"break"},a=this,n=0,s=this.graphicList.length;n<s;n++){var d=r(n,s);if("break"===d)break}return i},e.prototype.filterExistingHandle=function(e){var t=this;return e.filter((function(e){var o=e.graphic_id;return e.action===n.Action.Create||t.graphicList.some((function(e){return e.graphic_id===o}))}))},e.prototype.undoHandle=function(){var e=this;this.serviceHandle.undo(this.whiteboardID,(function(t,o){var i=e.filterExistingHandle(t);return o&&(e.updateLocalHandle(i),p.Logger.info(g("gra.undo_cb"),"success")),i}),(function(t){e.updateLocalHandle(t),p.Logger.info(g("gra.undo_cb"),"error")}))},e.prototype.redoHandle=function(){var e=this;this.serviceHandle.redo(this.whiteboardID,(function(t){e.updateLocalHandle(t),p.Logger.info(g("gra.redo_cb"),"success")}),(function(t){e.updateLocalHandle(t),p.Logger.info(g("gra.redo_cb"),"error")}))},e.prototype.clearLocalHandle=function(){var e=this.getInstanceHandle(n.ZegoWhiteboardTool.ZegoWhiteboardViewToolLaser),t=e.findLaserHandle();this.graphicList.length=0,this.graphicsConNode.innerHTML="",t&&e.addLaserHandle(t)},e.prototype.reverseZoomHandle=function(e){var t=this;if(e===n.ZegoWhiteboardTool.ZegoWhiteboardViewToolLaser){var o=this.viewInfo.zoom,i=this.whiteboardStore.reservedPrefix.laserCon;this.batchGetGraphicsHandle(this.graphicsConNode,i).forEach((function(e){var i=e.style.transform,r=t.getTranslateXY(i),a=r.x,n=r.y;e.style.transform="translate("+a+"px, "+n+"px) scale("+1/o+")"}))}},e.prototype.getTranslateXY=function(e){if(!e)return{x:0,y:0};var t=e.match(/translate\((-?\d*.?\d*)px(\,\s*(-?\d*.?\d*)px)?\)/);return{x:+t[1]||0,y:+t[3]||0}},e.prototype.getPageTranslateXY=function(){var e=this.viewInfo,t=e.zoom,o=e.isScroll,i=e.direction,r=e.page,a=e.viewportWidth,s=e.viewportHeight,d=0,h=0;if(!o){var l=this.whiteboardNode.style.transform;if(l){var c=this.getTranslateXY(l);i===n.ZegoWhiteboardViewScrollDirection.Horizontal?(d=c.x+((r||1)-1)*a*t,h=c.y):(d=c.x,h=c.y+((r||1)-1)*s*t)}}return{x:d,y:h}},e.prototype.clearPage=function(e){this.updateGraphicPage(),this.graphicList.forEach((function(t){var o;(null===(o=t.page)||void 0===o?void 0:o.includes(e))?t.selected=!0:t.selected=!1})),this.deleteSelectedGraphics("clearPage")},e.prototype.deleteSelectedGraphics=function(e){var t=this;if(this.canDraw||"clearPage"===e){var o=this.graphicList.filter((function(e){return!!e.selected}));o.length&&this.updateToRemoteHandle(o,n.Action.Delete,!0,(function(){var e=t.getInstanceHandle(n.ZegoWhiteboardTool.ZegoWhiteboardViewToolSelector);e.hideImageEditBox(),e.hideSelectBox(),o.forEach((function(e){return t.deleteHandle(e.graphic_id)})),p.Logger.info(g("mod.deleteSelectedGraphics"),JSON.stringify({page:t.viewInfo.page,params:o.map((function(e){return e.graphic_id+","+e.page}))}))}))}},e.prototype.updateGraphicPage=function(){var e=this,t=this.graphicList.filter((function(t){return e.graphicsBoxConNode.querySelector(e.getBoxSelHandle(t.graphic_id))}));this.viewInfo.vpageAspecCache?t.forEach((function(t){var o=e.graphicsBoxConNode.querySelector(e.getBoxSelHandle(t.graphic_id)),i=o||{offsetTop:0,offsetHeight:0},r=i.offsetTop,a=i.offsetHeight,n=e.getPageByAspec(r,r+a);t.page=n||[e.viewInfo.page||1]})):!this.serviceHandle.getFileInfo(this.whiteboardID)&&this.conNode?t.forEach((function(t){var o=e.graphicsBoxConNode.querySelector(e.getBoxSelHandle(t.graphic_id)),i=[];if(1===e.viewInfo.direction){var r=o||{offsetLeft:0,offsetWidth:0},a=r.offsetLeft,n=r.offsetWidth;i=e.getPageByViewInfo(a,a+n,e.viewInfo.viewportWidth)}else{var s=o||{offsetTop:0,offsetHeight:0},d=s.offsetTop,h=s.offsetHeight;i=e.getPageByViewInfo(d,d+h,e.viewInfo.viewportHeight)}t.page=i||[e.viewInfo.page||1]})):this.graphicList.forEach((function(t){t.page=[e.viewInfo.page||1]}))},e.prototype.getPageByAspec=function(e,t){var o=this.viewInfo.vpageAspecCache;if(!o.hasOwnProperty("2"))return[1];for(var i=o.vs,a=o[i].h;a<=e&&o[i+1];)a+=o[i+1].h,i++;for(var n=i;a<=t&&o[n+1];)a+=o[n+1].h,n++;if(n===i)return[o[i].p];if(n-i>1){var s=new Array(n-i-1).fill(null);return s=s.map((function(e,t){return o[i+t+1].p})),r([o[i].p],s,[o[n].p])}return[o[i].p,o[n].p]},e.prototype.getPageByViewInfo=function(e,t,o){var i=Math.floor(e/o)+1,a=Math.floor(t/o)+1;if(a===i)return[i];if(a-i>1){var n=new Array(a-i-1).fill(null).map((function(e,t){return i+t+1}));return r([i],n,[a])}return[i,a]},e}();t.Tool=u},function(e,t,o){var i;!function(){"use strict";function r(e,t,o){var i=t.x,r=t.y,a=o.x-i,n=o.y-r;if(0!==a||0!==n){var s=((e.x-i)*a+(e.y-r)*n)/(a*a+n*n);s>1?(i=o.x,r=o.y):s>0&&(i+=a*s,r+=n*s)}return(a=e.x-i)*a+(n=e.y-r)*n}function a(e,t){var o=e.length-1,i=[e[0]];return function e(t,o,i,a,n){for(var s,d=a,h=o+1;h<i;h++){var l=r(t[h],t[o],t[i]);l>d&&(s=h,d=l)}d>a&&(s-o>1&&e(t,o,s,a,n),n.push(t[s]),i-s>1&&e(t,s,i,a,n))}(e,0,o,t,i),i.push(e[o]),i}function n(e,t,o){if(e.length<=2)return e;var i=void 0!==t?t*t:1;return e=a(e=o?e:function(e,t){for(var o,i,r,a,n,s=e[0],d=[s],h=1,l=e.length;h<l;h++)o=e[h],r=s,a=void 0,n=void 0,a=(i=o).x-r.x,n=i.y-r.y,a*a+n*n>t&&(d.push(o),s=o);return s!==o&&d.push(o),d}(e,i),i)}void 0===(i=function(){return n}.call(t,o,t,e))||(e.exports=i)}()},function(e,t,o){e.exports=function(e,t){var o,i,r,a,n,s,d,h;for(o=3&e.length,i=e.length-o,r=t,n=3432918353,s=461845907,h=0;h<i;)d=255&e.charCodeAt(h)|(255&e.charCodeAt(++h))<<8|(255&e.charCodeAt(++h))<<16|(255&e.charCodeAt(++h))<<24,++h,r=27492+(65535&(a=5*(65535&(r=(r^=d=(65535&(d=(d=(65535&d)*n+(((d>>>16)*n&65535)<<16)&4294967295)<<15|d>>>17))*s+(((d>>>16)*s&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(d=0,o){case 3:d^=(255&e.charCodeAt(h+2))<<16;case 2:d^=(255&e.charCodeAt(h+1))<<8;case 1:r^=d=(65535&(d=(d=(65535&(d^=255&e.charCodeAt(h)))*n+(((d>>>16)*n&65535)<<16)&4294967295)<<15|d>>>17))*s+(((d>>>16)*s&65535)<<16)&4294967295}return r^=e.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}},function(e,t,o){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),a=o(2),n=function(){function e(e){var t=this;this.bindFlag=!1,this.eventList=[{name:"moveEventName",handle:"mousemoveHandle"},{name:"leaveEventName",handle:"mouseleaveHandle"}],this.laserInfo={hiddenX:-100,hiddenY:-100,initX:0,initY:0},this.mousemoveHandle=function(e){if(t.toolInstance.canDraw){t.drawLaserMoveBeforeHandle();var o=t.getMouseChangedPoint(e),i=t.addLaserHandle(void 0,o);i.x=o.clientX,i.y=o.clientY,t.drawGraphicsHandle(i,!0),t.toolInstance.updateToRemoteHandle([t.calLaserActualPlaceHandle(i)],r.Action.Move,!1)}},this.mouseleaveHandle=function(){t.toolInstance.canDraw&&t.laserHiddenHandle()},this.wheelHandle=function(e){var o;if(t.toolInstance.canDraw){e.preventDefault();var i=t.toolInstance,r=i.whiteboardID,a=i.whiteboardStore.reservedPrefix.whiteboard,n=null===(o=document.querySelector("#"+a+r))||void 0===o?void 0:o.parentNode,s=n.getBoundingClientRect(),d=s.width;s.height!==n.scrollHeight&&(n.scrollTop+=Number(e.deltaY.toFixed(7))),d!==n.scrollWidth&&(n.scrollLeft+=Number(e.deltaX.toFixed(7)))}};var o=e.toolInstance;this.toolInstance=o,this.laserContainerNode=this.addLaserConDomHandle(),this.updateZIndexHandle(-1)}return e.prototype.transLocationHandle=function(e){var t=e.clientX,o=e.clientY,i=this.toolInstance,r=i.offsetData,a=i.scrollData,n=r.offsetLeft,s=r.offsetTop,d=a.scrollTop,h=a.scrollLeft,l=this.toolInstance.conNode,c=l.scrollLeft,p=l.scrollTop;return{clientX:Math.round(t-n+h-c),clientY:Math.round(o-s+d-p)}},e.prototype.getMouseChangedPoint=function(e){var t;if(this.toolInstance.whiteboardStore.platform===r.Platform.Pc){var o=e,i=o.clientX,a=o.clientY;t=this.transLocationHandle({clientX:i,clientY:a})}else{var n=e.changedTouches[0];i=n.clientX,a=n.clientY;t=this.transLocationHandle({clientX:i,clientY:a})}return t},e.prototype.drawLaserMoveBeforeHandle=function(){this.toolInstance.updateOffsetHandle(),this.toolInstance.updateScrollHandle()},e.prototype.laserHiddenHandle=function(e){var t=this.findLaserHandle(e);if(t){var o=this.laserInfo,i=o.hiddenX,a=o.hiddenY;Object.assign(t,{x:i,y:a,px:0,py:0}),this.toolInstance.moveGraphicsHandle(t.graphic_id,i,a),e||this.toolInstance.updateToRemoteHandle([t],r.Action.Move,!1)}},e.prototype.addLaserHandle=function(e,t){var o=this.toolInstance,n=o.whiteboardStore,s=o.graphicList;if(!e){var d=this.findLaserHandle();if(d)return d;var h=this.laserInfo,l=h.initX,c=h.initY,p=h.hiddenX,g=h.hiddenY;e=i(i({graphic_id:a.createGraphicId()},n.basicState),{type:r.GraphicType.Laser,x:p,y:g,px:0,py:0,data:[l,c],zorder:this.toolInstance.serviceHandle.createZorder()})}return s.push(e),this.drawGraphicsHandle(e,!0),this.toolInstance.updateToRemoteHandle([this.calLaserActualPlaceHandle(e)],r.Action.Create,!1),e},e.prototype.findLaserHandle=function(e){var t=this;return this.toolInstance.graphicList.filter((function(o){return e?o.graphic_id===e:o.type===r.GraphicType.Laser&&(!o.id_name||o.id_name===t.toolInstance.getUserName())}))[0]},e.prototype.addLaserConDomHandle=function(){var e=this.toolInstance,t=e.whiteboardID,o=""+e.whiteboardStore.reservedPrefix.laserContainer+t,i=this.toolInstance.userNode.querySelector("#"+o);return i||((i=document.createElement("div")).id=o,this.toolInstance.zoomNode.appendChild(i),this.updateLaserConSize(i),i)},e.prototype.updateZIndexHandle=function(e){this.laserContainerNode.style.zIndex=""+e,this.laserContainerNode.style.visibility=-1===e?"hidden":"visible"},e.prototype.drawGraphicsHandle=function(e,t){var o=this.toolInstance.getUserName(),i=e.graphic_id,a=e.data,n=e.id_name,s=e.x,d=e.y;if(n===o&&!t){t=!0;var h=this.calLaserPlaceHandle(s,d),l=h.x,c=h.y;e.x=l,e.y=c,s=l,d=c}var p=this.toolInstance.whiteboardStore.reservedPrefix,g=""+p.graphics+i,u=""+p.laserCon+i,f=this.toolInstance.userNode.querySelector("#"+g);if(!f){f=document.createElement("div");var v=document.createElement("div");f.id=g,v.id=u,v.appendChild(f),t?this.laserContainerNode.appendChild(v):this.toolInstance.appendGraphicsDomHandle(v,r.GraphicType.Laser)}var m="transform:translate("+(s||0)+"px, "+(d||0)+"px)"+(t?";":"scale("+1/this.toolInstance.viewInfo.zoom+");")+"left:"+a[0]+"px;top:"+a[1]+"px;";f.parentNode.style.cssText=m},e.prototype.bindEventsHandle=function(){var e=this;if(this.updateZIndexHandle("initial"),!this.bindFlag){this.bindFlag=!0;var t=this.toolInstance.whiteboardStore;this.eventList.forEach((function(o){var i=o.name,r=o.handle;e.laserContainerNode.addEventListener(t[i],e[r])})),t.platform===r.Platform.Pc&&this.toolInstance.viewInfo.isScroll&&this.laserContainerNode.addEventListener(t.wheelEventName,this.wheelHandle)}},e.prototype.removeEventsHandle=function(){var e=this;if(this.bindFlag){this.bindFlag=!1,this.updateZIndexHandle(-1);var t=this.toolInstance.whiteboardStore;this.eventList.forEach((function(o){var i=o.name,r=o.handle;e.laserContainerNode.removeEventListener(t[i],e[r])})),this.laserContainerNode.removeEventListener(t.wheelEventName,this.wheelHandle)}},e.prototype.calLaserActualPlaceHandle=function(e){var t=(e=JSON.parse(JSON.stringify(e))).x,o=e.y,i=this.toolInstance.viewInfo,r=i.zoom,a=i.zoomTX,n=i.zoomTY,s=i.offsetPageX,d=i.offsetPageY,h=this.toolInstance.conNode,l=h.scrollLeft,c=h.scrollTop;return e.x=Math.round((t+l-a)/r+s),e.y=Math.round((o+c-n)/r+d),e},e.prototype.calLaserPlaceHandle=function(e,t){var o=this.toolInstance.viewInfo,i=o.zoom,r=o.zoomTX,a=o.zoomTY,n=o.offsetPageX,s=o.offsetPageY,d=this.toolInstance.conNode,h=d.scrollLeft,l=d.scrollTop;return{x:e=Math.round((e-n)*i+r-h),y:t=Math.round((t-s)*i+a-l)}},e.prototype.pushActualPlaceHandle=function(){this.toolInstance.updateScrollHandle();var e=this.findLaserHandle();e&&this.toolInstance.updateToRemoteHandle([this.calLaserActualPlaceHandle(e)],r.Action.Move,!1)},e.prototype.clearLaserHandle=function(e){var t;(t=e?this.toolInstance.graphicList.filter((function(t){return t.id_name===e}))[0]:this.findLaserHandle())&&(this.toolInstance.deleteHandle(t.graphic_id),this.toolInstance.updateToRemoteHandle([t],r.Action.Delete))},e.prototype.updateLaserConSize=function(e){var t;e=e||this.laserContainerNode;var o=this.toolInstance,i=o.whiteboardID,r=o.whiteboardStore.reservedPrefix.whiteboard,a=null===(t=document.querySelector("#"+r+i))||void 0===t?void 0:t.parentNode,n=a.getBoundingClientRect(),s=n.width,d=n.height,h="z-index: "+(e.style.zIndex||"initial")+";";d!==a.scrollHeight&&(h+="width:"+(s-18)+"px;"),s!==a.scrollWidth&&(h+="height:"+(d-18)+"px;"),e.style.cssText=h},e}();t.Laser=n},function(e,t,o){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),a=o(2),n=function(){function e(e){var t=this;this.bindFlag=!1,this.eventList=[{name:"downEventName",handle:"mousedownHandle"},{name:"moveEventName",handle:"mousemoveHandle"},{name:"upEventName",handle:"mouseupHandle"},{name:"leaveEventName",handle:"mouseupHandle"}],this.mousedownHandle=function(e){var o=t.toolInstance,n=o.whiteboardNode,s=o.whiteboardStore;if(o.canDraw&&t.toolInstance.downCommonHandle(e)){var d=t.toolInstance.getMouseStartPoint(e),h=d.clientX,l=d.clientY,c=s.basicState.type===r.ZegoWhiteboardTool.ZegoWhitebaordViewToolCustomImage&&t.toolInstance.viewInfo.customImage?r.GraphicType.Image:s.basicState.type,p=c===r.GraphicType.Image?{x:h,y:l,ex:0,ey:0,url:t.toolInstance.viewInfo.customImage.url,hash:""}:[h,l];t.toolInstance.updateMousePointsHandle(h,l),t.toolInstance.updateProtoGraphic(i(i({graphic_id:a.createGraphicId()},s.basicState),{type:c,x:0,y:0,px:0,py:0,data:p})),n.addEventListener(s.moveEventName,t.mousemoveHandle)}},this.mousemoveHandle=function(e){if(t.toolInstance.canDraw){var o=t.toolInstance,i=o.protoGraphic,a=o.whiteboardStore,n=o.whiteboardNode;if(e instanceof MouseEvent&&!e.buttons)return n.removeEventListener(a.moveEventName,t.mousemoveHandle),t.toolInstance.deleteHandle(i.graphic_id),void t.toolInstance.initDrawHandle();var s=t.toolInstance.getMouseChangedPoint(e);t.toolInstance.updateGraphicsDataHandle(s);var d=t.toolInstance.protoGraphic.type===r.GraphicType.Image?r.ZegoWhiteboardViewImageType.ZegoWhiteboardViewImageCustom:void 0;t.drawGraphicsHandle(t.toolInstance.protoGraphic,r.GraphicOperateType.Local,d)}},this.mouseupHandle=function(){if(t.toolInstance.canDraw){var e=t.toolInstance,o=e.protoGraphic,n=e.whiteboardStore,s=e.graphicList;e.whiteboardNode.removeEventListener(n.moveEventName,t.mousemoveHandle);var d=o.graphic_id,h=o.type;if(d&&t.toolInstance.updateBoxHandle(o)){if(h===r.GraphicType.Pencil){var l=t.toolInstance.getGraphicsHandle(d);if(!l)return;var c=a.simplifyPathData(o.data);a.getElementChild(l)[0].setAttribute("d",a.mapGraphicsData(r.GraphicType.Pencil,c).d),t.toolInstance.updateProtoGraphic({data:c})}else if(h===r.GraphicType.Image){var p=o.data,g=p.x,u=p.y,f=p.ex,v=p.ey;if(g===f||u===v)return t.toolInstance.deleteHandle(o.graphic_id),void t.toolInstance.initDrawHandle();t.checkImageRect(p),o.initX=p.x,o.initY=p.y,o.oldData=i({},p)}o.zorder=t.toolInstance.serviceHandle.createZorder();var m=JSON.parse(JSON.stringify(o));s.push(m),t.toolInstance.setGraphicsDomZorder(m),t.toolInstance.updateToRemoteHandle([m],r.Action.Create)}t.toolInstance.initDrawHandle()}};var o=e.toolInstance;this.toolInstance=o}return e.prototype.bindEventsHandle=function(){var e=this;if(!this.bindFlag){this.bindFlag=!0;var t=this.toolInstance,o=t.whiteboardStore,i=t.whiteboardNode;this.eventList.forEach((function(t){var r=t.name,a=t.handle;"moveEventName"!==r&&i.addEventListener(o[r],e[a])}))}},e.prototype.removeEventsHandle=function(){var e=this;if(this.bindFlag){this.bindFlag=!1;var t=this.toolInstance,o=t.whiteboardStore,i=t.whiteboardNode;this.eventList.forEach((function(t){var r=t.name,a=t.handle;i.removeEventListener(o[r],e[a])}))}},e.prototype.drawGraphicsHandle=function(e,t,o){switch(e.type){case r.GraphicType.Pencil:this.drawGraphicsPath(e,t);break;case r.GraphicType.Line:this.drawGraphicsLine(e,t);break;case r.GraphicType.Ellipse:this.drawGraphicsEllipse(e,t);break;case r.GraphicType.Rect:this.drawGraphicsRect(e,t);break;case r.GraphicType.Image:o===r.ZegoWhiteboardViewImageType.ZegoWhiteboardViewImageCustom?this.drawCustomImage(e):this.drawGraphicsImage(e,t)}},e.prototype.updateGraphicsHandle=function(e){switch(e.type){case r.GraphicType.Pencil:this.drawGraphicsPath(e,r.GraphicOperateType.Remote);break;case r.GraphicType.Line:this.drawGraphicsLine(e,r.GraphicOperateType.Remote);break;case r.GraphicType.Ellipse:this.drawGraphicsEllipse(e,r.GraphicOperateType.Remote);break;case r.GraphicType.Rect:this.drawGraphicsRect(e,r.GraphicOperateType.Remote);break;case r.GraphicType.Image:this.updateGraphicsImage(e,r.GraphicOperateType.Remote)}},e.prototype.drawGraphicsLine=function(e,t,o,i,n,s){void 0===o&&(o="none"),void 0===i&&(i=1),void 0===n&&(n="round"),void 0===s&&(s="round");var d=this.toolInstance.whiteboardStore,h=e.data,l=e.graphic_id,c=e.color,p=e.x,g=e.y,u=a.mapGraphicsData(r.GraphicType.Line,h),f=u.x1,v=u.y1,m=u.x2,b=u.y2,w=""+d.reservedPrefix.graphicsSvg+l,y=""+d.reservedPrefix.graphics+l,x=a.createSvgElementHandle(w,y,"line",e.zorder);x[1]&&this.toolInstance.appendGraphicsDomHandle(x[1],r.GraphicType.Line),a.setAttributeHandle(x[0],[{attr:"fill",value:o},{attr:"opacity",value:i},{attr:"stroke",value:c},{attr:"stroke-width",value:this.getSize(e,t)},{attr:"stroke-linejoin",value:n},{attr:"stroke-linecap",value:s},{attr:"x1",value:f},{attr:"y1",value:v},{attr:"x2",value:m},{attr:"y2",value:b},{attr:"transform",value:"translate("+(p||0)+", "+(g||0)+")"}])},e.prototype.drawGraphicsRect=function(e,t,o,i,n,s){void 0===o&&(o="none"),void 0===i&&(i=1),void 0===n&&(n="round"),void 0===s&&(s="round");var d=this.toolInstance.whiteboardStore,h=e.data,l=e.graphic_id,c=e.color,p=e.x,g=e.y,u=a.mapGraphicsData(r.GraphicType.Rect,h),f=u.width,v=u.height,m=u.x,b=u.y;if(f&&v){var w=""+d.reservedPrefix.graphicsSvg+l,y=""+d.reservedPrefix.graphics+l,x=a.createSvgElementHandle(w,y,"rect",e.zorder);x[1]&&this.toolInstance.appendGraphicsDomHandle(x[1],r.GraphicType.Rect),a.setAttributeHandle(x[0],[{attr:"fill",value:o},{attr:"opacity",value:i},{attr:"stroke",value:c},{attr:"stroke-width",value:this.getSize(e,t)},{attr:"stroke-linejoin",value:n},{attr:"stroke-linecap",value:s},{attr:"width",value:f},{attr:"height",value:v},{attr:"x",value:m},{attr:"y",value:b},{attr:"transform",value:"translate("+(p||0)+", "+(g||0)+")"}])}},e.prototype.drawGraphicsPath=function(e,t,o,i,n){void 0===o&&(o="none"),void 0===i&&(i="round"),void 0===n&&(n="round");var s=this.toolInstance.whiteboardStore,d=e.color,h=e.graphic_id,l=e.x,c=e.y,p=e.data;if(!(p.length<4)){var g=a.mapGraphicsData(r.GraphicType.Pencil,p).d,u=""+s.reservedPrefix.graphicsSvg+h,f=""+s.reservedPrefix.graphics+h,v=a.createSvgElementHandle(u,f,"path",e.zorder);v[1]&&this.toolInstance.appendGraphicsDomHandle(v[1],r.GraphicType.Pencil),a.setAttributeHandle(v[0],[{attr:"fill",value:o},{attr:"d",value:g},{attr:"stroke",value:d},{attr:"stroke-width",value:this.getSize(e,t)},{attr:"stroke-linejoin",value:i},{attr:"stroke-linecap",value:n},{attr:"transform",value:"translate("+(l||0)+", "+(c||0)+")"}])}},e.prototype.drawGraphicsEllipse=function(e,t,o,i,n,s){void 0===o&&(o="none"),void 0===i&&(i=1),void 0===n&&(n="round"),void 0===s&&(s="round");var d=this.toolInstance.whiteboardStore,h=e.color,l=e.data,c=e.graphic_id,p=e.x,g=e.y,u=a.mapGraphicsData(r.GraphicType.Ellipse,l),f=u.cx,v=u.cy,m=u.rx,b=u.ry,w=""+d.reservedPrefix.graphicsSvg+c,y=""+d.reservedPrefix.graphics+c,x=a.createSvgElementHandle(w,y,"ellipse",e.zorder);x[1]&&this.toolInstance.appendGraphicsDomHandle(x[1],r.GraphicType.Ellipse),a.setAttributeHandle(x[0],[{attr:"fill",value:o},{attr:"opacity",value:i},{attr:"stroke",value:h},{attr:"stroke-width",value:this.getSize(e,t)},{attr:"stroke-linejoin",value:n},{attr:"stroke-linecap",value:s},{attr:"cx",value:f},{attr:"cy",value:v},{attr:"rx",value:m},{attr:"ry",value:b},{attr:"transform",value:"translate("+(p||0)+", "+(g||0)+")"}])},e.prototype.drawGraphicImage=function(e,t,o){var n=this;return new Promise((function(s,d){var h=new Image;h.onload=function(){var d=n.toolInstance,l=d.whiteboardStore,c=d.graphicList,p=n.getScaleRect(h.width,h.height),g=p.width,u=p.height,f={x:t,y:o,ex:t+g,ey:o+u,url:e,hash:""},v=a.createGraphicId(),m=n.toolInstance.serviceHandle.createZorder(),b=""+l.reservedPrefix.graphicsSvg+v,w=""+l.reservedPrefix.graphics+v,y=a.createSvgElementHandle(b,w,"image",m);if(y[1]&&n.toolInstance.appendGraphicsDomHandle(y[1],r.GraphicType.Image),a.setAttributeHandle(y[0],[{attr:"width",value:g},{attr:"height",value:u},{attr:"href",value:e},{attr:"transform",value:"translate("+t+", "+o+")"}]),n.toolInstance.updateProtoGraphic(i(i({graphic_id:v},l.basicState),{type:r.GraphicType.Image,x:0,y:0,px:0,py:0,initX:t,initY:o,data:f,oldData:i({},f),zorder:m})),n.toolInstance.updateBoxHandle(n.toolInstance.protoGraphic)){var x=JSON.parse(JSON.stringify(n.toolInstance.protoGraphic));c.push(x),n.toolInstance.updateToRemoteHandle([x],r.Action.Create)}n.toolInstance.initDrawHandle(),s(e)},h.onerror=d,h.src=e}))},e.prototype.drawCustomImage=function(e){var t=e.graphic_id,o=this.toolInstance,i=o.whiteboardStore,n=o.viewInfo.customImage,s=n.w,d=n.h,h=e.data,l=h.x,c=h.y,p=h.ex,g=h.ey,u=h.url,f=""+i.reservedPrefix.graphicsSvg+t,v=""+i.reservedPrefix.graphics+t,m=a.createSvgElementHandle(f,v,"image",e.zorder);m[1]&&this.toolInstance.appendGraphicsDomHandle(m[1],r.GraphicType.Image);var b=Number((Math.abs(p-l)/s).toFixed(7)),w=Number((Math.abs(g-c)/d).toFixed(7));a.setAttributeHandle(m[0],[{attr:"width",value:s},{attr:"height",value:d},{attr:"href",value:u},{attr:"transform",value:"translate("+Math.min(l,p)+", "+Math.min(c,g)+") scale("+b+", "+w+")"}])},e.prototype.drawGraphicsImage=function(e,t){var o=this,i=e.graphic_id,r=e.zorder,n=e.data;this.checkImageRect(n);var s=n.x,d=n.y,h=n.ex,l=n.ey,c=n.url,p=this.toolInstance.appendImageDomHandle(i,r),g=p[0],u=p[1],f=p[2],v=new Image;v.onload=function(){var t=o.getScaleRect(v.width,v.height),i=t.width,r=t.height,n=Number(((h-s)/i).toFixed(7)),p=Number(((l-d)/r).toFixed(7));a.setAttributeHandle(u,[{attr:"width",value:i},{attr:"height",value:r},{attr:"href",value:c},{attr:"transform",value:"translate("+s+", "+d+") scale("+n+", "+p+")"}]),g.appendChild(u);var m=o.toolInstance.getBoxInfoByGraphic(e);if(m){var b=m.x,w=m.y,y=m.width,x=m.height;f.style.cssText+="width:"+y+"px;height:"+x+"px;left:"+b+"px;top:"+w+"px;"}},v.src=c},e.prototype.updateGraphicsImage=function(e,t){var o=this.toolInstance.whiteboardStore,i=e.graphic_id,r=e.data;this.checkImageRect(r);var n=r.x,s=r.y,d=r.ex,h=r.ey,l=""+o.reservedPrefix.graphicsSvg+i,c=""+o.reservedPrefix.graphics+i,p=a.createSvgElementHandle(l,c,"image",e.zorder)[0];if(p){var g=+p.getAttribute("width"),u=+p.getAttribute("height"),f=Number(((d-n)/g).toFixed(7)),v=Number(((h-s)/u).toFixed(7));p.setAttribute("transform","translate("+n+", "+s+") scale("+f+", "+v+")")}},e.prototype.checkImageRect=function(e){var t=e.x,o=e.y,i=e.ex,r=e.ey;t>i&&(e.x=i,e.ex=t),o>r&&(e.y=r,e.ey=o)},e.prototype.getScaleRect=function(e,t){return{width:e,height:t}},e.prototype.getSize=function(e,t){return t===r.GraphicOperateType.Local?this.toolInstance.whiteboardStore.basicExtraState.drawSize:a.calSizeHandle(e.size,e.type,this.toolInstance.viewInfo.viewportWidth,!1)},e}();t.SvgGraphics=n},function(e,t,o){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),a=o(2),n=function(){function e(e){var t=this;this.bindFlag=!1,this.isBlur=!1,this.mouseupHandle=function(e){if(t.toolInstance.canDraw&&t.toolInstance.downCommonHandle(e))if(t.isBlur)t.isBlur=!1;else{var o=t.toolInstance.getMouseChangedPoint(e),i=o.clientX,r=o.clientY;if(!t.checkAddHandle(i,r))return;t.addTextGraphics("",i,r)}};var o=e.toolInstance;this.toolInstance=o}return e.prototype.updateContentHandle=function(e){var t=this.toolInstance.whiteboardStore.textareaHPadding,o=e.value,i=e.previousSibling,r=Number(i.style.maxWidth.split("px")[0])-2*t,a=i.parentNode,n=document.createElement("span");n.style.cssText="position: absolute; z-index: -100; font-size: inherit; font-family: inherit; visibility: hidden; display: inline-block;line-height: 1;",a.appendChild(n);for(var s="",d=0,h=0;h<o.length;h++){var l=o[h];if("\n"===l)s+="\n",d=0;else(d+=this.textSizeHandle(n,l))>r?(s+="\n",h--,d=0):s+=l}a.removeChild(n),i.innerHTML=s,e.value=s},e.prototype.addTextareaDomHandle=function(e){var t=this.toolInstance.whiteboardStore,o=e.graphic_id,i=e.data,r=document.createElement("textarea"),n=""+t.reservedPrefix.graphics+o;r.setAttribute("id",n),r.setAttribute("spellcheck","false"),r.setAttribute("maxlength",""+t.maxlength),navigator.userAgent.includes("iPhone")&&navigator.userAgent.includes("11_4_1")&&(r.style.padding="0 "+Math.max(t.textareaHPadding-3,0)+"px");var s=a.splitTextHandle(i).text;return r.value=s,r},e.prototype.addPreDomHandle=function(e){var t=this.toolInstance,o=t.viewInfo,i=t.whiteboardStore,r=e.size,n=e.data,s=e.type,d=a.splitTextHandle(n).text,h=document.createElement("pre");h.innerHTML=d;var l=a.calSizeHandle(r,s,o.viewportWidth,!1),c=i.textareaHPadding,p=i.textareaVPadding;return c*=2,p*=2,h.style.cssText="min-height:"+(l*i.lineHeight+p)+"px;min-width:"+(l+c)+"px;",h},e.prototype.addTextareaConDomHandle=function(e){var t=this.toolInstance,o=t.viewInfo,i=t.whiteboardStore,r=e.size,n=e.color,s=e.data,d=e.graphic_id,h=e.type,l=e.attributes,c=e.zorder,p=JSON.parse(l||i.basicState.attributes),g=p.bold,u=p.italic,f=a.calSizeHandle(r,h,o.viewportWidth,!1),v=a.splitTextHandle(s),m=v.beginX,b=v.beginY,w=document.createElement("div"),y=""+i.reservedPrefix.textareaCon+d;return w.setAttribute("id",y),c&&w.setAttribute("data-z",c+""),w.style.cssText="font-size:"+f+"px;font-style:"+(u?"italic":"normal")+";font-weight:"+(g?"bold":"normal")+";left:"+m+"px;top:"+b+"px;color:"+n+";caret-color:"+n+";",w},e.prototype.textSizeHandle=function(e,t){return" "===t&&(t=t.replace(/ /g,"&nbsp")),e.innerHTML=t,e.clientWidth},e.prototype.checkValueHandle=function(e){var t=this.toolInstance.whiteboardStore.maxlength;return e.length>t&&(e=e.slice(0,t)),e},e.prototype.initHeightHandle=function(e){var t=e.previousSibling;e.scrollTop=0,e.style.height="initial",t.style.height="initial",t.style.maxHeight="initial"},e.prototype.updateHeightHandle=function(e){var t=this.toolInstance.whiteboardStore.lineHeight,o=e.previousSibling,i=o.style.height,r=Number(o.style.maxHeight.split("px")[0]),a=e.parentNode.style.fontSize,n=Number(a.split("px")[0]);e.style.height=n*t+"px";var s=e.scrollHeight+"px";e.scrollHeight>r&&(s=i),o.style.height=s,e.style.height=s},e.prototype.inputCallbackHandle=function(e){var t=e.target,o=t.previousSibling,i=this.checkValueHandle(t.value);t.value=i,o.innerHTML=i,this.updateHeightHandle(t)},e.prototype.bindTextareaInputEventHandle=function(e){var t=this;e.addEventListener("input",(function(e){t.inputCallbackHandle(e)}))},e.prototype.bindTextareaFocusEvent=function(e,t){var o=this,i=t.data,r=a.splitTextHandle(i),n=r.beginX,s=r.beginY;e.addEventListener("focus",(function(e){var t=e.target;t.parentNode.style.borderColor="red";var i=t.id.split(o.toolInstance.whiteboardStore.reservedPrefix.graphics)[1];o.toolInstance.setDataToGraphicList(i,{oldData:a.addTextBeginPlace(t.value,n,s)})}))},e.prototype.bindTextareaBlurEvents=function(e){var t=this,o=this.toolInstance,i=o.whiteboardStore,n=o.graphicsBoxConNode,s=o.graphicList;e.addEventListener("blur",(function(e){var o=e.target,d=o.parentNode,h=o.id.split(i.reservedPrefix.graphics)[1];t.updateContentHandle(o),t.initHeightHandle(o),t.updatePointerEvents(2,n.querySelector(t.toolInstance.getBoxSelHandle(h)));var l=t.toolInstance.getDataFromGraphicList(h,"oldData").oldData,c=a.splitTextHandle(l),p=c.text,g=c.beginX,u=c.beginY,f=o.value;if(f){t.isBlur=!0,d.style.borderColor="transparent";var v=p?r.Action.Update:r.Action.Create;s.forEach((function(e){e.graphic_id===h&&(t.toolInstance.updateBoxHandle(e,"blur"),f!==p&&(e.oldData=e.data,e.data=a.addTextBeginPlace(f,g,u),v===r.Action.Create&&(e.zorder=t.toolInstance.serviceHandle.createZorder()),t.toolInstance.setGraphicsDomZorder(e),t.toolInstance.updateToRemoteHandle([e],v)))})),t.toolInstance.initDrawHandle()}else a.removeElement(d),p&&s.forEach((function(e,o,i){e.graphic_id===h&&(i.splice(o,1),e.oldData=e.data,t.toolInstance.updateToRemoteHandle([e],r.Action.Delete))})),a.removeElement(t.toolInstance.getBoxHandle(h)),t.isBlur=!0}))},e.prototype.updatePointerEvents=function(e,t){var o=this,i=this.toolInstance,r=i.graphicsBoxConNode,n=i.whiteboardStore;1===e?(Array.prototype.slice.call(a.getElementChild(r),0).forEach((function(e){var t=o.toolInstance.getGraphicsHandle(e.id.split(n.reservedPrefix.graphicsBox)[1]);t&&"DIV"===t.nodeName&&(e.style.pointerEvents="initial")})),r.style.pointerEvents="none",t&&(t.style.pointerEvents="none")):(r.style.pointerEvents="initial",t&&(t.style.pointerEvents="initial"))},e.prototype.checkAddHandle=function(e,t){var o=this.calMaxSizeHandle(e,t),i=o.maxWidth,n=o.maxHeight,s=this.toolInstance,d=s.whiteboardStore,h=s.viewInfo,l=d.textareaHPadding,c=d.basicState,p=d.lineHeight,g=d.textareaVPadding,u=a.calSizeHandle(c.fontSize,r.GraphicType.Text,h.viewportWidth,!1);return!(2*l+u>i-12||2*g+u*p>n-12)},e.prototype.bindEventsHandle=function(){if(!this.bindFlag){this.bindFlag=!0;var e=this.toolInstance,t=e.whiteboardStore;e.whiteboardNode.addEventListener(t.upEventName,this.mouseupHandle)}},e.prototype.removeEventsHandle=function(){if(this.bindFlag){this.bindFlag=!1;var e=this.toolInstance,t=e.whiteboardStore;e.whiteboardNode.removeEventListener(t.upEventName,this.mouseupHandle)}},e.prototype.addTextGraphics=function(e,t,o,n){var s=this.toolInstance,d=s.whiteboardStore,h=s.protoGraphic,l=s.graphicList;this.toolInstance.updateProtoGraphic(i({graphic_id:a.createGraphicId(),x:0,y:0,px:0,py:0,zorder:this.toolInstance.serviceHandle.createZorder(),data:a.addTextBeginPlace(e,t+"",o+"")},d.basicState));var c=i(i({},h),{size:d.basicState.fontSize});l.push(c),this.drawGraphicsHandle(c,!0),this.toolInstance.setGraphicsDomZorder(h),this.toolInstance.updateBoxHandle(h),n&&(this.toolInstance.updateToRemoteHandle([h],r.Action.Create),this.toolInstance.updateBoxHandle(h))},e.prototype.drawGraphicsHandle=function(e,t){var o=e.x,i=e.y,n=this.addTextareaDomHandle(e),s=this.addPreDomHandle(e),d=this.addTextareaConDomHandle(e);d.appendChild(s),d.appendChild(n),d.style.transform="translate("+(o||0)+"px, "+(i||0)+"px)",this.toolInstance.appendGraphicsDomHandle(d,r.GraphicType.Text),this.bindTextareaInputEventHandle(n),this.bindTextareaFocusEvent(n,e);var h=this.toolInstance.whiteboardStore,l=h.downEventName,c=h.moveEventName,p=h.upEventName;a.bindStopsEvents(n,[l,c,p]),t&&(this.initMaxSizeHandle(n),n.focus(),this.updatePointerEvents(1,null)),this.bindTextareaBlurEvents(n)},e.prototype.updateGraphicsHandle=function(e){var t=this.toolInstance,o=t.viewInfo,i=t.whiteboardStore,r=e.graphic_id,n=e.data,s=e.size,d=e.color,h=e.x,l=e.y,c=e.type,p=e.attributes,g=JSON.parse(p||i.basicState.attributes),u=g.bold,f=g.italic,v=a.calSizeHandle(s,c,o.viewportWidth,!1),m=a.splitTextHandle(n),b=m.beginX,w=m.beginY,y=m.text,x=this.toolInstance.getGraphicsHandle(r);if(x){var I=a.getElementChild(x),E=I[0],S=I[1];S.value=y,x.style.cssText="font-size: "+v+"px;font-style:"+(f?"italic":"normal")+";font-weight:"+(u?"bold":"normal")+";left: "+b+"px;top: "+w+"px;color: "+d+";transform: translate("+h+"px, "+l+"px);caret-color:"+d+";";var T=y.split("\n").length*v*i.lineHeight+2*i.textareaVPadding;E.innerHTML=y,E.style.height=T+"px",S.value=y,S.style.height=T+"px"}},e.prototype.focusHandle=function(e){this.toolInstance.setDataToGraphicList(e,{selected:!1});var t=this.toolInstance.getBoxHandle(e);t&&(t.style.borderColor="transparent"),this.updatePointerEvents(1,t);var o=this.toolInstance.getGraphicsHandle(e);if(o){var i=a.getElementChild(o)[1];this.initMaxSizeHandle(i),o.style.borderColor="red",i.style.height="100%",i.focus()}},e.prototype.backUpdateGraphicsHandle=function(e){var t=e.graphic_id,o=e.data,i=a.splitTextHandle(o).text,r=this.toolInstance.getGraphicsHandle(t);if(r){var n=a.getElementChild(r),s=n[0];n[1].value=i,s.innerHTML=i;var d=r.getBoundingClientRect(),h=d.width,l=d.height,c=this.toolInstance.getBoxHandle(t);c&&(c.style.cssText+="width:"+h+"px;height:"+l+"px;"),this.toolInstance.setDataToGraphicList(t,{data:o})}},e.prototype.initMaxSizeHandle=function(e){var t=e.getBoundingClientRect(),o=t.left,i=t.top,r=this.toolInstance.transLocationHandle({clientX:o,clientY:i}),a=r.clientX,n=r.clientY,s=this.calMaxSizeHandle(a,n),d=s.maxWidth,h=s.maxHeight,l=e.previousSibling;l.style.maxHeight=h+"px",l.style.maxWidth=d+"px"},e.prototype.calMaxSizeHandle=function(e,t){var o,i=this.toolInstance,r=i.viewInfo,a=i.whiteboardStore,n=r.viewHeight,s=r.viewWidth,d=r.isScroll,h=r.zoom,l=r.zoomTX,c=r.zoomTY,p=r.offsetPageX,g=r.offsetPageY,u=r.viewportHeight,f=r.viewportWidth,v=r.isOriginScroll,m=0;return d?(o=Math.floor(s-(e-p)),m=Math.floor(n-(t-g)),v&&(o-=a.scrollbarSize,m-=a.scrollbarSize)):(o=Math.floor(f-(e-p)+l/h),m=Math.floor(u-(t-g)+c/h)),{maxWidth:o-=2*a.boxBorderWidth,maxHeight:m-=2*a.boxBorderWidth}},e}();t.TextareaGraphics=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(0),r=function(){function e(e){var t=this;this.bindFlag=!1,this.boxRectMap={},this.mouseDownHandle=function(){if(t.toolInstance.canDraw){var e=t.toolInstance,o=e.whiteboardNode,r=e.whiteboardStore;e.graphicList.forEach((function(e){if(e.type!==i.GraphicType.Laser){var o=t.toolInstance.getBoxHandle(e.graphic_id);o&&(t.boxRectMap[e.graphic_id]=o.getBoundingClientRect())}})),o.addEventListener(r.moveEventName,t.mousemoveHandle)}},this.mousemoveHandle=function(e){if(t.toolInstance.canDraw){var o=t.toolInstance,r=o.whiteboardStore,a=o.graphicList,n=r.platform===i.Platform.Pc?e:e.changedTouches[0],s=n.clientX,d=n.clientY,h=0,l="";a.forEach((function(e){var o=t.boxRectMap[e.graphic_id];if(o){var i=o.left,r=o.right,a=o.top,n=o.bottom;if(s>=i&&s<=r&&d>=a&&d<=n){var c=e.zorder||1;(!h||c>h)&&(h=c,l=e.graphic_id)}}})),l?(delete t.boxRectMap[l],a.forEach((function(e){return e.selected=e.graphic_id===l})),t.toolInstance.deleteSelectedGraphics()):a.forEach((function(e){return e.selected=!1}))}},this.mouseUpHandle=function(){if(t.toolInstance.canDraw){t.boxRectMap={};var e=t.toolInstance,o=e.whiteboardNode,i=e.whiteboardStore;o.removeEventListener(i.moveEventName,t.mousemoveHandle)}};var o=e.toolInstance;this.toolInstance=o}return e.prototype.bindEventsHandle=function(){if(!this.bindFlag){this.bindFlag=!0;var e=this.toolInstance,t=e.whiteboardStore,o=e.whiteboardNode;o.addEventListener(t.downEventName,this.mouseDownHandle),o.addEventListener(t.upEventName,this.mouseUpHandle),o.addEventListener(t.leaveEventName,this.mouseUpHandle)}},e.prototype.removeEventsHandle=function(){if(this.bindFlag){this.bindFlag=!1;var e=this.toolInstance,t=e.whiteboardStore,o=e.whiteboardNode;o.removeEventListener(t.downEventName,this.mouseDownHandle),o.removeEventListener(t.upEventName,this.mouseUpHandle),o.removeEventListener(t.leaveEventName,this.mouseUpHandle)}},e}();t.Eraser=r},function(e,t,o){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=o(2),a=o(0),n=function(){function e(e){var t=this;this.bindFlag=!1,this.eventList=[{name:"downEventName",handle:"mousedownHandle"},{name:"moveEventName",handle:"mousemoveHandle"},{name:"upEventName",handle:"mouseupHandle"},{name:"leaveEventName",handle:"mouseupHandle"}],this.noMoveUp=!0,this.isWillMove=!1,this.selectBoxMap={l:0,t:0,r:0,b:0,box:document.createElement("div")},this.imageEditBoxMap={w:0,h:0,tx:0,ty:0,x:0,y:0,mx:0,my:0,tx1:0,ty1:0,w0:0,h0:0,board:8,wdiff:9,tdiff:4,interrupt:!1,target:null,graphic:null,parent:document.createElement("div"),box:document.createElement("div"),img:document.createElementNS("http://www.w3.org/2000/svg","image")},this.mousedownHandle=function(e){if(t.toolInstance.canDraw&&t.toolInstance.downCommonHandle(e)&&t.startImageEditTarget(e)){t.imageEditBoxMap.interrupt=!1;var o=t.selectBoxMap,n=o.l,s=o.t,d=o.r,h=o.b,l=t.toolInstance.getMouseStartPoint(e),c=l.clientX,p=l.clientY,g=t.toolInstance,u=g.graphicList,f=g.whiteboardStore,v=g.whiteboardNode,m=t.getCoverHandle(e);if(m){var b=m.rect,w=b.left,y=b.top,x=b.right,I=b.bottom,E=t.toolInstance.transLocationHandle({clientX:w,clientY:y}),S=t.toolInstance.transLocationHandle({clientX:x,clientY:I});if(w=E.clientX,y=E.clientY,x=S.clientX,I=S.clientY,!(d>n&&w>=n&&y>=s&&x<=d&&I<=h)){var T=m.graphic,H=T.graphic_id,W=T.selected,M=T.type;if(W&&M===a.GraphicType.Text)1===u.filter((function(e){return e.selected})).length&&(t.noMoveUp=H);else W||u.forEach((function(e){return e.selected=e.graphic_id===H}));1==u.filter((function(e){return e.selected})).length?M===a.GraphicType.Image?(t.initImageEditBox(m.graphic),t.hideSelectBox()):(t.hideImageEditBox(),t.initSelectBox(w,y,x,I)):t.hideImageEditBox()}t.isWillMove=!0}else{d>n&&n<=c&&c<=d&&s<=p&&p<=h?t.isWillMove=!0:(u.forEach((function(e){return e.selected=!1})),t.hideSelectBox())}t.toolInstance.updateMousePointsHandle(c,p),t.toolInstance.updateProtoGraphic(i(i({graphic_id:r.createGraphicId()},f.basicState),{x:0,y:0,px:0,py:0,data:[c,p]})),v.addEventListener(f.moveEventName,t.mousemoveHandle)}},this.mousemoveHandle=function(e){if(t.toolInstance.canDraw){if(e instanceof MouseEvent&&!e.buttons)return t.resetMouse();if(t.moveImageEditTarget(e)){t.noMoveUp=!1;var o=t.toolInstance.getMouseChangedPoint(e);if(t.isWillMove)t.updateGraphicsOnMoving(o);else{t.hideImageEditBox(),t.hideSelectBox(),t.toolInstance.updateGraphicsDataHandle(o);var i=t.toolInstance.protoGraphic;t.svgTool.drawGraphicsRect(i,a.GraphicOperateType.Local,i.color,.3),t.updateBoxBorderOnSelector()}}}},this.mouseupHandle=function(){if(t.toolInstance.canDraw){if(t.isWillMove?(t.selectBoxMap.l=+t.selectBoxMap.box.style.left.replace("px",""),t.selectBoxMap.t=+t.selectBoxMap.box.style.top.replace("px","")):t.setSelectBox(),t.endImageEditTarget(),!t.imageEditBoxMap.interrupt&&t.noMoveUp&&!0!==t.noMoveUp)t.toolInstance.getInstanceHandle(a.ZegoWhiteboardTool.ZegoWhiteboardViewToolText).focusHandle(t.noMoveUp);t.resetMouse()}};var o=e.toolInstance;this.toolInstance=o,this.svgTool=o.getInstanceHandle(a.ZegoWhiteboardTool.ZegoWhiteboardViewToolLine),this.setGraphicsBox()}return e.prototype.moveImageEditTargetL=function(e,t,o){var i=this.imageEditBoxMap,r=i.x,a=i.mx,n=i.w,s=i.h,d=i.tx,h=i.ty,l=i.parent,c=i.board;if(e<a){e=r-e;var p=o?e-n:e+n,g=o?d-e+n:d-e;l.style.cssText+="width:"+p+"px;transform:translate("+g+"px,"+h+"px);",l.children[4].style.cssText+="left:"+(p/2-c)+"px;",l.children[6].style.cssText+="left:"+(p/2-c)+"px;",this.imageEditBoxMap.tx1=g,this.imageEditBoxMap.ty1=h,this.updateSVGImageAttr(p,s,g,h)}else this.moveImageEditTargetR(e,0,!0)},e.prototype.moveImageEditTargetR=function(e,t,o){var i=this.imageEditBoxMap,r=i.x,a=i.mx,n=i.w,s=i.h,d=i.tx1,h=i.ty1,l=i.parent,c=i.board;e>a?(e=o?e-r-n:e-r+n,l.style.cssText+="width:"+e+"px;",l.children[4].style.cssText+="left:"+(e/2-c)+"px;",l.children[6].style.cssText+="left:"+(e/2-c)+"px;",this.updateSVGImageAttr(e,s,d,h)):this.moveImageEditTargetL(e,0,!0)},e.prototype.moveImageEditTargetT=function(e,t,o){var i=this.imageEditBoxMap,r=i.y,a=i.my,n=i.w,s=i.h,d=i.tx,h=i.ty,l=i.parent,c=i.board;if(t<a){t=r-t;var p=o?t-s:t+s,g=o?h-t+s:h-t;l.style.cssText+="height:"+p+"px;transform:translate("+d+"px,"+g+"px);",l.children[5].style.cssText+="top:"+(p/2-c)+"px;",l.children[7].style.cssText+="top:"+(p/2-c)+"px;",this.imageEditBoxMap.tx1=d,this.imageEditBoxMap.ty1=g,this.updateSVGImageAttr(n,p,d,g)}else this.moveImageEditTargetB(0,t,!0)},e.prototype.moveImageEditTargetB=function(e,t,o){var i=this.imageEditBoxMap,r=i.y,a=i.my,n=i.w,s=i.h,d=i.tx1,h=i.ty1,l=i.parent,c=i.board;t>a?(t=o?t-r-s:t-r+s,l.style.cssText+="height:"+t+"px;",l.children[5].style.cssText+="top:"+(t/2-c)+"px;",l.children[7].style.cssText+="top:"+(t/2-c)+"px;",this.updateSVGImageAttr(n,t,d,h)):this.moveImageEditTargetT(0,t,!0)},e.prototype.moveImageEditTargetLT=function(e,t,o){var i=this.imageEditBoxMap,r=i.x,a=i.y,n=i.mx,s=i.my,d=i.w,h=i.h,l=i.tx,c=i.ty,p=i.parent,g=i.board;if(e>r-4&&t>a-4||e<r-4&&t<a-4)if(d<=h&&e<=n||h<d&&t<=s){var u=0,f=0,v=0,m=0;if(o?(e=Math.min(r-e-d,a-t-h),h<d?(f=e,u=Math.round(d*f/h),m=c-e,v=Math.round(l-d*e/h)):(u=e,f=Math.round(u*h/d),v=l-e,m=Math.round(c-h*e/d))):(t-=a,e=(e-=r)<0||t<0?Math.max(e,t):Math.min(e,t),h<d?(f=h-e,u=Math.round(d*f/h),m=c+e,v=Math.round(l+d*e/h)):(u=d-e,f=Math.round(u*h/d),v=l+e,m=Math.round(c+h*e/d))),u<0||f<0)return;p.style.cssText+="width:"+u+"px;height:"+f+"px;transform:translate("+v+"px,"+m+"px);",p.children[4].style.cssText+="left:"+(u/2-g)+"px;",p.children[6].style.cssText+="left:"+(u/2-g)+"px;",p.children[5].style.cssText+="top:"+(f/2-g)+"px;",p.children[7].style.cssText+="top:"+(f/2-g)+"px;",this.imageEditBoxMap.tx1=v,this.imageEditBoxMap.ty1=m,this.updateSVGImageAttr(u,f,v,m)}else this.moveImageEditTargetRB(e,t,!0)},e.prototype.moveImageEditTargetRB=function(e,t,o){var i=this.imageEditBoxMap,r=i.x,a=i.y,n=i.mx,s=i.my,d=i.w,h=i.h,l=i.tx1,c=i.ty1,p=i.parent,g=i.board;if(e>r-4&&t>a-4||e<r-4&&t<a-4)if(d<=h&&e>=n||h<d&&t>=s){e-=r,t-=a;var u=0,f=0;if(o?h<d?(f=Math.min(e,t)-h,u=Math.round(d*f/h)):(u=Math.min(e,t)-d,f=Math.round(u*h/d)):(e=e<0||t<0?Math.max(e,t):Math.min(e,t),h<d?(f=e+h,u=Math.round(d*f/h)):(u=e+d,f=Math.round(u*h/d))),u<0||f<0)return;p.style.cssText+="width:"+u+"px;height:"+f+"px;",p.children[4].style.cssText+="left:"+(u/2-g)+"px;",p.children[6].style.cssText+="left:"+(u/2-g)+"px;",p.children[5].style.cssText+="top:"+(f/2-g)+"px;",p.children[7].style.cssText+="top:"+(f/2-g)+"px;",this.updateSVGImageAttr(u,f,l,c)}else this.moveImageEditTargetLT(e,t,!0)},e.prototype.moveImageEditTargetLB=function(e,t,o){var i=this.imageEditBoxMap,r=i.x,a=i.y,n=i.mx,s=i.my,d=i.w,h=i.h,l=i.tx,c=i.ty,p=i.parent,g=i.board;if(e<r-4&&t>a-4||e>r-4&&t<a-4)if(d<=h&&e<n||h<d&&t>s){var u=0,f=0,v=0,m=c;o?(e=Math.min(r-e-d,t-a-h),e=Math.abs(e),h<d?(f=e,u=Math.round(d*f/h)):(u=e,f=Math.round(u*h/d)),v=l-u,m=c+h):(t-=a,e=(e-=r)<0||t>0?Math.min(-e,t):-Math.min(e,-t),h<d?(f=h+e,v=l+d-(u=Math.round(d*f/h))):(u=d+e,f=Math.round(u*h/d),v=l-e)),p.style.cssText+="width:"+u+"px;height:"+f+"px;transform:translate("+v+"px,"+m+"px);",p.children[4].style.cssText+="left:"+(u/2-g)+"px;",p.children[6].style.cssText+="left:"+(u/2-g)+"px;",p.children[5].style.cssText+="top:"+(f/2-g)+"px;",p.children[7].style.cssText+="top:"+(f/2-g)+"px;",this.imageEditBoxMap.tx1=v,this.imageEditBoxMap.ty1=m,this.updateSVGImageAttr(u,f,v,m)}else this.moveImageEditTargetRT(e,t,!0)},e.prototype.moveImageEditTargetRT=function(e,t,o){var i=this.imageEditBoxMap,r=i.x,a=i.y,n=i.mx,s=i.my,d=i.w,h=i.h,l=i.tx,c=i.ty,p=i.parent,g=i.board;if(e>r-4&&t<a-4||e<r-4&&t>a-4)if(d<=h&&e>n||h<d&&t<s){var u=0,f=0,v=l,m=0;o?(e=Math.min(e-r-d,a-t-h),e=Math.abs(e),h<d?(f=e,u=Math.round(d*f/h)):(u=e,f=Math.round(u*h/d)),v=l+d,m=c-f):(t-=a,e=(e-=r)<0||t>0?-Math.min(-e,t):Math.min(e,-t),h<d?(f=h+e,u=Math.round(d*f/h),m=c-e):(u=d+e,m=c+h-(f=Math.round(u*h/d)))),p.style.cssText+="width:"+u+"px;height:"+f+"px;transform:translate("+v+"px,"+m+"px);",p.children[4].style.cssText+="left:"+(u/2-g)+"px;",p.children[6].style.cssText+="left:"+(u/2-g)+"px;",p.children[5].style.cssText+="top:"+(f/2-g)+"px;",p.children[7].style.cssText+="top:"+(f/2-g)+"px;",this.imageEditBoxMap.tx1=v,this.imageEditBoxMap.ty1=m,this.updateSVGImageAttr(u,f,v,m)}else this.moveImageEditTargetLB(e,t,!0)},e.prototype.startImageEditTarget=function(e){var t,o;this.endImageEditTarget();var i=e.target,r=i.className;if(r.includes("operation-point-desktop")){var a=null===(t=this.imageEditBoxMap.graphic)||void 0===t?void 0:t.oldData;Object.assign(a,null===(o=this.imageEditBoxMap.graphic)||void 0===o?void 0:o.data),this.imageEditBoxMap.target=i;var n=window.getComputedStyle(this.imageEditBoxMap.parent),s=n.transform.match(/(-?\d+),\s?(-?\d+)\)$/)||[],d=this.toolInstance.getMouseChangedPoint(e),h=d.clientX,l=d.clientY;this.imageEditBoxMap.w=+n.width.replace("px",""),this.imageEditBoxMap.h=+n.height.replace("px",""),this.imageEditBoxMap.tx=+s[1]||0,this.imageEditBoxMap.ty=+s[2]||0,this.imageEditBoxMap.x=h,this.imageEditBoxMap.y=l;var c=r.substr(r.lastIndexOf(" ")+1);"L"==c?this.imageEditBoxMap.mx=h+this.imageEditBoxMap.w:"R"==c?this.imageEditBoxMap.mx=h-this.imageEditBoxMap.w:"T"==c?this.imageEditBoxMap.my=l+this.imageEditBoxMap.h:"B"==c?this.imageEditBoxMap.my=l-this.imageEditBoxMap.h:"LT"==c?(this.imageEditBoxMap.mx=h+this.imageEditBoxMap.w,this.imageEditBoxMap.my=l+this.imageEditBoxMap.h):"RB"==c?(this.imageEditBoxMap.mx=h-this.imageEditBoxMap.w,this.imageEditBoxMap.my=l-this.imageEditBoxMap.h):"LB"==c?(this.imageEditBoxMap.mx=h+this.imageEditBoxMap.w,this.imageEditBoxMap.my=l-this.imageEditBoxMap.h):"RT"==c&&(this.imageEditBoxMap.mx=h-this.imageEditBoxMap.w,this.imageEditBoxMap.my=l+this.imageEditBoxMap.h);var p=this.toolInstance,g=p.whiteboardStore,u=p.whiteboardNode;return u.addEventListener(g.moveEventName,this.mousemoveHandle),u.style.cursor=r.replace(/.+cursor-(\w+).+/,"$1")+"-resize",!1}return!0},e.prototype.moveImageEditTarget=function(e){var t=this.imageEditBoxMap,o=t.target,i=t.interrupt;if(!o)return!i;var r=o.className.substr(o.className.lastIndexOf(" ")+1),a=this.toolInstance.getMouseChangedPoint(e),n=a.clientX,s=a.clientY;return this["moveImageEditTarget"+r](n,s),!1},e.prototype.endImageEditTarget=function(){var e=this.imageEditBoxMap,t=e.target,o=e.graphic;if(t&&o){var i=o.data,r=i.x,n=i.y;o.initX=r-o.x,o.initY=n-o.y,this.toolInstance.updateToRemoteHandle([o],a.Action.Update)}this.imageEditBoxMap.target=null,this.toolInstance.whiteboardNode.style.cursor="auto"},e.prototype.initImageEditBox=function(e){var t;this.setGraphicsBox();var o=e.graphic_id,i=null===(t=this.toolInstance.getGraphicsHandle(o))||void 0===t?void 0:t.children[0];if(i){var r=this.imageEditBoxMap,a=r.parent,n=r.board,s=r.wdiff,d=r.tdiff,h=e.data,l=h.x,c=h.y,p=h.ex-l+s,g=h.ey-c+s;l-=d,c-=d,this.imageEditBoxMap.tx1=l,this.imageEditBoxMap.ty1=c,this.imageEditBoxMap.graphic=e,this.imageEditBoxMap.w0=+i.getAttribute("width"),this.imageEditBoxMap.h0=+i.getAttribute("height"),this.imageEditBoxMap.img=i,this.imageEditBoxMap.box=this.toolInstance.getBoxHandle(o),a.style.cssText+="display:block;width:"+p+"px;height:"+g+"px;transform:translate("+l+"px,"+c+"px);",a.children[4].style.cssText+="left:"+(p/2-n)+"px;",a.children[6].style.cssText+="left:"+(p/2-n)+"px;",a.children[5].style.cssText+="top:"+(g/2-n)+"px;",a.children[7].style.cssText+="top:"+(g/2-n)+"px;"}},e.prototype.hideImageEditBox=function(e){this.imageEditBoxMap.target=null,this.imageEditBoxMap.graphic=null,this.imageEditBoxMap.interrupt=!!e;var t=this.imageEditBoxMap.parent;t&&(t.style.display="none")},e.prototype.updateSVGImageAttr=function(e,t,o,i){var r=this.imageEditBoxMap,a=r.w0,n=r.h0,s=r.wdiff,d=r.tdiff,h=r.img,l=r.box,c=r.graphic;if(h&&l){l.style.cssText+="width:"+e+"px;height:"+t+"px;left:"+o+"px;top:"+i+"px;",e-=s,t-=s,o+=d,i+=d;var p=Number((e/a).toFixed(7)),g=Number((t/n).toFixed(7));h.setAttribute("transform","translate("+o+", "+i+") scale("+p+", "+g+")");var u=null==c?void 0:c.data;u.x=o,u.y=i,u.ex=o+e,u.ey=i+t}},e.prototype.setGraphicsBox=function(){var e=this.toolInstance.whiteboardNode;this.selectBoxMap.box=e.querySelector(".graphics-box"),this.imageEditBoxMap.parent=e.querySelector(".img-editor-box")},e.prototype.initSelectBox=function(e,t,o,i){this.selectBoxMap.l=e,this.selectBoxMap.t=t,this.selectBoxMap.r=o,this.selectBoxMap.b=i,o-=e,i-=t,this.selectBoxMap.box.style.cssText+="left:"+e+"px;top:"+t+"px;width:"+o+"px;height:"+i+"px;display:block;"},e.prototype.hideSelectBox=function(){this.selectBoxMap.l=0,this.selectBoxMap.t=0,this.selectBoxMap.r=0,this.selectBoxMap.b=0,this.selectBoxMap.box.style.display="none"},e.prototype.setSelectBox=function(){var e,t=this;if("none"===(null===(e=this.imageEditBoxMap.parent)||void 0===e?void 0:e.style.display)){var o=Number.MAX_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,r=0,a=0;this.toolInstance.graphicList.forEach((function(e){if(e.selected){var n=t.toolInstance.getBoxInfoByGraphic(e);if(n){var s=n.x,d=n.y,h=n.width,l=n.height;o=Math.min(o,s),i=Math.min(i,d),r=Math.max(r,s+h),a=Math.max(a,d+l)}}})),r>0&&a>0&&(this.selectBoxMap.l=o,this.selectBoxMap.t=i,this.selectBoxMap.r=r,this.selectBoxMap.b=a,r-=o,a-=i,this.selectBoxMap.box.style.cssText+="left:"+o+"px;top:"+i+"px;width:"+r+"px;height:"+a+"px;display:block;")}},e.prototype.resetMouse=function(){var e=this.toolInstance,t=e.protoGraphic,o=e.whiteboardStore;e.whiteboardNode.removeEventListener(o.moveEventName,this.mousemoveHandle);var i=this.toolInstance.getGraphicsHandle(t.graphic_id);r.removeElement(null==i?void 0:i.parentElement),this.toolInstance.initDrawHandle(),this.isWillMove=!1,this.noMoveUp=!0},e.prototype.updateGraphicsOnMoving=function(e){var t=this,o=e.clientX,i=e.clientY;this.toolInstance.updateMousePointsHandle(o,i);var r=this.toolInstance.calMoveHandle(),n=r[0],s=r[1],d=this.imageEditBoxMap,h=d.tdiff,l=d.parent,c=d.graphic,p=null==c?void 0:c.graphic_id,g=this.toolInstance.graphicList.filter((function(e){return e.selected}));g.forEach((function(e){t.toolInstance.updateGraphicsOffsetHandle(e,n,s);var o=e.graphic_id,i=e.type;if(i===a.GraphicType.Image){var r=(e.initX||0)+e.x,d=(e.initY||0)+e.y,c=e.data,g=e.oldData;g.x=c.x,g.y=c.y,g.ex=c.ex,g.ey=c.ey,c.ex=r+c.ex-c.x,c.ey=d+c.ey-c.y,c.x=r,c.y=d,t.toolInstance.moveGraphicsHandle(o,r,d),p===o&&(r-=h,d-=h,t.imageEditBoxMap.tx1=r,t.imageEditBoxMap.ty1=d,l.style.cssText+="transform:translate("+r+"px,"+d+"px)")}else i!==a.GraphicType.Laser&&t.toolInstance.moveGraphicsHandle(o,e.x,e.y);t.toolInstance.updateBoxHandle(e)}));var u=this.selectBoxMap,f=u.l,v=u.t,m=this.toolInstance.mousePoints,b=m.boxX,w=m.boxY;this.selectBoxMap.box.style.cssText+="left:"+(f+b)+"px;top:"+(v+w)+"px;",this.toolInstance.updateToRemoteHandle(g,a.Action.Move)},e.prototype.updateBoxBorderOnSelector=function(){var e=this,t=this.toolInstance,o=t.protoGraphic,i=t.graphicList,r=this.toolInstance.getGraphicsHandle(o.graphic_id);if(r){var n=r.getBoundingClientRect(),s=n.left,d=n.right,h=n.top,l=n.bottom;i.forEach((function(t){if(t.type!==a.GraphicType.Laser){var o=e.toolInstance.getGraphicsHandle(t.graphic_id);if(o){var i=o.getBoundingClientRect(),r=i.left,n=i.top,c=i.right,p=i.bottom;r===c&&c++,n===p&&p++,t.selected=Math.max(s,r)<Math.min(d,c)&&Math.max(h,n)<Math.min(l,p)}}}))}},e.prototype.getCoverHandle=function(e){var t=this,o=this.toolInstance.whiteboardStore.platform===a.Platform.Pc?e:e.changedTouches[0],i=o.clientX,r=o.clientY,n=0,s=null,d=null;return this.toolInstance.graphicList.forEach((function(e){if(e.type!==a.GraphicType.Laser){var o=t.toolInstance.getBoxHandle(e.graphic_id);if(o){var h=o.getBoundingClientRect(),l=h.left,c=h.top,p=h.right,g=h.bottom;if(i>=l&&i<=p&&r>=c&&r<=g){var u=e.zorder||1;(!n||u>n)&&(n=u,s=e,d=h)}}}})),s&&d?{graphic:s,rect:d}:null},e.prototype.bindEventsHandle=function(){var e=this;if(!this.bindFlag){this.bindFlag=!0;var t=this.toolInstance,o=t.whiteboardStore,i=t.whiteboardNode;this.eventList.forEach((function(t){var r=t.name,a=t.handle;"moveEventName"!==r&&i.addEventListener(o[r],e[a])}))}},e.prototype.removeEventsHandle=function(){var e=this;if(this.bindFlag){this.bindFlag=!1;var t=this.toolInstance,o=t.whiteboardStore,i=t.whiteboardNode;this.eventList.forEach((function(t){var r=t.name,a=t.handle;i.removeEventListener(o[r],e[a])}))}},e.prototype.hideImageEditBoxByList=function(e){var t,o=null===(t=this.imageEditBoxMap.graphic)||void 0===t?void 0:t.graphic_id;e.some((function(e){return e.graphic_id===o}))&&this.hideImageEditBox(),this.hideSelectBox()},e.prototype.hideImageEditBoxByIds=function(e){var t,o=null===(t=this.imageEditBoxMap.graphic)||void 0===t?void 0:t.graphic_id;e.some((function(e){return e===o}))&&this.hideImageEditBox(),this.hideSelectBox()},e}();t.Selector=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(0),r=function(){this.reservedPrefix={whiteboardZoom:"zego-whiteboard-zoom",fileWhiteboardCon:"zego-docsview-con",whiteboardCon:"zego-whiteboard-con",whiteboard:"zego-whiteboard",laserContainer:"zego-other-container",graphicsBgContainer:"zego-graphics-bg-container",graphicsContainer:"zego-graphics-container",graphicsSvg:"zego-svg",textareaCon:"zego-textarea",laserCon:"zego-laser",graphics:"zego-graphics",boxContainer:"zego-box-container",graphicsBox:"zego-graphics-box"},this.basicState={type:i.ZegoWhiteboardTool.ZegoWhiteboardViewToolPen,size:6,fontSize:24,color:"#0044FF",bgColor:"rgb(241, 243, 244)",attributes:'{"bold": false, "italic": false}'},this.basicExtraState={drawSize:0,drawFontSize:0,scroll:i.ScrollMode.Page},this.boxPadding=0,this.textareaBoxPadding=24,this.textareaHPadding=6,this.textareaVPadding=0,this.textareaConBorderWidth=1,this.lineHeight=1.5,this.boxBorderWidth=2,this.maxlength=200,this.scrollbarSize=20,this.initLaserX=0,this.initLaserY=0,this.hiddenLaserX=-100,this.hiddenLaserY=-100,this.hiddenLaserDelay=5e3,this.wheelEventName="wheel",navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i)?(this.platform=2,this.downEventName="touchstart",this.upEventName="touchend",this.moveEventName="touchmove",this.leaveEventName=""):(this.platform=1,this.downEventName="mousedown",this.upEventName="mouseup",this.moveEventName="mousemove",this.leaveEventName="mouseleave")};t.ZegoWhiteboardStore=r},function(e,t,o){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var n=o(30),s=o(7),d=o(2),h=o(0),l=function(e){function t(t,o){var i=e.call(this,o,"electron")||this;return i.modIdMapData={},i.listenerList={},i.zorderSeq=1,i.zegoAdapter=t,i}return r(t,e),t.prototype.updateMap=function(e){var t=this.getMap(e.whiteboardID);t?Object.assign(t,e):this.modIdMapData[e.whiteboardID]=a({direction:h.ZegoWhiteboardViewScrollDirection.Horizontal,viewWidth:0,viewHeight:0,viewportWidth:0,viewportHeight:0,horizontalPercent:0,verticalPercent:0,pptStep:1,h5Extra:""},e)},t.prototype.getMap=function(e){return this.modIdMapData[e]},t.prototype.deleteMap=function(e){delete this.modIdMapData[e]},t.prototype.actionListener=function(e){for(var t,o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];this.listenerList[e]&&(t=this.listenerList)[e].apply(t,o)},t.prototype.bindListener=function(e,t){this.listenerList[e]=t},t.prototype.getDirection=function(e){return this.getMap(e).direction},t.prototype.getModName=function(e){var t=this.getMap(e);return t?t.name:""},t.prototype.getScrollPercent=function(e){var t=this.getMap(e);return{horizontalPercent:t.horizontalPercent,verticalPercent:t.verticalPercent,pptStep:t.pptStep}},t.prototype.getAspectRatio=function(e){var t=this.getMap(e);return t.aspectWidth+":"+t.aspectHeight},t.prototype.getRoomID=function(e){return this.getMap(e).roomID},t.prototype.getPageCount=function(e){return this.getMap(e).pageCount},t.prototype.getFileInfo=function(e){var t=this.getMap(e);return(null==t?void 0:t.fileInfo)||null},t.prototype.setSize=function(e,t,o){var i=this.getMap(e);return!!(i&&t&&o)&&(i.viewWidth=t,i.viewHeight=o,i.direction=t>=o?h.ZegoWhiteboardViewScrollDirection.Horizontal:h.ZegoWhiteboardViewScrollDirection.Vertical,this.zegoAdapter.setSize(+e,{width:t,height:o},{width:i.viewportWidth,height:i.viewportHeight}),!0)},t.prototype.setViewportSize=function(e,t,o){var i=this.getMap(e);i&&t&&o&&(i.viewportWidth=t,i.viewportHeight=o,this.zegoAdapter.setSize(+e,{width:i.viewWidth,height:i.viewHeight},{width:t,height:o}))},t.prototype.undo=function(e,t,o){this.zegoAdapter.undo(+e)},t.prototype.redo=function(e,t,o){this.zegoAdapter.redo(+e)},t.prototype.createMod=function(e,t,o){var i=this;this.zegoAdapter.createMod(e,(function(r){var n=r.resBody,d=n.code,h=n.message,l=n.mod_id;0===d?(i.updateMap(a({whiteboardID:l},e)),t(l)):o(s.transError(d,h))}))},t.prototype.setMod=function(e,t,o){this.zegoAdapter.setMod(e)},t.prototype.destroyMod=function(e,t,o){var i=this;this.zegoAdapter.destroyMod(+e,(function(e){var r=e.resBody,a=r.code,n=r.message,d=r.mod_id;0===a?(t(d+""),i.deleteMap(d+"")):o(s.transError(a,n))}))},t.prototype.clearView=function(e,t,o){this.zegoAdapter.clearView(+e)},t.prototype.updateToRemote=function(e,t,o,i){t.forEach((function(e){e.color=d.transColor(e.color,!1)})),this.zegoAdapter.updateToRemoteHandle(+e,t),null==i||i()},t.prototype.getModList=function(e,t,o){var i=this;this.zegoAdapter.getModList((function(e){var r=e.resBody,a=r.code,n=r.message,d=r.mod_list;0===a?(d.forEach((function(e){i.updateMap(e)})),t(d.map((function(e){return e.whiteboardID+""})))):o(s.transError(a,n))}))},t.prototype.scroll=function(e,t,o,i,r,a){var n=this;this.zegoAdapter.scroll({whiteboard_id:+e,horizontal_percent:t,vertical_percent:o,step:i},!0,(function(e){var r=e.resBody,a=r.code,s=r.mod_id;0==a&&n.updateMap({whiteboardID:s,horizontalPercent:t,verticalPercent:o,pptStep:i})}))},t.prototype.loadCurrentGraphics=function(e,t,o){this.zegoAdapter.scroll({whiteboard_id:+e,horizontal_percent:t,vertical_percent:o,step:1},!1)},t.prototype.getCreateTime=function(e){return 0},t.prototype.getUserName=function(){return""},t.prototype.appendH5Extra=function(e,t){var o=this;this.zegoAdapter.appendH5Extra({whiteboard_id:+e,extra:t},(function(i){var r=i.resBody,a=r.code,n=r.mod_id;if(0===a&&e==n){var s=o.getH5Extra(n);try{if(s&&t){s=JSON.parse(s).H5_target;var d=JSON.parse(t).H5_target,h=d.p,l=d.s,c=d.e;s.p==h&&s.s==l&&(t=JSON.stringify({H5_target:{p:h,s:l,e:s.e.concat(c)}}))}o.updateMap({whiteboardID:n,h5Extra:t})}catch(c){}}}))},t.prototype.getH5Extra=function(e){return this.getMap(e).h5Extra},t.prototype.updateCache=function(e){},t.prototype.onRemotePush=function(){var e=this;this.zegoAdapter.onEventHandler("onPushDrawGraphics",(function(t){var o=t.resBody,i=o.graphic_list,r=o.del_graphic_id_list,a=o.mod_id+"";if(i){var n=d.transColor(e.whiteboardStore.basicState.color,!1);i.forEach((function(t){t.zorder&&t.zorder>e.zorderSeq&&(e.zorderSeq=t.zorder),"number"!=typeof t.color&&(t.color=n),t.color=d.transColor(t.color,!0)}))}e.actionListener("pushDrawPageGraphics",a,[{graphic_list:i||[],del_graphic_id_list:r}])})),this.zegoAdapter.onEventHandler("onPushClearGraphics",(function(t){e.actionListener("pushClearPageGraphics",t.resBody.mod_id+"")})),this.zegoAdapter.onEventHandler("onPushScrolled",(function(t){var o=t.resBody,i=o.whiteboard_id,r=o.horizontal_scroll_percent,a=o.vertical_scroll_percent,n=o.step;r=Number(r.toFixed(4)),a=Number(a.toFixed(4)),e.updateMap({whiteboardID:i,horizontalPercent:r,verticalPercent:a,pptStep:n}),e.actionListener("pushScroll",i,r,a,n)})),this.zegoAdapter.onEventHandler("onPushSetMod",(function(t){var o=t.resBody.action_list,i=o[0],r=i.action,a=i.mod_id;2===r?(e.deleteMap(a),e.actionListener("pushRemovedMod",a)):1===r&&(e.updateMap(o[0]),e.actionListener("pushAddMod",a))})),this.zegoAdapter.onEventHandler("onPushH5Extra",(function(t){var o=t.resBody,i=o.mod_id,r=o.extra,a=e.getH5Extra(i);e.updateMap({whiteboardID:i,h5Extra:r});try{if(a&&r){a=JSON.parse(a).H5_target;var n=JSON.parse(r).H5_target,s=n.p,d=n.s,h=n.e;a.p==s&&a.s==d&&a.e.length<h.length&&(r=JSON.stringify({H5_target:{p:s,s:d,e:h.slice(a.e.length)}}))}}catch(h){}e.actionListener("h5ExtraAppendedNotify",i,r)}))},t.prototype.uploadImage=function(e,t){var o=this;return new Promise((function(t,i){"object"==typeof e&&(e=e.path);var r=o.zegoAdapter.uploadFile(e);if(!r){var a=s.transError(h.ZegoWhiteboardError.ZegoWhiteboardViewErrorInternal);i(a)}o.zegoAdapter.onEventHandler("onUploadFile"+r,(function(e){var a=e.resBody,n=a.url,d=a.finish,h=a.code;if(0!==h){var l=s.transError(h);i(l)}d&&(o.zegoAdapter.onEventHandler("onUploadFile"+r,null),t(n))}))}))},t.prototype.setDeferredRenderingTime=function(e){},t.prototype.createZorder=function(){return++this.zorderSeq},t}(n.ZegoWhiteboardServiceBase);t.ZegoWhiteboardService=l},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.isElectron=!1,this.customListenerList={error:[],viewAdd:[],viewRemoved:[],viewScroll:[]},this.isElectron="electron"===t,this.whiteboardStore=e}return e.prototype.bindCustomListener=function(e,t){return!!this.customListenerList[e]&&("function"==typeof t&&(-1==this.customListenerList[e].indexOf(t)&&this.customListenerList[e].push(t),!0))},e.prototype.deleteCustomListener=function(e,t){if(!this.customListenerList[e])return!1;var o=this.customListenerList[e];return t?o.splice(o.indexOf(t),1):this.customListenerList[e]=[],!0},e.prototype.actionCustomListener=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];this.customListenerList[e]&&this.customListenerList[e].forEach((function(e){e.apply(void 0,t)}))},e}();t.ZegoWhiteboardServiceBase=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(0),r=o(1),a=r.getLogAction.bind(null,"wb.s."),n=function(e){},s={},d={},h=function(e){return s[e]||+e},l=function(e){return d[e]||+e},c=function(){function e(e){this.inited=!1,this.zegoClient=null,this.eventHandler={onCreateMod:n,onDestroyMod:n,onGetModList:n,onSendScroll:n,onAppendH5Extra:n,onPushDrawGraphics:n,onPushClearGraphics:n,onPushSetMod:n,onPushScrolled:n,onPushH5Extra:n,onUploadFile:n},this.zegoClient=e,this.init()}return e.prototype.onEventHandler=function(e,t){this.eventHandler[e]=t},e.prototype.createMod=function(e,t){var o=e.name,i=e.aspectWidth,n=e.aspectHeight,s=e.roomID,d=e.pageCount,h=e.fileInfo;t&&this.onEventHandler("onCreateMod",t);var l=this.zegoClient.whiteboardModelMake({mode:1}),c=this.zegoClient.whiteboardModelGetId({whiteboard_model:l});this.zegoClient.whiteboardModelSetName({whiteboard_model:l,name:o}),this.zegoClient.whiteboardModelSetAspectRatio({whiteboard_model:l,width:+i,height:+n}),this.setFileContent(l,s,d,h),this.zegoClient.whiteboardCreate({whiteboard_model:l,is_public:!0,width:+i,height:+n}),r.Logger.info(a("mod.create"),JSON.stringify({mod_id:c,params:e}))},e.prototype.destroyMod=function(e,t){t&&this.onEventHandler("onDestroyMod",t),this.zegoClient.whiteboardDestroy({whiteboard_id:e}),r.Logger.info(a("mod.destroy"),JSON.stringify({params:e}))},e.prototype.setMod=function(e){},e.prototype.getModList=function(e){e&&this.onEventHandler("onGetModList",e),this.zegoClient.whiteboardGetList()},e.prototype.undo=function(e){this.zegoClient.whiteboardCanvasUndo({whiteboard_id:e}),r.Logger.info(a("gra.undo"),JSON.stringify({params:e}))},e.prototype.redo=function(e){this.zegoClient.whiteboardCanvasRedo({whiteboard_id:e}),r.Logger.info(a("gra.redo"),JSON.stringify({params:e}))},e.prototype.clearView=function(e){this.zegoClient.whiteboardCanvasClear({whiteboard_id:e}),r.Logger.info(a("gra.clear"),JSON.stringify({params:e}))},e.prototype.uploadFile=function(e){return r.Logger.info(a("gra.upload"),JSON.stringify({params:e})),this.zegoClient.whiteboardUploadFile({path:e})},e.prototype.updateToRemoteHandle=function(e,t){if(r.Logger.info(a("gra.draw"),JSON.stringify({mod_id:e,params:t})),t.length>1){if(t.every((function(e){return e.action==i.Action.Move}))){var o=[].concat(t.map((function(e){return{graphic_id:l(e.graphic_id),x:e.x,y:e.y}})));this.zegoClient.whiteboardCanvasMoveItems({whiteboard_id:e,move_info_list:o})}if(t.every((function(e){return e.action==i.Action.Delete}))){var n=[].concat(t.map((function(e){return{graphic_id:l(e.graphic_id)}})));this.zegoClient.whiteboardCanvasDeleteItems({whiteboard_id:e,delete_list:n})}}else for(var s=0;s<t.length;++s){var d=t[s],h=d.action;if(h==i.Action.Create)this.executeDrawNewGraphic(e,d);else if(h==i.Action.Move){var c=d.x,p=d.y,g=l(d.graphic_id);this.zegoClient.whiteboardCanvasMoveItem({whiteboard_id:e,graphic_id:g,x:c,y:p})}else if(h==i.Action.Delete){g=l(d.graphic_id);this.zegoClient.whiteboardCanvasDeleteItem({whiteboard_id:e,graphic_id:g}),r.Logger.info(a("gra.delete"),JSON.stringify({mod_id:e,gid:g,_gid:d.graphic_id}))}else if(h==i.Action.Update&&d.type==i.GraphicType.Image){g=l(d.graphic_id);var u=d.data;this.zegoClient.whiteboardCanvasEditImage({whiteboard_id:e,graphic_id:g,pos_x:u.x,pos_y:u.y,epos_x:u.ex,epos_y:u.ey}),r.Logger.info(a("gra.update"),JSON.stringify({mod_id:e,gid:g,_gid:d.graphic_id,draw_item:d}))}else if(h==i.Action.Update&&d.type==i.GraphicType.Text){g=l(d.graphic_id);this.setGraphicAttr(d.type,d.color,d.size,d.attributes);var f=d.data.split(",");this.zegoClient.whiteboardCanvasEditText({whiteboard_id:e,graphic_id:g,text:f.slice(2).join(",")}),r.Logger.info(a("gra.update"),JSON.stringify({mod_id:e,gid:g,_gid:d.graphic_id}))}}},e.prototype.setSize=function(e,t,o){e&&t.width&&t.height&&o.width&&o.height&&(r.Logger.info(a("mod.setSize"),JSON.stringify({params:{id:e,realSize:t,viewSize:o}})),this.zegoClient.whiteboardSetSize({whiteboard_id:e,width:t.width,height:t.height}),this.zegoClient.whiteboardSetViewportSize({whiteboard_id:e,width:o.width,height:o.height}))},e.prototype.scroll=function(e,t,o){t?(this.zegoClient.whiteboardScrollCanvas(e),o&&this.onEventHandler("onSendScroll",o)):this.zegoClient.whiteboardLoadCurrentGraphics(e),r.Logger.info(a("mod.scroll"),JSON.stringify({notify:t,params:e}))},e.prototype.appendH5Extra=function(e,t){t&&this.onEventHandler("onAppendH5Extra",t),this.zegoClient.whiteboardAppendH5Extra(e),r.Logger.info(a("mod.append_h5extra"),"mod_id="+e.whiteboard_id+",extra="+e.extra)},e.prototype.init=function(){this.inited&&this.zegoClient.whiteboardUninit(),this.registerWhiteBoardEventCallBack(),this.inited=this.zegoClient.whiteboardInit(),this.inited||(this.callCreateModCallBack(-1,"createMod failed: whiteboard init failed",0),r.Logger.info(a("mod.init"),"init failed"))},e.prototype.createGraphicId=function(e,t,o,i){return this.zegoClient.whiteboardCanvasBeginDraw({whiteboard_id:+e,graphic_type:t,x:o,y:i})},e.prototype.setGraphicAttr=function(e,t,o,r){this.zegoClient.whiteboardSettingsSetGraphicColor({graphic_type:e,color:t}),this.zegoClient.whiteboardSettingsSetGraphicSize({graphic_type:e,size_level:+o});var a=!1,n=!1;try{var s=JSON.parse(r||"{}");a=!!s.bold,n=!!s.italic}catch(e){}this.zegoClient.whiteboardSettingsSetGraphicBold({graphic_type:i.GraphicType.Text,is_bold:a}),this.zegoClient.whiteboardSettingsSetGraphicItalic({graphic_type:i.GraphicType.Text,is_italic:n})},e.prototype.getModInfo=function(e){var t={whiteboard_model:e},o=this.zegoClient.whiteboardModelGetScrollPercent({whiteboard_model:e,direction:2})||{},i=this.zegoClient.whiteboardModelGetAspectRatio(t),n=i.width,s=i.height,d=this.zegoClient.whiteboardModelGetH5Extra&&this.zegoClient.whiteboardModelGetH5Extra(t),h={whiteboardID:this.zegoClient.whiteboardModelGetId(t)+"",name:this.zegoClient.whiteboardModelGetName(t),aspectWidth:+n,aspectHeight:+s,horizontalPercent:o.horizontal_percent||0,verticalPercent:o.vertical_percent||0,pptStep:o.step||1,h5Extra:d},l=this.zegoClient.whiteboardModelGetContent(t);if(l)try{var c=JSON.parse(l);if(c){h.roomID=c.room_id,h.pageCount=c.whiteboard_page_count||1;var p=c.file_info;p&&(h.fileInfo={fileID:p.file_id,fileName:p.file_name,authKey:p.auth_key,fileType:p.file_type})}}catch(e){}return r.Logger.info(a("mod.info"),JSON.stringify({scroll:o,content:l,mod_item:h})),h},e.prototype.setFileContent=function(e,t,o,i){this.zegoClient.whiteboardModelSetContent({whiteboard_model:e,content:JSON.stringify({room_id:t,whiteboard_page_count:o||void 0,file_info:i?{file_id:i.fileID,file_name:i.fileName,auth_key:i.authKey,file_type:i.fileType}:void 0})})},e.prototype.getGraphicBoundingClientRect=function(e,t){if(e==i.GraphicType.Text){var o=t.split(",");return{x1:+o[0],y1:+o[1],x2:o.slice(2).join(",")}}return e==i.GraphicType.Pencil||e==i.GraphicType.Line?{x1:t[0],y1:t[1]}:e==i.GraphicType.Image?{x1:t.x,y1:t.y}:{x1:Math.min(t[0],t[2]),y1:Math.min(t[1],t[3]),x2:Math.max(t[0],t[2]),y2:Math.max(t[1],t[3])}},e.prototype.getGraphicLeftTop=function(e,t){if(e==i.GraphicType.Laser)return{x:0,y:0};if(e==i.GraphicType.Text){var o=t.split(",");return{x:+o[0],y:+o[1]}}if(e==i.GraphicType.Pencil){for(var r=t[0],a=t[1],n=2;n<t.length;n+=2)t[n]<r&&(r=t[n]),t[n+1]<a&&(a=t[n+1]);return{x:r,y:a}}var s=t[0],d=t[1],h=t[2],l=t[3];return{x:Math.min(s,h),y:Math.min(d,l)}},e.prototype.executeDrawNewGraphic=function(e,t){e=+e;var o=t.type,n=t.data;this.setGraphicAttr(o,t.color,t.size,t.attributes);var h=this.getGraphicBoundingClientRect(o,n),l=this.createGraphicId(e,o,h.x1,h.y1);if(s[l]=+t.graphic_id,d[t.graphic_id]=l,o==i.GraphicType.Pencil){for(var c=t.data,p=2;p<c.length;p+=2)this.zegoClient.whiteboardCanvasDrawPath({whiteboard_id:e,x:c[p],y:c[p+1]});this.zegoClient.whiteboardCanvasEndDraw({whiteboard_id:e})}else if(o==i.GraphicType.Text)this.zegoClient.whiteboardCanvasDrawText({whiteboard_id:e,text:h.x2}),this.zegoClient.whiteboardCanvasEndDraw({whiteboard_id:e});else if(o==i.GraphicType.Line)this.zegoClient.whiteboardCanvasDrawLine({whiteboard_id:e,x:t.data[2],y:t.data[3]}),this.zegoClient.whiteboardCanvasEndDraw({whiteboard_id:e});else if(o==i.GraphicType.Rect)this.zegoClient.whiteboardCanvasDrawRect({whiteboard_id:e,x:h.x2,y:h.y2}),this.zegoClient.whiteboardCanvasEndDraw({whiteboard_id:e});else if(o==i.GraphicType.Ellipse)this.zegoClient.whiteboardCanvasDrawEllipse({whiteboard_id:e,x:h.x2,y:h.y2}),this.zegoClient.whiteboardCanvasEndDraw({whiteboard_id:e});else if(o==i.GraphicType.Laser)this.zegoClient.whiteboardCanvasEndDraw({whiteboard_id:e});else if(o==i.GraphicType.Image){var g="string"==typeof t.data?JSON.parse(t.data):t.data;this.zegoClient.whiteboardCanvasAddImage({whiteboard_id:e,path:g.url,pos_x:g.ex,pos_y:g.ey,hash:""}),this.zegoClient.whiteboardCanvasEndDraw({whiteboard_id:e})}r.Logger.info(a("gra.create"),JSON.stringify({mod_id:e,type:o,gid:l,_gid:t.graphic_id,data:t.data}))},e.prototype.callCreateModCallBack=function(e,t,o){var i={resBody:{code:e,message:t,mod_id:o+""}};this.eventHandler.onCreateMod(i)},e.prototype.callPushDrawGraphicsCallback=function(e,t){var o={resBody:{graphic_list:[t],mod_id:e.whiteboard_id+""}};this.eventHandler.onPushDrawGraphics(o)},e.prototype.onWhiteBoardCanvasPathUpdate=function(e){for(var t=e.points.length,o=new Array(2*t).fill(0),n=0;n<t;n++){var s=e.points[n],d=s.x,l=s.y;o[2*n]=d,o[2*n+1]=l}var c=e.pos_x,p=e.pos_y,g={_graphic_id:e.graphic_id+"",graphic_id:h(e.graphic_id)+"",data:o,x:c,y:p,type:i.GraphicType.Pencil,color:e.graphic_color,size:e.graphic_size,zorder:e.zorder};this.callPushDrawGraphicsCallback(e,g),r.Logger.info(a("gra.update"),JSON.stringify({type:i.GraphicType.Pencil,result:g,remote:e}))},e.prototype.onWhiteBoardCanvasTextUpdate=function(e){var t=e.pos_x,o=e.pos_y,n={_graphic_id:e.graphic_id+"",graphic_id:h(e.graphic_id)+"",data:e.point_begin.x+","+e.point_begin.y+","+e.text,x:t,y:o,zorder:e.zorder,type:i.GraphicType.Text,color:e.graphic_color,size:e.graphic_size,attributes:JSON.stringify({bold:!!e.is_bold,italic:!!e.is_italic})};this.callPushDrawGraphicsCallback(e,n),r.Logger.info(a("gra.update"),JSON.stringify({type:i.GraphicType.Text,result:n,remote:e}))},e.prototype.onWhiteBoardCanvasImageUpdate=function(e){var t=e.pos_x,o=e.pos_y,n=e.point_begin,s=e.point_end,d={_graphic_id:e.graphic_id+"",graphic_id:h(e.graphic_id)+"",data:{x:n.x+t,y:n.y+o,ex:s.x+t,ey:s.y+o,url:e.path},x:t,y:o,initX:n.x,initY:n.y,zorder:e.zorder,path:e.path,type:i.GraphicType.Image,finished:e.is_finished,progress:e.progress};this.callPushDrawGraphicsCallback(e,d),r.Logger.info(a("gra.update"),JSON.stringify({type:i.GraphicType.Image,result:d,remote:e}))},e.prototype.onGraphicUpdate=function(e,t){var o=e===i.GraphicType.Laser?[t.point.x,t.point.y]:[t.point_begin.x,t.point_begin.y,t.point_end.x,t.point_end.y],n=t.pos_x,s=t.pos_y,d={_graphic_id:t.graphic_id+"",graphic_id:h(t.graphic_id)+"",data:o,x:n,y:s,zorder:t.zorder,type:e,color:t.graphic_color,size:t.graphic_size};this.callPushDrawGraphicsCallback(t,d),r.Logger.info(a("gra.update"),JSON.stringify({type:e,result:d,remote:t}))},e.prototype.registerWhiteBoardEventCallBack=function(){var e=this;this.zegoClient.onEventHandler("onWhiteBoardCreate",(function(t){var o=e.zegoClient.whiteboardModelGetId({whiteboard_model:t.whiteboard_model});e.callCreateModCallBack(0,"ok",o),r.Logger.info(a("mod.create"),JSON.stringify({result:o}))})),this.zegoClient.onEventHandler("onWhiteBoardAdded",(function(t){var o=e.getModInfo(t.whiteboard_model);o.action=1,o.mod_id=o.whiteboardID,e.eventHandler.onPushSetMod({resBody:{action_list:[o]}}),r.Logger.info(a("mod.added"),JSON.stringify({result:o}))})),this.zegoClient.onEventHandler("onWhiteBoardDestroy",(function(t){e.eventHandler.onDestroyMod({resBody:{code:t.error_code,message:"",mod_id:t.whiteboard_id+""}}),r.Logger.info(a("mod.destroy"),JSON.stringify({result:t}))})),this.zegoClient.onEventHandler("onWhiteBoardRemoved",(function(t){e.eventHandler.onPushSetMod({resBody:{action_list:[{action:2,mod_id:t.whiteboard_id+""}]}}),r.Logger.info(a("mod.removed"),JSON.stringify({result:t}))})),this.zegoClient.onEventHandler("onWhiteBoardCanvasClear",(function(t){e.eventHandler.onPushClearGraphics({resBody:{code:0,message:"ok",mod_id:t.whiteboard_id+""}}),r.Logger.info(a("gra.clear"),JSON.stringify({result:t}))})),this.zegoClient.onEventHandler("onWhiteBoardGetList",(function(t){for(var o=[],i=0;i<t.whiteboard_model_list.length;++i){var n=e.getModInfo(t.whiteboard_model_list[i].whiteboard_model);o.push(n)}var s={resBody:{code:0,message:"ok",mod_list:o}};e.eventHandler.onGetModList(s),r.Logger.info(a("mod.list"),JSON.stringify({result:o}))})),this.zegoClient.onEventHandler("onWhiteBoardScrollCanvas",(function(t){t.error_code,e.eventHandler.onSendScroll({resBody:{code:t.error_code,mod_id:t.whiteboard_id+""}})})),this.zegoClient.onEventHandler("onWhiteBoardCanvasScrolled",(function(t){e.eventHandler.onPushScrolled({resBody:t})})),this.zegoClient.onEventHandler("onWhiteBoardCanvasItemDeleted",(function(t){var o={resBody:{del_graphic_id_list:[h(t.graphic_id)],mod_id:t.whiteboard_id+""}};e.eventHandler.onPushDrawGraphics(o),r.Logger.info(a("gra.deleted"),JSON.stringify({result:o.resBody}))})),this.zegoClient.onEventHandler("onWhiteBoardAppendH5ExtraCallback",(function(t){var o={resBody:{code:t.error_code,mod_id:t.whiteboard_id+""}};e.eventHandler.onAppendH5Extra(o)})),this.zegoClient.onEventHandler("onWhiteBoardH5ExtraAppendedNotify",(function(t){var o={resBody:{extra:t.extra,mod_id:t.whiteboard_id+""}};e.eventHandler.onPushH5Extra(o),r.Logger.info(a("mod.update_h5extra"),"mod_id="+t.whiteboard_id+",extra="+t.extra)})),this.zegoClient.onEventHandler("onWhiteBoardUploadFile",(function(t){var o={resBody:{code:t.error_code,finish:t.finish,rate:t.rate,url:t.url,file_id:t.file_id,hash:t.hash,seq:t.seq}};e.eventHandler["onUploadFile"+t.seq](o),r.Logger.info(a("mod.update_file"),JSON.stringify(o.resBody))})),this.zegoClient.onEventHandler("onWhiteBoardCanvasPathUpdate",this.onWhiteBoardCanvasPathUpdate.bind(this)),this.zegoClient.onEventHandler("onWhiteBoardCanvasTextUpdate",this.onWhiteBoardCanvasTextUpdate.bind(this)),this.zegoClient.onEventHandler("onWhiteBoardCanvasImageUpdate",this.onWhiteBoardCanvasImageUpdate.bind(this)),[{key:"Line",value:i.GraphicType.Line},{key:"Rect",value:i.GraphicType.Rect},{key:"Ellipse",value:i.GraphicType.Ellipse},{key:"Laser",value:i.GraphicType.Laser}].forEach((function(t){var o=t.key,i=t.value;e.zegoClient.onEventHandler("onWhiteBoardCanvas"+o+"Update",e.onGraphicUpdate.bind(e,i))}))},e}();t.ZegoAdapter=c},function(e,t,o){var i=o(5),r=o(33);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var a={insert:"head",singleton:!1};i(r,a);e.exports=r.locals||{}},function(e,t,o){(t=o(6)(!1)).push([e.i,"[id^='zego-whiteboard-zoom'] {\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n}\n\n[id^='zego-whiteboard-con'],\n[id^='zego-whiteboard-con'] > div {\n    transform-origin: 0 0;\n}\n\n[id^='zego-whiteboard'] {\n    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n    position: absolute;\n}\n[id^='zego-whiteboard'] *,\n[id^='zego-whiteboard'] ::after,\n[id^='zego-whiteboard'] ::before {\n    box-sizing: border-box !important;\n}\n[id^='zego-whiteboard'] [id^='zego-graphics-bg-container'] {\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    left: 0;\n    top: 0;\n}\n[id^='zego-whiteboard'] [id^='zego-graphics-container'] {\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    left: 0;\n    top: 0;\n    overflow: hidden;\n}\n[id^='zego-whiteboard'] [id^='zego-box-container'] {\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    left: 0;\n    top: 0;\n    overflow: hidden;\n}\n[id^='zego-whiteboard'] svg {\n    transform-origin: 0px 0px 0px;\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    margin: 0px;\n    padding: 0px;\n    left: 0;\n    right: 0;\n    pointer-events: none;\n}\n[id^='zego-whiteboard'] textarea {\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n    border: none;\n    outline: none;\n    background: transparent;\n    resize: none;\n    position: absolute;\n    top: 0;\n    right: 0;\n    left: 0;\n    bottom: 0;\n    padding: 0 6px;\n    line-height: 1.5;\n    font-family: inherit;\n    font-size: inherit;\n    box-sizing: border-box;\n    color: inherit;\n    font-style: inherit;\n    font-weight: inherit;\n    white-space: pre-wrap;\n    word-break: break-all;\n    overflow: hidden;\n}\n[id^='zego-whiteboard'] pre {\n    display: block;\n    visibility: hidden;\n    margin: 0px 0px;\n    font-family: inherit;\n    font-size: inherit;\n    color: inherit;\n    font-style: inherit;\n    font-weight: inherit;\n    line-height: 1.5;\n    padding: 0 6px;\n}\n[id^='zego-graphics-box'] {\n    position: absolute;\n}\n[id^='zego-textarea'] {\n    position: absolute;\n    border: 1px dashed transparent;\n}\n[id^='zego-other-container'] {\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    left: 0;\n    top: 0;\n    cursor: none;\n    overflow: hidden;\n}\n[id^='zego-other-container'] div {\n    box-sizing: border-box;\n}\n[id^='zego-laser'] {\n    width: 16px;\n    height: 16px;\n    border-radius: 50%;\n    background: rgba(255, 78, 51, 1);\n    border: 2px solid rgba(255, 144, 128, 1);\n    box-shadow: 0px 0px 8px 0px rgba(254, 94, 70, 0.7);\n    position: absolute;\n    left: 0;\n    top: 0;\n}\n\n[id^='zego-box-container'] .img-editor-box,\n[id^='zego-box-container'] .graphics-box {\n    display: none;\n    position: absolute;\n    overflow: visible;\n    margin: 0;\n    padding: 0;\n    z-index: 2;\n    border: 2px solid #b0b3b8;\n    box-shadow: 0 0 1px 0 #ffffff, inset 0 0 1px 0 #ffffff;\n    transform-origin: 0px 0px 0px;\n}\n\n[id^='zego-box-container'] .operation-point-desktop {\n    width: 12px;\n    height: 12px;\n    position: absolute;\n    background-color: #ffffff;\n    border: 2px solid #b0b3b8;\n}\n[id^='zego-box-container'] .operation-point-desktop:active,\n[id^='zego-box-container'] .operation-point-desktop:hover {\n    transform: scale(1.5);\n    border: 2px solid #eb98c7;\n}\n\n[id^='zego-box-container'] .operation-point-desktop.left-top {\n    left: -6px;\n    top: -6px;\n    cursor: nwse-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.right-top {\n    right: -6px;\n    top: -6px;\n    cursor: nesw-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.left-bottom {\n    left: -6px;\n    bottom: -6px;\n    cursor: nesw-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.right-bottom {\n    right: -6px;\n    bottom: -6px;\n    cursor: nwse-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.top {\n    top: -6px;\n    cursor: ns-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.right {\n    right: -6px;\n    cursor: ew-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.bottom {\n    bottom: -6px;\n    cursor: ns-resize;\n}\n[id^='zego-box-container'] .operation-point-desktop.left {\n    left: -6px;\n    cursor: ew-resize;\n}\n",""]),e.exports=t},function(e,t,o){"use strict";o.r(t),o.d(t,"v1",(function(){return g})),o.d(t,"v3",(function(){return x})),o.d(t,"v4",(function(){return I})),o.d(t,"v5",(function(){return T}));var i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),r=new Uint8Array(16);function a(){if(!i)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(r)}for(var n=[],s=0;s<256;++s)n[s]=(s+256).toString(16).substr(1);var d,h,l=function(e,t){var o=t||0,i=n;return[i[e[o++]],i[e[o++]],i[e[o++]],i[e[o++]],"-",i[e[o++]],i[e[o++]],"-",i[e[o++]],i[e[o++]],"-",i[e[o++]],i[e[o++]],"-",i[e[o++]],i[e[o++]],i[e[o++]],i[e[o++]],i[e[o++]],i[e[o++]]].join("")},c=0,p=0;var g=function(e,t,o){var i=t&&o||0,r=t||[],n=(e=e||{}).node||d,s=void 0!==e.clockseq?e.clockseq:h;if(null==n||null==s){var g=e.random||(e.rng||a)();null==n&&(n=d=[1|g[0],g[1],g[2],g[3],g[4],g[5]]),null==s&&(s=h=16383&(g[6]<<8|g[7]))}var u=void 0!==e.msecs?e.msecs:(new Date).getTime(),f=void 0!==e.nsecs?e.nsecs:p+1,v=u-c+(f-p)/1e4;if(v<0&&void 0===e.clockseq&&(s=s+1&16383),(v<0||u>c)&&void 0===e.nsecs&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");c=u,p=f,h=s;var m=(1e4*(268435455&(u+=122192928e5))+f)%4294967296;r[i++]=m>>>24&255,r[i++]=m>>>16&255,r[i++]=m>>>8&255,r[i++]=255&m;var b=u/4294967296*1e4&268435455;r[i++]=b>>>8&255,r[i++]=255&b,r[i++]=b>>>24&15|16,r[i++]=b>>>16&255,r[i++]=s>>>8|128,r[i++]=255&s;for(var w=0;w<6;++w)r[i+w]=n[w];return t||l(r)};var u=function(e,t,o){var i=function(e,i,r,a){var n=r&&a||0;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=new Array(e.length),o=0;o<e.length;o++)t[o]=e.charCodeAt(o);return t}(e)),"string"==typeof i&&(i=function(e){var t=[];return e.replace(/[a-fA-F0-9]{2}/g,(function(e){t.push(parseInt(e,16))})),t}(i)),!Array.isArray(e))throw TypeError("value must be an array of bytes");if(!Array.isArray(i)||16!==i.length)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var s=o(i.concat(e));if(s[6]=15&s[6]|t,s[8]=63&s[8]|128,r)for(var d=0;d<16;++d)r[n+d]=s[d];return r||l(s)};try{i.name=e}catch(e){}return i.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",i.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",i};function f(e,t){var o=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(o>>16)<<16|65535&o}function v(e,t,o,i,r,a){return f((n=f(f(t,e),f(i,a)))<<(s=r)|n>>>32-s,o);var n,s}function m(e,t,o,i,r,a,n){return v(t&o|~t&i,e,t,r,a,n)}function b(e,t,o,i,r,a,n){return v(t&i|o&~i,e,t,r,a,n)}function w(e,t,o,i,r,a,n){return v(t^o^i,e,t,r,a,n)}function y(e,t,o,i,r,a,n){return v(o^(t|~i),e,t,r,a,n)}var x=u("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Array(t.length);for(var o=0;o<t.length;o++)e[o]=t.charCodeAt(o)}return function(e){var t,o,i,r=[],a=32*e.length;for(t=0;t<a;t+=8)o=e[t>>5]>>>t%32&255,i=parseInt("0123456789abcdef".charAt(o>>>4&15)+"0123456789abcdef".charAt(15&o),16),r.push(i);return r}(function(e,t){var o,i,r,a,n;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var s=1732584193,d=-271733879,h=-1732584194,l=271733878;for(o=0;o<e.length;o+=16)i=s,r=d,a=h,n=l,s=m(s,d,h,l,e[o],7,-680876936),l=m(l,s,d,h,e[o+1],12,-389564586),h=m(h,l,s,d,e[o+2],17,606105819),d=m(d,h,l,s,e[o+3],22,-1044525330),s=m(s,d,h,l,e[o+4],7,-176418897),l=m(l,s,d,h,e[o+5],12,1200080426),h=m(h,l,s,d,e[o+6],17,-1473231341),d=m(d,h,l,s,e[o+7],22,-45705983),s=m(s,d,h,l,e[o+8],7,1770035416),l=m(l,s,d,h,e[o+9],12,-1958414417),h=m(h,l,s,d,e[o+10],17,-42063),d=m(d,h,l,s,e[o+11],22,-1990404162),s=m(s,d,h,l,e[o+12],7,1804603682),l=m(l,s,d,h,e[o+13],12,-40341101),h=m(h,l,s,d,e[o+14],17,-1502002290),d=m(d,h,l,s,e[o+15],22,1236535329),s=b(s,d,h,l,e[o+1],5,-165796510),l=b(l,s,d,h,e[o+6],9,-1069501632),h=b(h,l,s,d,e[o+11],14,643717713),d=b(d,h,l,s,e[o],20,-373897302),s=b(s,d,h,l,e[o+5],5,-701558691),l=b(l,s,d,h,e[o+10],9,38016083),h=b(h,l,s,d,e[o+15],14,-660478335),d=b(d,h,l,s,e[o+4],20,-405537848),s=b(s,d,h,l,e[o+9],5,568446438),l=b(l,s,d,h,e[o+14],9,-1019803690),h=b(h,l,s,d,e[o+3],14,-187363961),d=b(d,h,l,s,e[o+8],20,1163531501),s=b(s,d,h,l,e[o+13],5,-1444681467),l=b(l,s,d,h,e[o+2],9,-51403784),h=b(h,l,s,d,e[o+7],14,1735328473),d=b(d,h,l,s,e[o+12],20,-1926607734),s=w(s,d,h,l,e[o+5],4,-378558),l=w(l,s,d,h,e[o+8],11,-2022574463),h=w(h,l,s,d,e[o+11],16,1839030562),d=w(d,h,l,s,e[o+14],23,-35309556),s=w(s,d,h,l,e[o+1],4,-1530992060),l=w(l,s,d,h,e[o+4],11,1272893353),h=w(h,l,s,d,e[o+7],16,-155497632),d=w(d,h,l,s,e[o+10],23,-1094730640),s=w(s,d,h,l,e[o+13],4,681279174),l=w(l,s,d,h,e[o],11,-358537222),h=w(h,l,s,d,e[o+3],16,-722521979),d=w(d,h,l,s,e[o+6],23,76029189),s=w(s,d,h,l,e[o+9],4,-640364487),l=w(l,s,d,h,e[o+12],11,-421815835),h=w(h,l,s,d,e[o+15],16,530742520),d=w(d,h,l,s,e[o+2],23,-995338651),s=y(s,d,h,l,e[o],6,-198630844),l=y(l,s,d,h,e[o+7],10,1126891415),h=y(h,l,s,d,e[o+14],15,-1416354905),d=y(d,h,l,s,e[o+5],21,-57434055),s=y(s,d,h,l,e[o+12],6,1700485571),l=y(l,s,d,h,e[o+3],10,-1894986606),h=y(h,l,s,d,e[o+10],15,-1051523),d=y(d,h,l,s,e[o+1],21,-2054922799),s=y(s,d,h,l,e[o+8],6,1873313359),l=y(l,s,d,h,e[o+15],10,-30611744),h=y(h,l,s,d,e[o+6],15,-1560198380),d=y(d,h,l,s,e[o+13],21,1309151649),s=y(s,d,h,l,e[o+4],6,-145523070),l=y(l,s,d,h,e[o+11],10,-1120210379),h=y(h,l,s,d,e[o+2],15,718787259),d=y(d,h,l,s,e[o+9],21,-343485551),s=f(s,i),d=f(d,r),h=f(h,a),l=f(l,n);return[s,d,h,l]}(function(e){var t,o=[];for(o[(e.length>>2)-1]=void 0,t=0;t<o.length;t+=1)o[t]=0;var i=8*e.length;for(t=0;t<i;t+=8)o[t>>5]|=(255&e[t/8])<<t%32;return o}(e),8*e.length))}));var I=function(e,t,o){var i=t&&o||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var r=(e=e||{}).random||(e.rng||a)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t)for(var n=0;n<16;++n)t[i+n]=r[n];return t||l(r)};function E(e,t,o,i){switch(e){case 0:return t&o^~t&i;case 1:return t^o^i;case 2:return t&o^t&i^o&i;case 3:return t^o^i}}function S(e,t){return e<<t|e>>>32-t}var T=u("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],o=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var i=unescape(encodeURIComponent(e));e=new Array(i.length);for(var r=0;r<i.length;r++)e[r]=i.charCodeAt(r)}e.push(128);var a=e.length/4+2,n=Math.ceil(a/16),s=new Array(n);for(r=0;r<n;r++){s[r]=new Array(16);for(var d=0;d<16;d++)s[r][d]=e[64*r+4*d]<<24|e[64*r+4*d+1]<<16|e[64*r+4*d+2]<<8|e[64*r+4*d+3]}for(s[n-1][14]=8*(e.length-1)/Math.pow(2,32),s[n-1][14]=Math.floor(s[n-1][14]),s[n-1][15]=8*(e.length-1)&4294967295,r=0;r<n;r++){for(var h=new Array(80),l=0;l<16;l++)h[l]=s[r][l];for(l=16;l<80;l++)h[l]=S(h[l-3]^h[l-8]^h[l-14]^h[l-16],1);var c=o[0],p=o[1],g=o[2],u=o[3],f=o[4];for(l=0;l<80;l++){var v=Math.floor(l/20),m=S(c,5)+E(v,p,g,u)+f+t[v]+h[l]>>>0;f=u,u=g,g=S(p,30)>>>0,p=c,c=m}o[0]=o[0]+c>>>0,o[1]=o[1]+p>>>0,o[2]=o[2]+g>>>0,o[3]=o[3]+u>>>0,o[4]=o[4]+f>>>0}return[o[0]>>24&255,o[0]>>16&255,o[0]>>8&255,255&o[0],o[1]>>24&255,o[1]>>16&255,o[1]>>8&255,255&o[1],o[2]>>24&255,o[2]>>16&255,o[2]>>8&255,255&o[2],o[3]>>24&255,o[3]>>16&255,o[3]>>8&255,255&o[3],o[4]>>24&255,o[4]>>16&255,o[4]>>8&255,255&o[4]]}))}]));